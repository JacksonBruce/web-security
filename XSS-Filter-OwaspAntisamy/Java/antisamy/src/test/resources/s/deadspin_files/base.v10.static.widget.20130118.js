(function(b){var a="HyperionAd";b.widget("ui."+a,{default_sizes:["300x600","640x360","300x250","640x100"],iteration:0,adZone:null,hyperion:window.Hyperion,keywordsEnabled:true,keywordsLoaded:false,keywords:[],refreshOn:[],reRunOnLoad:0,onLoadReRunner:null,debug:false,initialize:function(){var e,c;this.options.original_size=this.options.size;this.options.dart_params=this.hyperion.ZoneHelper.getDartParams(this.options.original_size,this.options.variant);this.options.size_variant=this.options.size+"_"+this.options.variant;this.options.target_selector="#ad_container_"+this.options.random;this.setStatus("existing");this.addAdInfo("ad_random",this.options.random);this.addAdInfo("size",this.options.original_size);this.addAdInfo("variant",this.options.variant);if(this.default_sizes.indexOf(this.options.size)>-1){this.options.size="defaults"}var d=(window.post!==undefined&&(window.post.sponsored==="true"||window.post.sponsored===true))||(this.options.sponsored!==undefined&&this.options.sponsored===true);var f=this.options.size=="1x1"||this.options.size_variant=="640x360_default";if(!d||f){this.stepToLoadZones()}else{this.setStatus("skipping_request",true);this.hideAd()}if(this.refreshOn.length>0){for(e=0,c=this.refreshOn.length;e<c;e++){jQuery(document).bind(this.refreshOn[e],jQuery.proxy(this.refreshAd,this))}}},stepToLoadZones:function(){this.nowOrLater(jQuery.proxy(this.canLoadZones,this),jQuery.proxy(this.loadZones,this),["hyperion.emailalerts.loaded"])},nowOrLater:function(e,h,g){var d,c,f=(function(j,k){return function(){var l=j();if(l){k()}return l}}(e,h));if(f()===false&&g!==undefined){for(d=0,c=g.length;d<c;d++){jQuery(document).bind(g[d],f)}}},canLoadZones:function(){return this.hyperion.GanjaConnector.emailAlertsLoaded},getZoneParams:function(){var c={site_id:this.options.site_id,size:this.options.size};if(window.pageType==="splash_post"){c.page_type="frontpage"}else{if(window.pageType==="tagpage"){c.page_type="tag"}else{c.page_type=window.pageType||window.page_type}}if(this.options.ged_zone!==undefined){c.ged_zone=this.options.ged_zone}return c},selectZone:function(g){var h,f,e,d,c;if(g&&g.meta&&g.meta.success===true&&g.data.zones!==undefined){this.addAdInfo("hyperion_status","success");d=g.data.zones;for(h=0,f=d.length;h<f;h++){for(e in d[h]){if(d[h].hasOwnProperty(e)){c=d[h][e];if(this.tagsMatching(c)){this.adZone=e;this.stepToRender();return}}}}}else{this.addAdInfo("hyperion_status","failure")}this.addAdInfo("zone","not found");this.hideAd()},tagsMatching:function(k){var h=this.options.tags,c,j,f,d,g,e=0;if(k.length===0){return true}if(!(this.options.tags instanceof Array&&this.options.tags.length>0)){return false}for(c=0,j=k.length;c<j;c++){g=k[c];for(f=0,d=g.length;f<d;f++){if(h.indexOf(g[f])>-1){e+=1;break}}}return(j===e)},loadZones:function(){var c=this.getForcedZone();this.debugLog("forcedZone",c);if(this.keywordsEnabled===true&&this.keywordsLoaded===false){this.hyperion.GanjaConnector.loadKeywords(this.getKeywordParams(),jQuery.proxy(this.handleKeywords,this))}if(c===false){this.hyperion.GanjaConnector.loadZones(this.getZoneParams(),jQuery.proxy(this.selectZone,this))}else{this.adZone=c;this.stepToRender()}},getForcedZone:function(){var c=false,e=window.location.href.match(/\?(.+)$/),d;if(this.options.forced_zone!==undefined){c=this.options.forced_zone}if(this.hyperion.GanjaConnector.emailAlerts.length>0){this.addAdInfo("alerts_triggered",this.hyperion.GanjaConnector.emailAlerts.join(", "));c="collapse"}if(e!==null){d=window.gawker_parseQueryString(e[1]);if(d.adzone!==undefined){c=d.adzone}}return c},getKeywordParams:function(){var e=["tags","issued","headline"],d={site_id:this.options.site_id},f,c;for(f=0,c=e.length;f<c;f++){if(this.options[e[f]]!==undefined){d[e[f]]=this.options[e[f]]}}if(document.referrer!==""){d.referer=document.referrer}if(window.hyperionOptions.page!==undefined){d.pagetype=page}if(window.hyperionOptions.is_frontpage===true){d.pagetype="frontpage"}return d},handleKeywords:function(c){if(c&&c.meta&&c.meta.success===true){if(c.data.keywords!==undefined&&c.data.keywords instanceof Array){this.keywords=c.data.keywords;this.keywordsLoaded=true;jQuery(document).trigger("ad."+this.options.random+".keywords.loaded")}}},stepToRender:function(){this.nowOrLater(jQuery.proxy(this.canRender,this),jQuery.proxy(this.render,this),["ad."+this.options.random+".keywords.loaded"])},canRender:function(){return this.keywordsLoaded===true},render:function(){var c="http://ad.doubleclick.net/N4246/adj/"+this.getDartScriptParams()+"?",d=jQuery.proxy(this.hideEmpty,this);this.addAdInfo("dart_url",c);if(this.options.mode==="iframe"){this.recreateIframe();this.addAdInfo("mode","iframe");this.setIframeContent(jQuery("#ad_iframe_"+this.options.random)[0],c,d)}else{this.element.html(jQuery.writeCapture.sanitize('<script type="text/javascript" src="'+c+'"><\/script>',d))}},getDartScriptParams:function(){var g=this.options.site+"/"+this.adZone,f=[],e=this.getKeywords(),d,c;this.addAdInfo("zone",g);if(window.crtg_content!==undefined){f.push(window.crtg_content)
}this.addAdInfo("keywords",e.join(", "));for(d=0,c=e.length;d<c;d++){f.push(e[d])}this.addAdInfo("dart_params",this.options.dart_params.join(" | "));return[g,f.join(";"),this.options.dart_params.join(";")].join(";")},getKeywords:function(){var f=[],g=window.adRobot.auth,d=g.ssoUser||g.sso,e,c;for(e=0,c=this.options.keywords.length;e<c;e++){f.push(this.options.keywords[e])}if(this.options.variant!=="default"){f.push("slot="+this.options.variant)}if(g.hasLevel("commenters")){f.push("commenter=yes");if(g.hasLevel("starcommenters")){f.push("star=yes")}}if(this.hyperion.ZoneHelper.isTablet()===true){f.push("platform=tablet")}if(d&&d.displayName){f.push("loggedin=yes");f.push("username="+escape(escape(escape(d.displayName))));f.push("burner="+(d.authType==="burner"?"yes":"no"))}else{f.push("loggedin=no")}if(this.keywords.length>0){for(e=0,c=this.keywords.length;e<c;e++){if(f.indexOf(this.keywords[e])<0){f.push(this.keywords[e])}}}return f},setIframeContent:function(f,d,j){function c(e){return e.contentWindow.document||e.contentWindow.window.document||e.contentDocument}var g=this;b(f).load(function(){if(g.reRunOnLoad>0){g.onLoadReRunner=function(){window.setTimeout(function(){j(f,c(f))},g.reRunOnLoad);g.onLoadReRunner=null}}j(f,c(f))});try{f.src="/static/ad_iframe.html#"+this.options.random+"|"+encodeURIComponent(d)}catch(h){this.debugLog("exception",h)}},recreateIframe:function(){var d=jQuery(this.options.target_selector),c=jQuery("<iframe></iframe>").attr(this.options.iframe_attributes);d.children().remove();c.appendTo(d)},hideEmpty:function(){if(this.isEmpty()===true){this.hideAd();if(this.onLoadReRunner!==null){this.onLoadReRunner()}}else{this.stepToShowAd()}},isEmpty:function(){var d=false,g=this.element[0],k,j=jQuery("> iframe",g),h,f,e,c;if(j.length>0&&this.element.children(":not(iframe)").length>0){d=false}else{if(j.length>0){h=j.contents();f=h.find("body");e=h.find("head, body");k=f.html();c=e.find("[src]")}else{k=g.innerHTML;c=jQuery("[src]",g)}if(jQuery.trim(k).length===0){d=true}else{c.each(function(m,l){if(l.src&&l.src.match(/817-(grey|grey_|blank|blank_).gif/)){d=true}})}}this.addAdInfo("empty_ad",d);return d},stepToShowAd:function(){this.showAd()},showAd:function(c){this.shower();this.setStatus("shown");if(c!==true){this.onShow();this.dispatchEvent("show")}},shower:function(){jQuery(this.options.target_selector).show()},onShow:function(){},hideAd:function(c){this.hider();this.setStatus("hidden");if(c!==true){this.onHide();this.dispatchEvent("hide")}},hider:function(){jQuery(this.options.target_selector).hide()},onHide:function(){},addAdInfo:function(d,f,c){this.debugLog(d,f);var e=this.element.data("ad_info");if(e===undefined){e=[]}if(e[this.iteration]===undefined){e[this.iteration]={}}if(e[this.iteration][d]===undefined||c===true){e[this.iteration][d]=[]}e[this.iteration][d].push(f);this.element.data("ad_info",e)},setStatus:function(c){this.addAdInfo("status",c,true);this.element.data("status",c)},getStatus:function(c){return jQuery(c).data("status")},debugLog:function(d,f){if(this.debug===true){var c=new Date(),e=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"."+c.getMilliseconds();console.log(e+" "+this.options.size_variant+" "+d+": "+f)}},subscribeEvent:function(d,c,e){jQuery(document).bind("ad."+d+"."+c,e)},dispatchEvent:function(c){jQuery(document).trigger("ad."+this.options.size_variant+"."+c)},refreshAd:function(){this.options.dart_params=this.hyperion.ZoneHelper.getDartParams(this.options.original_size,this.options.variant,undefined,true);this.stepToLoadZones()}})}(jQuery));(function(b){var a="HyperionAd_ForeplayTriggered";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,stepToRender:function(){this.nowOrLater(jQuery.proxy(this.canRender,this),jQuery.proxy(this.render,this),["ad."+this.options.random+".keywords.loaded","ad.660x300_default.hide"])},canRender:function(){return b.ui.HyperionAd.prototype.canRender.apply(this,arguments)&&(this.getStatus(".660x300.default")==="hidden"||this.getStatus(".660x300.default")==="skipped"||b("#gallerypost_container").length>0)}}))}(jQuery));(function(a){a.widget("ui.AdRobot",{status:{},has_marquee:false,marquee_running:false,marquee_cancelled:false,marquee_finished:false,marquee_config:null,marquee_configs:{},interstitial_running:false,previous_skin_css_url:"",queued_ads:{},debug_mode:false,callback_methods:{},ad_info_visible:false,spShown:{},permalinkFooterPanoThreshold:70,permalinkFooterPanoCast:null,rightBarFixer:{running:false,start:function(b){this.running=true;jQuery("#rightbar_list_container").css({position:"relative",top:"-250px"});jQuery("#rightcontainer .rightbar_list").css({"margin-top":"250px"});jQuery("#rightcontainer .cn_pager.lower").css({bottom:"-2px"});jQuery(b).css({height:"250px"})},stop:function(b){this.running=false;jQuery("#rightbar_list_container").css({position:"static",top:"0px"});jQuery("#rightcontainer .rightbar_list").css({"margin-top":"0px"});jQuery("#rightcontainer .cn_pager.lower").css({bottom:"0px"})},fix:function(){if(this.running===true){var f=jQuery("#rightcontainer .inner");
var d=jQuery(".inner .ad_300x250.rightbar");var e=jQuery("#rightbar_scroller");if(e[0].scrollTop===0){f.css({overflow:"visible"});d.css({"margin-top":"0px"});jQuery("#rightbar_list_container").css({top:"-250px"})}else{var b=Math.max(250-e[0].scrollTop,0);f.css({overflow:"hidden"});d.css({"margin-top":(-1*e[0].scrollTop)+"px"});var c=Math.min(e[0].scrollTop-250,0);jQuery("#rightbar_list_container").css({top:c+"px"})}}}},setIframeDimensions:function(c,d,b){jQuery(c).attr({width:d,height:b})},initialize:function(){jQuery.writeCapture.writeOnGetElementById=true;jQuery.writeCapture.autoAsync();var c=this;jQuery(document).ready(function(){c.checkStickyPreview()});this.subscribeForEvent("maincontent.classicfrontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.postloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.mainContentLoaded.bind(this));var d=window.location.href.match(/\?(.+)$/);if(d!==null){var b=window.gawker_parseQueryString(d[1]);if(b.addebug!==undefined){this.debug_mode=true}}this.permalinkFooterPanoCast=Math.floor(Math.random()*100)},mainContentLoaded:function(b){if(!this.isFrontpage()){jQuery(".front_300x250").closest(".ad_300x250.rightbar").remove()}},checkStickyPreview:function(){var e=jQuery.cookie("GANJAFORCEVIEWDIR");if(e&&e!=="deleted"){var c=jQuery.cookie("GANJAFORCEVIEW");if(jQuery("#errorbar").length===0){var d=jQuery('<div id="errorbar" style="display: none;" />');d.append("This is a persistent skin preview for <strong>"+c+'</strong> showing on all pages. <a class="nocapture" href="/index.php?op=takeover_preview&view=default">Click here to return to normal.</a><br />');d.append('Preview for this page only: <input id="skin_preview_url" type="text" value="" style="width: 400px;"/>');jQuery("body").prepend(d)}jQuery("#errorbar").show();jQuery("#main-container").addClass("skinpreview");jQuery("#skin_preview_url").val(document.location+"?view="+c);var b=e;this.setSkinCSS(b+this.options.takeover_css_name)}},setSkinCSS:function(b){if(window.hyperionOptions!==undefined){return false}if(this.skinNeedsToChange(b)||b===""){var c=jQuery("head .takeover_css");if(b===""){c.remove()}else{jQuery.cookie("interstitial_count",0,{path:"/"});if(c.length===0){jQuery("head").append('<link class="takeover_css" rel="stylesheet" type="text/css" href="'+b+'">')}else{c.eq(0).attr("href",b)}}this.previous_skin_css_url=b;return true}else{return false}},skinNeedsToChange:function(b){var c=jQuery(".takeover_css");if(c.length===1){var d=c.eq(0).attr("href").split("?");if(d[0]===b){return false}}if(b!==this.previous_skin_css_url){return true}return false},marqueeConfig:function(c,b){if(this.marquee_configs[c]===undefined){this.has_marquee=true;this.marquee_configs[c]=b}},runMarquee:function(b){if(this.marquee_configs[b]!==undefined){this.marquee_config=this.marquee_configs[b];jQuery(document).trigger("ad.marquee.run");return this.marquee_config.marquee_should_run===true}return false},cancelMarquee:function(){this.marquee_cancelled=true;jQuery(document).trigger("ad.marquee.cancel")},checkMarquee:function(b){if(this.marquee_configs[b]!==undefined){return this.marquee_configs[b].marquee_should_run===true}return false},queueAdRun:function(c,b){this.queued_ads[c]=b},runAdBySelector:function(b){var d=jQuery(b);if(d.length){var c=d.eq(0).attr("id").replace("ad_container_","");this.runAdFromQueue(c)}},runAdFromQueue:function(c){if(!this.queued_ads[c]){return false}var b=jQuery("#ad_container_"+c);if(b.length>0){b.AdUnit(this.queued_ads[c]);delete this.queued_ads[c]}},showAdInfo:function(b){window.Hyperion.ZoneHelper.showAdInfo(b)},trackerTest:function(c){var b=0;var g={takeover:{label:"Takeover",selector:".ad_marquee .ad_container.takeover"},marquee:{label:"Marquee",selector:".ad_marquee .ad_container.marquee"},"7th_story":{label:"7th Story",selector:".sponsored_splash_post .ad_tracker-rightbar-sp .ad_container, .splashposts .post .ad_tracker-rightbar-sp .ad_container"},sidebar:{label:"Sidebar",selector:".rightbar_list .sponsored .ad_tracker-rightbar-sp .ad_container, #rightbar .sponsored .ad_tracker-rightbar-sp .ad_container"}};var e,d,f=null;for(d in g){if(g.hasOwnProperty(d)&&(c===undefined||c===d)){f=a(g[d].selector);for(b=0;b<f.length;b++){e=f.eq(b).data("ad_info");if(e!==undefined){if(c===undefined){this.logInfo(g[d].label+" Tracker",e)}else{return true}}}}}return false},logInfo:function(b,d){var e={size:"Size",dart_url:"DART URL",status:"Status"};var c=0;window.console.group(b);for(key in e){if(e.hasOwnProperty(key)){for(c=(d.length-1);c>=0;c--){if(d[c][key]!=undefined){window.console.log(e[key]+": "+d[c][key][d[c][key].length-1]);break}}}}window.console.groupEnd()},isFrontpage:function(){return(window.pageType==="frontpage"||window.pageType==="classic_frontpage"||window.pageType==="splash_post")},delay300x250:function(){return((this.marquee_config!==null&&this.marquee_config.marquee_should_run)||this.marquee_running||this.interstitial_running)},loadAdsense:function(){if(!this.ads_script){var b=this.ads_script=new Promise;
gawker_getScript("http://www.google.com/jsapi").then(function(){google.load("ads","1",{callback:function(){b.resolve()}})})}return this.ads_script},initAdsense:function(c,b){if(!c&&b&&b[0]){c=b[0]}if(jQuery("#ad-unit-inner").length>0&&!SocialButtons.thirdpartyDisabled){this.loadAdsense().then(function(){if(typeof google!=="undefined"){var d={format:"468x60",ad_slot:"8492826073",ad_type:"text",hints:c};new google.ads.Ad("ca-pub-0457527031304647","ad-unit-inner",d)}})}},showSp:function(b){this.spShown["sp_"+b]=true;jQuery(document).trigger("ad.sp."+b+".show")},isSpShown:function(b){if(this.spShown["sp_"+b]===true){return true}else{return false}},permalinkPanoShouldLoad:function(){return this.isPanoInFooter()},permalink300ShouldLoad:function(){return !this.isPanoInFooter()},isPanoInFooter:function(){var b=null,c=window.location.href.match(/\?(.+)$/);if(c!==null){hashParams=window.gawker_parseQueryString(c[1]);if(hashParams.footer_ad!==undefined){if(hashParams.footer_ad==="panorama"){b="640x360"}else{if(hashParams.footer_ad==="300x250"){b="300x250"}}}}if(b===null){if(this.permalinkFooterPanoCast>this.permalinkFooterPanoThreshold){b="640x360"}else{b="300x250"}}return(b==="640x360")}});a.extend(a.ui.AdRobot,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control",takeover_css_name:"style.css"}})}(jQuery));(function(a){a.widget("ui.AdUnitAncestor",{xhr:null,default_sizes:["300x600","640x360","300x250"],refreshable_variants:["300x250_rightbar","300x250_inpost","300x600_inpost"],hyperion_url:"",dart_url:"",status:[],iteration:0,ad_conditions:{},special_togglers:{"80x45_default":{show:{right_on:function(b){var c=this.options.selectors;jQuery(b).closest(c["80x45_container"]).hover(function(){var e=jQuery(this).height();jQuery(this).height(e+"px");jQuery(c.thumb_container,jQuery(this)).hide();jQuery(".stamp_container",jQuery(this)).show()},function(){jQuery(c.thumb_container,jQuery(this)).show();jQuery(".stamp_container",jQuery(this)).hide()}).css({"min-height":"60px"});var d=jQuery(b+" img").attr("alt");if(d!=="Click here to find out more!"){jQuery(".broughtby",jQuery(b).closest(c["80x45_text"])).html(d)}}},hide:{right_on:function(b){}}},"300x250_inpost":{show:{right_on:function(b){var d=jQuery(b).find("iframe");var c=d.contents().find("body > div");if(c.length){d.attr({height:c.height()})}}}},"300x600_inpost":{show:{right_on:function(b){var d=0,c=0;var e=jQuery("iframe",jQuery(b));var f=e.contents().find("embed, img");for(d=0,c=f.length;d<c;d++){if(parseInt(f.eq(d).attr("width"),10)===160){e.attr({width:160});return true}}}}},"660x300_default":{show:{right_on:function(b){window.adRobot.interstitial_running=true;jQuery.cookie("interstitial_shown","true",{expires:(24*60*60),path:"/"});jQuery("#interstitial_bottom").show()}},hide:{right_on:function(b){window.adRobot.interstitial_running=false;jQuery("#interstitial_bottom").hide();jQuery(document).trigger("ad.inpost300.refresh")}}},"640x360_default":{show:{right_on:function(c){jQuery("body").removeClass("panorama-resized");var b=jQuery(c).find("iframe").contents().find(".pano");if(b.length){jQuery(c).find("iframe").attr({height:b.height()})}else{var d=jQuery(c).find("iframe").contents().find("body > a > img");if(d.length){jQuery(c).find("iframe").attr({height:d.height()})}}}},hide:{right_on:function(b){window.adRobot.runAdBySelector(".ad_container.panorama")}}},"300x250_panorama":{show:{right_on:function(b){jQuery("body").addClass("panorama-resized");jQuery(b).closest(".ad_300x250").before('<div style="clear: both;"></div>')}},hide:{right_on:function(b){jQuery("body").removeClass("panorama-resized")}}}},initialize:function(){this.xhr=new XHR({klass:"adunit",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this),timeout:5000});this.setTogglers();this.options.original_size=this.options.size;this.options.dart_params=window.adRobot.getDartParams(this.options.original_size,this.options.variant);this.options.size_variant=this.options.size+"_"+this.options.variant;this.options.target_selector="#ad_container_"+this.options.random;if(this.options.size_variant==="300x250_rightbar"&&window.post_data!==undefined&&window.post_data.hyperion!==undefined){this.options=a.extend({},window.post_data.hyperion,this.options)}this.addAdInfo("ad_random",this.options.random);this.addAdInfo("size",this.options.original_size);if(this.default_sizes.indexOf(this.options.size)>-1){this.options.size="defaults"}if(this.options.size_variant==="300x250_rightbar"){jQuery(window).bind("maincontent.load",jQuery.proxy(this.getDartParams,this));this.subscribeForEvent("maincontent.frontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.classicfrontpageloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.postloaded",this.mainContentLoaded.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.mainContentLoaded.bind(this));jQuery(document).bind("ad.marquee.finished",jQuery.proxy(this.marqueeEventHandler,this))
}var c=["660x300_default","300x600_inpost","300x250_inpost"];if(c.indexOf(this.options.size_variant)>-1){jQuery(document).bind("ad.interstitial.init",jQuery.proxy(this.interstitialEventHandler,this));jQuery(document).bind("ad.interstitial.started",jQuery.proxy(this.interstitialEventHandler,this));jQuery(document).bind("ad.interstitial.finished",jQuery.proxy(this.interstitialEventHandler,this));if(this.options.size_variant!=="660x300_default"){jQuery(document).bind("ad.inpost300.refresh",jQuery.proxy(function(){this.refreshAd({request_ad:true});this.unbindEvents()},this))}}var b=window.Hyperion.GanjaConnector;if(b.emailAlertsLoaded===true){this.requestAd()}else{jQuery(document).bind("hyperion.emailalerts.loaded",jQuery.proxy(this.requestAd,this))}},setTogglers:function(){var b=null;for(b in this.options.special_togglers){if(this.options.special_togglers.hasOwnProperty(b)){this.special_togglers[b]=this.options.special_togglers[b]}}return this},unbindEvents:function(){jQuery(document).unbind(".interstitial");jQuery(document).unbind("ad.marquee.finished");jQuery(document).unbind("ad.inpost300.refresh")},requestAd:function(){this.hyperion_url="";this.dart_url="";var h=false,e=false,c=window.Hyperion.GanjaConnector;if(this.options.forced_zone!==undefined){h=this.options.forced_zone}if(c.emailAlerts.length>0){this.addAdInfo("alerts_triggered",c.emailAlerts.join(", "));h="collapse"}var g=window.location.href.match(/\?(.+)$/);if(g!==null){var d=window.gawker_parseQueryString(g[1]);if(d.adzone!==undefined){h=d.adzone}else{if(d.no_ads_for_me_rosebud!==undefined){if(d.no_ads_for_me_rosebud=="true"){e=true;jQuery.cookie("no_ads_for_me_rosebud",1,{expires:0.25,path:"/"})}else{jQuery.cookie("no_ads_for_me_rosebud",null)}}}}if(e===true||jQuery.cookie("no_ads_for_me_rosebud")==1){this.forgeFakeResponse({success:false})}else{if(h!==false&&this.options.request_ad===true){this.forgeFakeResponse({success:this.adConditionsApply(),ad_zone:h})}else{var j=["site_id="+this.options.site_id,"size="+this.options.size,"random="+this.options.random];if(window.pageType==="splash_post"){j.push("page_type=frontpage")}else{if(window.pageType==="tagpage"){j.push("page_type=tag")}else{j.push("page_type="+window.pageType)}}if(this.options.tags&&this.options.tags.length>0){for(var f=0,b=this.options.tags.length;f<b;f++){j.push("tags[]="+this.options.tags[f])}}if(document.referrer!==""){j.push("referer="+encodeURIComponent(document.referrer))}if(this.options.ged_zone!==undefined){j.push("ged_zone="+this.options.ged_zone)}if(this.options.issued!==undefined){j.push("issued="+this.options.issued)}j.push("jsonp=?");this.hyperion_url="http://"+this.options.adserver_host+"/ad/"+this.options.original_size+"?"+j.join("&");this.addAdInfo("hyperion_url",this.hyperion_url);if(this.adConditionsApply()&&this.options.request_ad===true){this.setStatus("hyperion_request_sent",true);this.xhr.getJSON(this.hyperion_url)}else{this.hideAd(this.options.target_selector,this.options.size_variant,false);this.setStatus("skipping_request",true)}}}},throttledZoneSearch:function(){var c=this.getHyperionScalaParams(),b=function(d){};window.Hyperion.Client.throttledRequest("ZoneTargeting/search",c,b,100)},getHyperionScalaParams:function(){var b={site_id:this.options.site_id,size:this.options.size};if(this.options.ged_zone!==undefined){b.ged_zone=this.options.ged_zone}if(window.pageType==="splash_post"){b.page_type="frontpage"}else{if(window.pageType==="tagpage"){b.page_type="tag"}else{b.page_type=window.pageType}}return b},adConditionsApply:function(){if(this.options.sponsored!=undefined&&(this.options.sponsored===true||this.options.sponsored==="true")){return false}if(this.ad_conditions[this.options.size_variant]){return this.ad_conditions[this.options.size_variant](this.options.target_selector)}return true},updateOptions:function(b){for(var c in b){if(b.hasOwnProperty(c)){if(b[c]!==null){this.options[c]=b[c]}else{delete this.options[c]}}}},refreshAd:function(b){this.updateOptions(b);if(this.refreshable_variants.indexOf(this.options.size_variant)>-1){this.setStatus("refreshing");this.iteration++;this.requestAd()}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){this.setStatus("hyperion_request_success");this.renderAd(b)},handleAjaxFail:function(){this.setStatus("hyperion_request_fail");if(this.options.fallback_zone){return this.forgeFakeResponse({success:true,ad_zone:this.options.fallback_zone})}else{return this.forgeFakeResponse({success:false})}},forgeFakeResponse:function(c){var b={action:"ad_select",success:c.success,random:this.options.random};if(c.ad_zone!==undefined){b.type="zone";b.params={ad_zone:c.ad_zone}}return this.handleAjaxSuccess(b)},renderAd:function(b){if(b.action==="ad_select"&&b.success===true){Logger.debugLog("rendering "+this.options.original_size+"@"+this.options.target_selector);if(b.type==="zone"){this.renderDartZone(b)}}else{jQuery(this.options.target_selector).html("");this.hideEmpty()}},renderDartZone:function(e){var c=[];if(window.crtg_content!==undefined){c.push(window.crtg_content)
}var f=0,d=0;var g=[];for(f=0,d=this.options.keywords.length;f<d;f++){g.push(this.options.keywords[f])}if(this.options.original_size==="300x250"&&this.options.variant!="default"){g.push("slot="+this.options.variant)}if(this.auth.hasLevel("commenters")){g.push("commenter=yes");if(this.auth.hasLevel("starcommenters")){g.push("star=yes")}}var k=this.auth.ssoUser?this.auth.ssoUser:this.auth.sso;if(k&&k.displayName){g.push("loggedin=yes");g.push("username="+escape(escape(escape(k.displayName))));g.push("burner="+(k.authType==="burner"?"yes":"no"))}else{g.push("loggedin=no")}if(e.keywords){for(f=0,d=e.keywords.length;f<d;f++){if(c.indexOf(e.keywords[f])<0){g.push(e.keywords[f])}}}this.addAdInfo("keywords",g.join(", "));for(f=0,d=g.length;f<d;f++){c.push(g[f])}var m=this.options.site+"/"+e.params.ad_zone;var b="http://ad.doubleclick.net/N4246/adj/"+m+";"+c.join(";")+";"+this.options.dart_params.join(";")+"?";this.addAdInfo("zone",m);this.addAdInfo("dart_params",this.options.dart_params.join(" | "));var j=jQuery.proxy(this,"hideEmpty");if(this.options.mode=="iframe"){this.setStatus("iframe_render_starting");this.recreateIframe();this.setIframeContent(jQuery("#ad_iframe_"+this.options.random)[0],b,j);this.setStatus("iframe_render_started")}else{var h=['<script type="text/javascript" src="'+b+'"><\/script>'];h=h.join("\n");this.setStatus("div_render_starting");this.element.html(jQuery.writeCapture.sanitize(h,j));this.setStatus("div_render_started")}this.dart_url=b;this.addAdInfo("dart_url",this.dart_url)},cleanContainer:function(){jQuery("#ad_container_"+this.options.random).children().remove()},setIframeContent:function(d,g,h){function c(e){return e.contentWindow.document||e.contentWindow.window.document||e.contentDocument}var b=this.options.original_size;a(d).load(function(){if(b==="300x250"){window.setTimeout(function(){h(d,c(d))},1500)}else{h(d,c(d))}});try{d.src="/static/ad_iframe.html#"+this.options.random+"|"+encodeURIComponent(g)}catch(f){}},recreateIframe:function(){var c=jQuery("#ad_container_"+this.options.random);this.cleanContainer();var b=jQuery("<iframe></iframe>").attr(this.options.iframe_attributes);b.appendTo(c)},hideEmpty:function(){this.setStatus("hide_empty_called");if(this.adIsEmpty()===true){this.setStatus("ad_was_empty");Logger.debugLog(this.options.original_size+" was empty");if(this.options.original_size=="300x600"){this.element.find("iframe").attr({width:300,height:250}).contents().empty();this.options.iframe_attributes.height=250;this.options.original_size="300x250";this.options.dart_params=window.adRobot.getDartParams(this.options.original_size,this.options.variant);this.iteration++;this.requestAd()}else{this.hideAd(this.options.target_selector,this.options.size_variant,true)}}else{this.setStatus("ad_was_there");this.showAd(this.options.target_selector,this.options.size_variant)}},adIsEmpty:function(){var e=this.element[0],c="",h=[],b=false;if(jQuery("table",e).length>0){b=false}else{if(jQuery("iframe",e).length>0){var f=jQuery("iframe",e).contents();var g=f.find("body");var d=f.find("head, body");c=g.html();h=d.find("[src]")}else{c=e.innerHTML;h=jQuery("[src]",e)}if(jQuery.trim(c).length===0){b=true}else{h.each(function(k,j){if(j.src&&j.src.match(/817-(grey|grey_|blank|blank_).gif/)){b=true}})}}this.addAdInfo("empty_ad",b);return b},showAd:function(b,c){if(c==="300x250_rightbar"&&window.adRobot.delay300x250()){jQuery("#tomorrowsnews").show()}if(c!=="300x250_rightbar"||!window.adRobot.delay300x250()){if(c==="660x300_default"){if(jQuery.browser.safari){jQuery(b).fadeIn("slow")}else{jQuery(b).slideDown("slow")}}else{jQuery(b).show()}this.callSpecialTogglers(b,c,"show")}},hideAd:function(b,d,c){if(d==="660x300_default"){jQuery(b).slideUp("slow")}else{jQuery(b).hide()}if(c===true){this.callSpecialTogglers(b,d,"hide")}},callSpecialTogglers:function(b,e,f){if(this.special_togglers[e]&&this.special_togglers[e][f]){var c=this.special_togglers[e][f];if(c.on_ready){var d=this;jQuery().ready(function(){jQuery.proxy(c.on_ready,d)(b)})}if(c.right_on){jQuery.proxy(c.right_on,this)(b)}}},setStatus:function(f,e){if(e===true){this.status=[];jQuery("#ad_info_"+this.options.random).remove()}var c=new Date();var d=c.getTime();var b={status_text:f,timestamp:d};this.status.push(b)},getDartParams:function(){this.options.dart_params=window.adRobot.getDartParams(this.options.original_size,this.options.variant);this.options.refreshable=true},mainContentLoaded:function(c){if(this.options.refreshable===undefined||this.options.refreshable===true||c.params.data.sponsored===true||this.options.sponsored===true){var b={request_ad:true,tags:null,sponsored:null,ged_zone:null};if(c.params.data.tags!==undefined){b.tags=c.params.data.tags}if(c.params.data.sponsored!==undefined){b.sponsored=c.params.data.sponsored}if(c.params.data.post.ged_zone!==undefined){b.ged_zone=c.params.data.post.ged_zone}this.refreshAd(b)}},marqueeEventHandler:function(b){switch(b.namespace){case"init.marquee":jQuery(this.options.target_selector).hide();
break;case"finished.marquee":if(false===this.adIsEmpty()){this.showAd(this.options.target_selector,"300x250_rightbar")}break}},interstitialEventHandler:function(b){switch(b.namespace){case"init.interstitial":break;case"interstitial.started":if(this.browser=="ie"){jQuery("#interstitial_countdown_container").css("opacity",1);jQuery("#interstitial_bottom_info").css("opacity",1);jQuery("#bannercontainer").css("opacity",1)}else{jQuery("#interstitial_countdown_container").animate({opacity:1},500);jQuery("#interstitial_bottom_info").animate({opacity:1},500);jQuery("#bannercontainer").animate({opacity:1},500)}break;case"finished.interstitial":if(this.options.original_size==="660x300"){this.hideAd(".ad_interstitial","660x300_default",true);jQuery("body").removeClass("interstitialed")}else{jQuery(document).trigger("ad.inpost300.refresh")}this.unbindEvents();break}},addAdInfo:function(b,d){var c=this.element.data("ad_info");if(c===undefined){c=[]}if(c[this.iteration]===undefined){c[this.iteration]={}}if(c[this.iteration][b]===undefined){c[this.iteration][b]=[]}c[this.iteration][b].push(d);this.element.data("ad_info",c)}});a.extend(a.ui.AdUnitAncestor,{version:"1.0",defaults:{adserver_host:"localhost:8800",controlClass:"ad_control"}})})(jQuery);(function(a){a.widget("ui.AdminLogWidget",{initialize:function(){this.settings=[];this.xhr=new XHR({klass:"adminlog",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.page=0;this.showWidget()},showWidget:function(){this.loadData()},loadData:function(){var b={op:"commentadminstat",id:this.options.user_id,page:this.page};if(this.controls.indicator){this.controls.indicator.show()}this.xhr.send("/index.php",b)},handleClick:function(c){var b=this.getParam("cn",c.target);switch(b){case"next":this.page++;this.loadData();c.stopPropagation();c.preventDefault();break;case"prev":if(this.page>0){this.page--}this.loadData();c.stopPropagation();c.preventDefault();break}},handleAjaxSuccess:function(b){this.element.html(b.content);this.setControls();this.controls.indicator.hide()}});a.extend(a.ui.AdminLogWidget,{version:"1.0",defaults:{controlClass:"adminlogcontrol"}})})(jQuery);(function(a){a.widget("ui.AgeGate",{initialize:function(){var b=jQuery.cookie("visitor_birthdate");if(b!=null){parts=b.split("_");daysLeft=this.getDaysLeft(this.options.limit,parts[0],parts[1],parts[2]);if(daysLeft==0){var c=this.options.handler(this.options.object,this.options.id);jQuery("#"+this.options.id).get(0).innerHTML=c.output;if(c.postShow!==undefined){c.postShow()}return true}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,this.options.id);roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px"}}else{jQuery("#"+this.options.id)[0].innerHTML=jQuery("#agegate_container")[0].innerHTML.replace(/IDHERE/,this.options.id);this.setupForm()}jQuery("#agegate_"+this.options.id)[0].style.width=this.options.object.width+"px";jQuery("#agegate_"+this.options.id)[0].style.height=this.options.object.height+"px"},setupForm:function(){jQuery("INPUT.agegate_control").focus(function(){if(this.value==this.defaultValue){this.value=""}if(this.value!=this.defaultValue){this.select()}this.style.color="black"});jQuery("INPUT.agegate_control").blur(function(){if(a.trim(this.value)==""){this.value=(this.defaultValue?this.defaultValue:"");this.style.color="lightgrey"}});jQuery("INPUT.agegate_control").keypress(function(b){if((b.which>31&&b.which<48)||(b.which>57&&b.which<127)){return false}});roundbox=jQuery("#agegate_"+this.options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((this.options.object.height-roundbox.scrollHeight-10)/2)+"px";this.setControls();this.registerEventHandler(this.controls.agegate_form,"submit",this.validateAge.bind(this));this.agegate_validator=new Validator(jQuery.extend({},{scope:this.controls.agegate_form}))},validateAge:function(b){this.agegate_validator.hideErrors();if(this.agegate_validator.validate()){year=this.controls.year[0].value;month=this.controls.month[0].value;day=this.controls.day[0].value;jQuery.cookie("visitor_birthdate",year+"_"+month+"_"+day);gates=GawkerClientside.widgets.agegate;for(i=0;i<gates.length;i++){daysLeft=this.getDaysLeft(gates[i].options.limit,year,month,day);if(daysLeft==0){var c=gates[i].options.handler(gates[i].options.object,gates[i].options.id);jQuery("#"+gates[i].options.id).get(0).innerHTML=c.output;if(c.postShow!==undefined){c.postShow()}}else{jQuery("#"+gates[i].options.id)[0].innerHTML=jQuery("#agegate_container_rejected")[0].innerHTML.replace(/IDHERE/,gates[i].options.id);jQuery("#agegate_"+gates[i].options.id)[0].style.width=gates[i].options.object.width+"px";jQuery("#agegate_"+gates[i].options.id)[0].style.height=gates[i].options.object.height+"px";roundbox=jQuery("#agegate_"+gates[i].options.id+" .roundbox")[0];roundbox.style.marginTop=Math.floor((gates[i].options.object.height-roundbox.scrollHeight-10)/2)+"px"
}}}else{this.agegate_validator.showErrors()}b.stopPropagation();b.preventDefault()},getDaysLeft:function(b,d,e,c){now=new Date();birth=Date.UTC(d,e,c,0,0,0,0);nowyear=now.getYear();nowyear+=nowyear<1900?1900:0;start=Date.UTC((nowyear-b),now.getMonth()+1,now.getDate(),0,0,0,0);if(start>birth){daysLeft=0}else{daysLeft=Math.floor((birth-start)/(86400*1000))}return daysLeft}});a.extend(a.ui.AgeGate,{version:"1.0",defaults:{controlClass:"agegate_control"}})})(jQuery);(function(a){a.widget("ui.PromoteTweetWidget",{controls:{},params:{},xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var b=this;this.xhr=new XHR({klass:"promotetweet",beforeSend:function(c){b.handleAjaxRequest(c)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},showWidget:function(){jQuery(".content.tweets .commenttools").show()},hideWidget:function(){jQuery(".content.tweets .commenttools").hide();jQuery(".content.tweets .admin_links").hide()},authEventHandler:function(b){switch(b.name){case"user.auth.success":if(this.auth.hasLevel("authors")){this.showWidget()}else{this.hideWidget()}break;default:this.hideWidget();break}},handleClick:function(f){var b=jQuery(f.target);var d=this.getParam("tweetid",b);if(b.hasClass("cn_promote")){if(b.hasClass("hasPost")){var c="https://publish."+this.auth.site.canonicalHost.replace(/^([^\.]*\.)?([^\.]*\.[^\.]*)$/,"$2")+"/ged/"+this.getParam("postId",b);location.href=c}else{this.getUserList(d,this.getParam("tweetfeed",b))}f.stopPropagation();f.preventDefault()}else{if(b.hasClass("cn_closeadmin")){jQuery(".tweet_"+d+" .admin_links").hide();f.stopPropagation();f.preventDefault()}else{if(b.hasClass("cn_promotelink")){this.promoteTweet(d,this.getParam("userid",b),this.getParam("feed",b));f.stopPropagation();f.preventDefault()}}}},getUserList:function(c,b){this.xhr.send("/index.php",{op:"tweet_authorlist",tweetId:c,feed:b});this.showProgress(true,c)},promoteTweet:function(d,b,c){this.xhr.send("/index.php",{op:"tweet_bump",postId:d,feed:c,authorId:b});this.showProgress(true,d)},showProgress:function(b,c){if(!c){c=0}jQuery(".tweetPromoteProgress").appendTo((b?".comment.tweet.tweet_"+c+" .commenttools":"#tweetPromoteToolsContainer"))},handleAjaxRequest:function(){},handleAjaxSuccess:function(e){this.showProgress(false);switch(e.action){case"tweet_authorlist":var d=jQuery(".tweet_"+e.tweetId+" .admin_links");d.empty();if(e.success){d.append('<span class="smallfont">Choose an author:</span> ');for(var c=0,b=e.users.length;c<b;c++){d.append('<a href="#" class="smallfont ptc cn_promotelink feed_'+e.feed+" tweetid_"+e.tweetId+" userid_"+e.users[c].id+'">'+e.users[c].name+"</a> ")}d.append('<a href="#" class="ptc tweetid_'+e.tweetId+' cn_closeadmin closeButton">x</a>');d.show()}break;case"tweet_promote":jQuery(".tweet_"+e.tweetId+" .admin_links").hide();if(e.success){jQuery(".cn_promote.tweetid_"+e.tweetId).addClass("hasPost");jQuery(".cn_promote.tweetid_"+e.tweetId).removeClass("noPost");jQuery(".cn_promote.tweetid_"+e.tweetId).addClass("postId_"+e.postId)}else{jQuery(".tweet_"+e.tweetId+" .admin_message").text("Twetter promotion failed. Please try again.");jQuery(".tweet_"+e.tweetId+" .admin_message").show()}break}},handleAjaxFail:function(){this.showProgress(false)}});a.extend(a.ui.PromoteTweetWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"ptc"}})})(jQuery);(function(a){a.widget("ui.ChartbeatWidget",{xhr:null,pulseHost:"",links:[],interval:5,runChartbeat:true,initialize:function(){var b=this;this.xhr=new XHR({klass:"chartbeat",type:"POST",beforeSend:function(c){b.handleAjaxRequest(c)},error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.pulseHost=this.options.host;this.interval=this.options.interval;this.runChartbeat=this.options.runChartbeat;if(!this.interval||!this.pulseHost){this.runChartbeat=false}if(this.runChartbeat){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("navigation.loaded",this.parseChartbeatLinks.bind(this));this.subscribeForEvent("chartbeat.iterationFinished",this.runNextCheck.bind(this));this.subscribeForEvent("navigation.load",this.suspendChartbeat.bind(this));this.subscribeForEvent("maincontent.postloaded",this.resumeChartbeat.bind(this));this.subscribeForEvent("maincontent.frontpageloaded",this.resumeChartbeat.bind(this));this.parseChartbeatLinks();this.waitingForNextCheck=false;this.chartbeatSuspended=false;this.runNextCheck();this.animationQueue=0}},authEventHandler:function(b){},handleClick:function(b){},handleAjaxRequest:function(){},parseHost:function(c){if(this.hostCache===undefined){this.hostCache={}}if(this.hostCache[c]===undefined){var b=new RegExp("([^.]+).[^.]+$").exec(c);if(b===null){return c}this.hostCache[c]=b[1]+".com"}return this.hostCache[c]},parseChartbeatLinks:function(){var b=[];
var c={host:this.parseHost(location.host),path:location.pathname};var c={host:this.parseHost(location.host),path:"null"};b.push(c);var d=this;jQuery("a.liveData").each(function(f){var g="";var h="";if(this.cbHost!==undefined){g=this.cbHost;h=this.cbPath}else{var e=new RegExp("https?://([^/]+)(.*)").exec(this.href);if(e!==null){g=d.parseHost(e[1]);h=e[2];this.cbHost=g;this.cbPath=h}}c={host:g,path:h};b.push(c)});this.links=b},runNextCheck:function(){if(this.waitingForNextCheck){return}this.waitingForNextCheck=true;var b=this;setTimeout(function(){b.waitingForNextCheck=false;if(b.runChartbeat&&!this.chartbeatSuspended){b.getChartbeatData(b.links,location.host)}else{this.raiseEvent("chartbeat.iterationFinished",{})}},this.interval*1000)},getChartbeatData:function(g,b){b=this.parseHost(b);var c=[];var h={host:[],path:[],op:"ajax_remoteservice",type:"chartbeat"};for(var d=0;d<g.length;d++){var f=g[d];var e=b;if(f.host!==undefined){e=f.host}h.host.push(e);h.path.push(f.path)}this.xhr.send("index.php",h)},showChartbeatData:function(e){var l={};for(var f=0;f<e.length;f++){var j=e[f];if(j.path===null){j.path=""}if(l[j.host]===undefined){l[j.host]={}}l[j.host][j.path]={"new":j["new"],"return":j["return"],people:j["new"]+j["return"]}}var d=this;jQuery("a.liveData").each(function(n){if(this.cbHost!==undefined){var r=this.cbHost;var m=this.cbPath.replace("+"," ");if(l[r]===undefined){return true}var o=l[r][m];if(o!==undefined){var q=d.getParam("liveData",jQuery(this));if(q!==null){d.setNumber(".liveDataContainer_"+q,o.people)}else{var p=o["new"]+" new and "+o["return"]+" returning visitor";this.title=p}}}});var k=this.parseHost(location.host);if(l[k][""]!==undefined){var g=l[k][""]["people"];this.setNumber("#siteVisitors",g);var b=parseInt(jQuery("#siteVisitorRatio").css("width").replace("%",""),10);var c=Math.round(l[k][""]["new"]/l[k][""]["people"]*100-3);if(b!=c){var h=(c>b?"+":"-")+"="+Math.abs(c-b)+"%";jQuery("#siteVisitorRatio").animate({width:h},"normal")}}if(!this.waitingForNextCheck&&this.animationQueue==0){this.runNextCheck()}},setNumber:function(j,f){var d=jQuery(j);if(d.length==0||f<1){return}var c=parseInt(d.html().replace(",",""),10);var h=Math.abs(f-c);if(h==0){return}var e=1;if(h>100){e=Math.ceil(h/100)}var g=(f>c);e=e*(g?1:-1);this.animationQueue++;var b=(d.attr("id").length>0?d.attr("id"):d.attr("class"));if(g){d.closest(".viewer-count").removeClass("trendingDown").addClass("trendingUp")}else{d.closest(".viewer-count").removeClass("trendingUp").addClass("trendingDown")}this.changeNumber(c+e,f,g,e,d)},changeNumber:function(l,m,f,d,b){try{if((f&&l>m)||(!f&&l<m)){l=m}var j=l+"";var c=/(\d+)(\d{3})/;while(c.test(j)){j=j.replace(c,"$1,$2")}b.html(j);var h=this;if((f&&l<m)||(!f&&l>m)){setTimeout(function(){h.changeNumber((l+d),m,f,d,b)},5)}else{this.animationQueue--;var g=(b.attr("id").length>0?b.attr("id"):b.attr("class"));if(this.animationQueue==0){this.raiseEvent("chartbeat.iterationFinished",{})}}}catch(k){this.animationQueue--}},suspendChartbeat:function(){this.chartbeatSuspended=true},resumeChartbeat:function(){this.chartbeatSuspended=false},handleAjaxSuccess:function(b){this.showChartbeatData(b)},handleAjaxFail:function(){}});a.extend(a.ui.ChartbeatWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"chartbeat_control"}})})(jQuery);(function(b){var a=b.extend({},{login_state:"loggedout:idle",mode:"commentform",initialize:function(){this.subscribeForEvent("user.",this.authEventHandler.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.postform}));this.subscribeForEvent("navigation.load",this.navigationEventHandler.bind(this));this.subscribeForEvent("commentform.",this.eventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.postEventHandler.bind(this));this.subscribeForEvent("maincontent.tagpageloaded",this.postEventHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.forumEventHandler.bind(this));this.commentMode="text";this.registerEventHandler(this.controls.submit,"click",this.handleSubmit.bind(this));this.registerEventHandler(this.controls.cancel,"click",this.handleCancel.bind(this));this.registerEventHandler(this.controls.switchtab,"click",this.handleSwitchTab.bind(this));this.registerEventHandler(this.controls.postform,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.controls.image_url,"change",this.handleImagePreview.bind(this));this.registerEventHandler(this.controls.video_url,"change",this.handleVideoPreview.bind(this));this.registerEventHandler(this.controls.select_image_url,"click",this.setImageUrlForm.bind(this));if(this.controls.select_image_upload!==undefined){this.registerEventHandler(this.controls.select_image_upload,"click",this.setImageUploadForm.bind(this))}this.xhr=new XHR({klass:"commentform",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},authEventHandler:function(c){switch(c.name){case"user.auth.success":if(this.login_state=="loggedout:submit"){this.login_state="loggedin:idle";
this.handleSubmit({})}this.login_state="loggedin:idle";this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");this.showFormUser();break;case"user.auth.failure":this.login_state="loggedout:idle";this.hideFormUser();break;case"user.emailcomment":this.login_state="guest:submit";break}},navigationEventHandler:function(c){if(c.name=="navigation.load"){this.hideForm()}},handleSubmit:function(d){d.stopPropagation();d.preventDefault();var e=false;this.validator.hideErrors();this.validator.validate();if(typeof this.validator.errorlist.entry!="undefined"){e=true}if(typeof this.validator.errorlist.image_url!="undefined"&&this.controls.mode.val()=="image"){e=true}if(typeof this.validator.errorlist.video_url!="undefined"&&this.controls.mode.val()=="video"){e=true}if(e){if(this.options.show_validation_errors){this.validator.showErrors()}return}if(this.login_state=="loggedout:idle"||this.login_state=="loggedout:submit"){this.login_state="loggedout:submit";this.raiseEvent("presence.requiresequence.guest",{});return}if(!jQuery.browser.msie){this.controls.entry_preview.html(this.controls.entry.val());this.controls.entry.val(this.controls.entry_preview.html())}var c=this.controls.postform.serializeArray();if(window.pageType==="site_comments_admin"){c.push({name:"external_tools",value:true})}this.xhr.send("/index.php",c)},handleAjaxRequest:function(){this.controls.submit.attr("disabled","disabled");this.controls.cancel.attr("disabled","disabled");this.controls.indicator.show()},handleAjaxSuccess:function(c){this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");this.controls.indicator.hide();if(c.code!==undefined&&c.code==="ACCESS_DENIED"){c.message="Something went wrong. Please refresh the page and try again."}switch(c.action){case"addcomment":case"addguestcomment":if(c.success===true){this.hideForm();this.resetFormValues();if(c.action==="addguestcomment"){var d=jQuery('<div class="ignoremeforgood">'+c.content+"</div>");jQuery(".metatext",d).html('<span class="msghighlited">(Comment Pending. Please check your email for a verification link.)</span>');c.content=d.html();this.login_state="loggedout:idle"}this.raiseEvent("threads.insertcomment",{comment:c});if(c.message!==undefined){Message.showMessage(c.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}else{if(c.message!==undefined){Message.showMessage(c.message,this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}}Debug.log({mode:"AJAX",url:"op:addcomment-ajaxsuccess",options:{data:c}});break;case"editcomment":if(c.success){this.raiseEvent("threads.replacecomment",{comment:c});this.raiseEvent("commentform.close",{});this.resetFormValues();this.setMode()}else{Message.showMessage("Comment edit failed",this.controls.message[0],{stable:false,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)})}break}},handleAjaxFail:function(c){this.controls.indicator.hide();this.controls.submit.attr("disabled","");this.controls.cancel.attr("disabled","");Message.showMessage("Comment save failed",this.controls.message[0],{stable:false,duration:3000,onShow:function(){this.controls.message.show()}.bind(this),onComplete:function(){this.controls.message.hide()}.bind(this)});Debug.log({mode:"AJAX",url:"op:addcomment-ajaxfail",options:{data:arguments}})},handleCancel:function(c){var d=this.controls.comment_id.val();this.resetFormValues();this.setMode();this.raiseEvent("commentform.close",{refresh_thread:false,comment_id:d});this.raiseEvent("commentform.cancel",{comment_id:d});c.stopPropagation();c.preventDefault()},handleSwitchTab:function(c){if(this.controls.expandedform.is(":visible")===false){this.expandForm(true)}var d=this.getParam("t",c.target);this.switchtab(d,true);this.validator.hideErrors();jQuery("#comment_validation_error_message").removeClass("show_text show_image show_video");jQuery("#comment_validation_error_message").addClass("show_"+d);c.stopPropagation();c.preventDefault()},handleImagePreview:function(c){return false},handleVideoPreview:function(c){return false},expandForm:function(c){if(c){this.controls.expandedform.show();this.element.addClass("opened")}else{this.controls.expandedform.hide();this.controls.image_upload_external.hide();this.element.removeClass("opened")}},openForm:function(c){this.element.fadeIn("normal",function(){this.switchtab(this.commentMode,null,c)}.bind(this))},hideForm:function(d){if(this.mode=="postform"){var c=jQuery(".postform_container");if(c.length>0){c.append(this.element)}else{this.element.hide()}if(d!==undefined){jQuery(".cid_"+d).show()}}else{this.element.hide();this.resetFormValues();jQuery(".commentform_container").append(this.element)}},switchtab:function(f,e,c){if(false&&e){var d=false;
jQuery(this.options.fields).each(function(g,h){var j=this.controls[h].val();if(this.controls[h].is("SELECT")!==true&&j!==""){d=true}}.bind(this));if(d){if(!window.confirm("Unsaved changes, do you want to clear data?")){return false}}}this.controls.mode.val(f);jQuery(".tabs li").removeClass("selected");jQuery(".tabs li.t_"+f).addClass("selected");jQuery(".tabs li.t_"+f).closest(".form_part").removeClass("pf_text pf_image pf_video pf_quote").addClass("pf_"+f);jQuery(["tab","extension"]).each(function(g,h){jQuery("."+h+"").hide();jQuery("."+h+".t_"+f).show()});if(jQuery("textarea:visible, input:visible",this.element).get(0)&&!c){jQuery("textarea:visible, input:visible",this.element).get(0).focus()}this.controls.expandedform.removeClass("preview_shown")},resetFormValues:function(){var c=["parent_id","comment_id","entry","quote","image_file","image_url","image_format","image_upload","comment_id","video_url","quote_url","anonemailinput","anonnewsletter"];jQuery(c).each(jQuery.proxy(function(f,h){try{this.controls[h].val("")}catch(g){}},this));try{this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}catch(d){}},eventHandler:function(c){switch(c.name){case"commentform.open":this.commentMode="text";this.openWidget(c.params);break;case"commentform.setreplyto":this.setReplyto(c.params);break;case"commentform.setedit":this.setEdit(c.params);break;case"commentform.close":jQuery(".autogrow").remove();case"commentform.cancel":this.hideForm(c.params.comment_id);break;case"commentform.guestsubmit":this.setMode("guest",c.params);this.controls.postform.submit();break;case"commentform.guestcancel":this.setMode("normal",c.params);break}},postEventHandler:function(c){if(c.name=="maincontent.postloaded"||c.name=="maincontent.tagpageloaded"){this.mode="commentform";this.controls.root_id.val(c.params.data.originalPostId);this.controls.sitetag.val("")}},forumEventHandler:function(c){if(c.name=="maincontent.forumloaded"){this.mode="postform";this.controls.root_id.val(c.params.data.sitetag.id);this.controls.sitetag.val(c.params.data.sitetag.name);this.commentMode="text";this.openWidget({after:jQuery(".postform_container"),dont_expand_form:false})}},refreshWidget:function(){this.setControls();if(this.auth.authenticated&&this.auth.user.fb_uid){jQuery(".fbuser").show()}else{jQuery(".fbuser").hide()}},openWidget:function(d){var c=null;if(d.after!==undefined){c=d.after}else{c=jQuery(".input_box_place")}c.after(this.element);if(d.clear!==undefined&&d.clear===true){this.resetFormValues()}if(d.dont_expand_form===undefined||d.dont_expand_form!==true){this.expandForm(true);this.openForm(d.nofocus)}else{this.expandForm(false)}this.openForm(d.nofocus);this.controls.entry.autogrow();this.raiseEvent("commentform.opened",{})},setReplyto:function(c){this.controls.parent_id.val(c.replyto);this.controls.comment_id.val("");this.controls.entry.get(0).focus()},setEdit:function(c){var d=new XHR({klass:"getcomment",beforeSend:function(){},error:function(){},success:function(f){if(f.success===true){if(f.comment_text.indexOf('class="commentImage"')>-1){this.commentMode="image"}else{if(f.comment_text.indexOf('class="youtube-player"')>-1){this.commentMode="video"}else{this.commentMode="text"}}this.setMode("edit",{comment:f});var g=jQuery(".cid_"+f.comment_id).hide();this.openWidget({after:g,dont_expand_form:false,clear:false})}else{var e=jQuery(".cid_"+f.comment_id+" .please_leave_a_message");Message.showMessage("Comment read failed",e.get(0),{stable:false})}}.bind(this)});d.send("/index.php",{op:"ajax_getcomment",id:c.comment_id})},setMode:function(f,d){switch(f){case"guest":this.controls.op.val("addguestcomment");this.login_state="guest:submit";this.controls.anonemailinput.val(d.email);this.controls.anonnewsletter.val(d.newsletter);break;case"author":this.controls.op.val("postauthorcomment");break;case"edit":this.controls.op.val("editcomment");this.controls.comment_id.val(d.comment.comment_id);this.controls.parent_id.val(d.comment.parent_id);this.controls.entry.val(d.comment.original_text);var e=d.comment.comment_text.match(/embed\/(.*?)"/);if((e!=null)&&(this.commentMode=="video")){this.controls.video_url.val("http://youtube.com/watch?v="+e[1])}else{var c=d.comment.comment_text.match(/img src="(.*?)"/);if(c!=null&&(this.commentMode=="image")){this.controls.image_url.val(c[1])}}break;default:this.controls.op.val("addcomment");this.controls.anonemailinput.val("");this.controls.anonnewsletter.val("");break}},showFormUser:function(){if(this.auth.authenticated){var c=22;var d=this.auth.user.smartName;if(this.auth.user.smartName.length>c){d=this.auth.user.smartName.substr(0,c)+"..."}this.controls.author_link.attr({href:"/people/"+this.auth.user.username});this.controls.author_link.text(d).show();this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/"+this.auth.user.avatarPath+"_32.jpg"}).show()}},hideFormUser:function(){this.controls.author_link.attr({href:"#"}).hide();this.controls.author_link.text("").hide();
this.controls.author_image.attr({src:"http://cache.gawkerassets.com/assets/images/commenter/noimage.gif"}).hide()},setImageUploadForm:function(c){c.stopPropagation();c.preventDefault();this.controls.image_url_wrap.hide();this.controls.image_upload_wrap.show();this.controls.fileuploadform.fileUpload({namespace:"comment_image_upload",url:"/index.php",method:"POST",fieldName:"image_upload",formData:{op:"comment_image_upload"},multiFileRequest:false,initUpload:function(g,f,d,j,e,h){this.controls.image_upload_result.html("please wait");h()}.bind(this),onLoad:function(h,g,d,j,f){if(j.statusText=="OK"){var e=jQuery.parseJSON(j.responseText);if(e.success===true){this.controls.image_file.val(e.path);this.controls.image_format.val(e.format);Message.showMessage("Image uploaded",this.controls.image_upload_result[0],{stable:false,onComplete:function(){this.controls.image_upload_result.html('<a href="'+e.thumb+'" target="_new">View image</a>')}.bind(this)})}else{this.controls.image_file.val("");this.controls.image_upload_result.html("");if(e.message!==undefined){Message.showMessage(e.message,this.controls.image_upload_result[0],{stable:false})}}}}.bind(this)})},setImageUrlForm:function(c){c.stopPropagation();c.preventDefault();this.controls.image_upload_wrap.hide();this.controls.image_url_wrap.show();this.controls.fileuploadform.fileUpload("destroy","comment_image_upload")}});b.widget("ui.CommentFormWidget",a);b.extend(b.ui.CommentFormWidget,{version:"1.0",defaults:{onHide:{},onShow:{},onReset:{},controlClass:"pfc",externalElement:"",show_validation_errors:true}})})(jQuery);(function(a){a.widget("ui.CommenterWidget",{initialize:function(){this.xhr=new XHR({klass:"commenter",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("threads.threadloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("threads.listloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this))},eventThreadLoadedHandler:function(b){this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons()},eventAuthHandler:function(b){this.showIcons()},handleClick:function(d){var c=jQuery(d.target);var f=this.getParam("cn",c);var b=this.getParam("bid",c);switch(f){case"buddy":this.toggleBuddy(b);d.stopPropagation();d.preventDefault();break;case"ffbox_toggle":this.toggleFriendsBox();d.stopPropagation();d.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(d){switch(d.action){case"saveusertag":if(d.objectId!==undefined){this.controls.buddy.filter(".bid_"+d.objectId+".inprogress").removeClass("inprogress")}if(d.success===true){if(d.command=="tag"){this.auth.user.buddies.push(d.objectId)}else{var b=this.auth.user.buddies.indexOf(d.objectId);var e=[];for(var c=0;c<this.auth.user.buddies.length;c++){if(c!=b){e.push(this.auth.user.buddies[c])}}this.auth.user.buddies=e}this.auth.resetRevision();this.showIcons()}break;case"ajax_buddylist":this.controls.ffbox_placeholder.html(d.content).slideDown();this.eventThreadLoadedHandler({});break}},ajaxFailHandler:function(b){this.controls.buddy.filter(".inprogress").removeClass("inprogress")},showIcons:function(){if(this.controls.buddy===undefined){return false}if(this.auth.authenticated){this.controls.buddy.show()}else{this.controls.buddy.hide();return false}this.controls.buddy.removeClass("buddy_true");var b=null;this.controls.buddy.each(function(c,d){b=this.getParam("bid",d);if(this.auth.user.buddies!==undefined&&this.auth.user.buddies.indexOf(b)!==-1){jQuery(d).addClass("buddy_true")}}.bind(this))},toggleBuddy:function(c){var b={op:"saveusertag",objectType:"USER",objectId:c};if(jQuery.inArray(c,this.auth.user.buddies)===-1){b.tagName="buddy"}else{b.unTagName="buddy"}this.controls.buddy.filter(".bid_"+c).addClass("inprogress");this.xhr.send(this.options.action_url,b)},toggleFriendsBox:function(){if(this.controls.ffbox_wrapper.hasClass("opened")){this.controls.ffbox_placeholder.slideUp("fast");this.controls.ffbox_wrapper.removeClass("opened")}else{this.controls.ffbox_wrapper.addClass("opened");if(this.controls.ffbox_placeholder.html()===""){var b=this.getParam("userid",this.controls.ffbox_wrapper);var c={op:"ajax_buddylist",user_id:b};this.xhr.send(this.options.action_url,c)}else{this.controls.ffbox_placeholder.slideDown()}}}});a.extend(a.ui.CommenterWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cw",externalElement:"#comments, .user-profile, .biguserlist, .userlist"}})})(jQuery);(function(a){a.widget("ui.CommenterAdminWidget",{controls:{},has_admin_rights:false,initialize:function(){this.xhr=new XHR({klass:"commenteradmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});
this.subscribeForEvent("commenteradmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("maincontent.profilepageloaded",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(b){switch(b.name){case"commenteradmin.setstar":this.setStarStatus({commenter_id:b.params.commenter_id,star:b.params.star,comment_id:b.params.comment_id});break;case"commenteradmin.starset":this.userStarredHandler(b.params);break;case"commenteradmin.changestate":this.setUserState({commenter_id:b.params.commenter_id,state:b.params.state,comment_id:b.params.comment_id});break;case"commenteradmin.statechanged":this.userStateChangeHandler(b.params);break}},eventThreadLoadedHandler:function(b){if(b.name==="threads.listloaded"||b.name==="maincontent.profilepageloaded"){this.loadControls()}},eventAuthHandler:function(b){this.setUserRights()},handleClick:function(f){var d=jQuery(f.target);var j=this.getParam("cn",d);var h=d.closest(".comment");var g=this.getParam("aid",h);var c=this.getParam("cid",h);if(!this.has_admin_rights){f.stopPropagation();f.preventDefault();return false}switch(j){case"approveuser":this.raiseEvent("commenteradmin.changestate",{commenter_id:g,state:"approve",comment_id:c});jQuery(".admin_links",h).hide();f.stopPropagation();f.preventDefault();break;case"togglestar":var b=(this.getParam("s",d)=="t")?true:false;this.raiseEvent("commenteradmin.setstar",{commenter_id:g,star:b,comment_id:c});f.stopPropagation();f.preventDefault();break;case"adminpage":document.location="/index.php?op=userlist_search&id="+g+"&siteId="+siteConfig.id;jQuery(".admin_links",h).hide();f.stopPropagation();f.preventDefault();break;case"toggleadminlinks":jQuery(".admin_links",h).toggle();f.stopPropagation();f.preventDefault();break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(b){var c={};switch(b.action){case"setstarcommenter":if(b.success===true){c={commenter_id:b.commenterId,comment_id:b.commentId,star:b.starcommenter};this.raiseEvent("commenteradmin.starset",c)}break;case"approveuser":if(b.success===true){c={commenter_id:b.commenterId,comment_id:b.commentId,state:b.action.slice(0,-4)};this.raiseEvent("commenteradmin.statechanged",c)}break}},ajaxFailHandler:function(b){},setUserRights:function(){if(!this.auth.authenticated||!this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar.s_t").css({display:"none"});this.has_admin_rights=false}else{if(this.auth.hasLevel("commentadmins")){this.element.find(".cn_togglestar").css({display:"block"});this.has_admin_rights=true}}this.element.find(".cn_togglestar.ts_b").removeClass("s_b");if(this.auth.authenticated&&this.auth.hasLevel("superusers")){this.element.find(".cn_togglestar.ts_b").addClass("s_b")}},loadControls:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.setUserRights()},setStarStatus:function(c){if(typeof c!=="object"||c.commenter_id===undefined){return false}if(c.star===undefined){c.star=true}var b={op:"setstarcommenter",id:c.commenter_id,starcommenter:c.star,cid:c.comment_id,siteId:siteConfig.id};this.xhr.send(this.options.action_url,b)},userStarredHandler:function(b){if(typeof b!=="object"||b.commenter_id===undefined){return false}if(b.star===true){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_t").addClass("s_f")}else{if(b.star===false){this.element.find(".aid_"+b.commenter_id+" .cn_togglestar").removeClass("s_f").addClass("s_t")}}this.raiseEvent("threadadmin.priorityset",{comment_id:b.comment_id,priority:(b.starcommenter===true)?0:1});this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"starredBy",message:"%user starred by %another user"})},setUserState:function(c){if(typeof c!=="object"||c.commenter_id===undefined){return false}var b={op:"changeuserstatus",action:"approve",id:c.commenter_id,siteId:siteConfig.id,commentId:c.comment_id,reloadGroups:true};this.xhr.send(this.options.action_url,b)},userStateChangeHandler:function(b){this.element.find(".aid_"+b.commenter_id+".us_pending").removeClass("us_pending");this.raiseEvent("threadadmin.commentapproved",{comment_id:b.comment_id});this.raiseEvent("threadadmin.messageadd",{comment_id:b.comment_id,type:"approvedBy",message:"%user approved by %another user"})}});a.extend(a.ui.CommenterAdminWidget,{version:"2.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"cra",externalElement:"#comments, .postlist, .profile-header"}})})(jQuery);(function(b){var a="HyperionAd_1x1_sponsored";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,stepToLoadZones:function(){this.nowOrLater(jQuery.proxy(this.canLoadZones,this),jQuery.proxy(this.loadZones,this),["hyperion.emailalerts.loaded","ad.sp."+this.options.post_id+".show"])
},canLoadZones:function(){return b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments)&&window.adRobot.isSpShown(this.options.post_id)===true},shower:function(){}}))}(jQuery));(function(b){var a="HyperionAd_300x250_footer";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,initialize:function(){b("#ad_placeholder_300x250_footer").append(b(this.element)).show();b.ui.HyperionAd.prototype.initialize.apply(this,arguments)},canLoadZones:function(){var c=false;if(window.adRobot.permalink300ShouldLoad()===false){this.setStatus("cancelled in favor of panorama")}else{c=b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments)}return c},onShow:function(){b("#sitetags .site").eq(2).addClass("first")}}))}(jQuery));(function(b){var a="HyperionAd_300x250_inpost";b.widget("ui."+a,b.extend({},b.ui.HyperionAd_ForeplayTriggered.prototype,{name:a,refreshOn:["gallery.image.changed"]}))}(jQuery));(function(b){var a="HyperionAd_300x250_rightbar";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,refreshOn:["gallery.image.changed"],reRunOnLoad:1500,debug:false,canLoadZones:function(){var c=false;if(this.options.sponsored===true){this.hideAd();this.setStatus("skipped")}else{c=b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments)}this.debugLog("canLoadZones",c);return c},stepToRender:function(){if(window.adRobot.marquee_cancelled===true){b.ui.HyperionAd.prototype.stepToRender.apply(this,arguments)}else{setTimeout(jQuery.proxy(function(){b.ui.HyperionAd.prototype.stepToRender.apply(this,arguments)},this),2000)}},stepToShowAd:function(){this.nowOrLater(jQuery.proxy(this.canShowAd,this),jQuery.proxy(this.showAd,this),["ad.marquee.finish","ad.marquee.cancel"])},canShowAd:function(){var c=(window.adRobot.marquee_cancelled===true||window.adRobot.marquee_finished===true||this.hyperion.GanjaConnector.emailAlerts.length>0);this.debugLog("canShowAd",c);return c},onShow:function(){jQuery("#tomorrowsnews").hide();if(window.navigator.userAgent.match(/iPad/i)===null){jQuery(this.options.target_selector).hover(function(){jQuery("#rightcontainer").css({zIndex:20001});jQuery(".wrap, #rightcontainer .scrollwrap").css({overflow:"visible"})},function(){jQuery("#rightcontainer").css({zIndex:1952});jQuery(".wrap").css({overflow:"auto"});jQuery("#rightcontainer .scrollwrap").css({overflow:"hidden"})})}},onHide:function(){jQuery("#tomorrowsnews").show()},isEmpty:function(){if(window.adRobot.has_marquee===true){this.addAdInfo("empty_ad","marquee exists, should be false");return false}else{return b.ui.HyperionAd.prototype.isEmpty.apply(this,arguments)}}}))}(jQuery));(function(b){var a="HyperionAd_300x600_inpost";b.widget("ui."+a,b.extend({},b.ui.HyperionAd_ForeplayTriggered.prototype,{name:a,refreshOn:["gallery.image.changed"],onHide:function(){if(this.options.original_size!=="300x250"){this.element.find("iframe").attr({width:300,height:250}).contents().empty();this.options.iframe_attributes.height=250;this.options.original_size="300x250";this.options.dart_params=window.adRobot.getDartParams(this.options.original_size,this.options.variant);this.iteration+=1;this.loadZones()}}}))}(jQuery));(function(b){var a="HyperionAd_640x360_blogview";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,stepToLoadZones:function(){this.nowOrLater(jQuery.proxy(this.canLoadZones,this),jQuery.proxy(this.loadZones,this),["hyperion.emailalerts.loaded","ad.adrobot.skin.ready"])},canLoadZones:function(){return b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments)&&this.hyperion.GanjaConnector.hasSkin!==null},getDartScriptParams:function(){if(this.hyperion.GanjaConnector.hasSkin===true){this.options.dart_params=this.hyperion.ZoneHelper.getDartParams(this.options.original_size,this.options.variant,5)}return b.ui.HyperionAd.prototype.getDartScriptParams.apply(this,arguments)}}))}(jQuery));(function(b){var a="HyperionAd_640x360_footer";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,canLoadZones:function(){var c=false;if(window.adRobot.permalinkPanoShouldLoad()===false){this.setStatus("cancelled in favor of 300x250")}else{c=b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments)}return c}}))}(jQuery));(function(b){var a="HyperionAd_660x300_default";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,timer:null,runtime:10,secondsLeft:0,startDelay:2000,finishDelay:2000,isStopped:true,isFinished:false,autoFinish:false,$countDown:null,cookieWasOk:false,initialize:function(){this.cookieWasOk=this.checkCookie();jQuery(document).bind("ad.foreplay.init",jQuery.proxy(this.init,this));jQuery(document).bind("ad.foreplay.start",jQuery.proxy(this.start,this));jQuery(document).bind("ad.foreplay.showSkip",jQuery.proxy(this.showSkip,this));jQuery(document).bind("ad.foreplay.stop",jQuery.proxy(this.stop,this));jQuery(document).bind("ad.foreplay.finish",jQuery.proxy(this.finish,this));jQuery(document).bind("ad.foreplay.setTimer",jQuery.proxy(this.setTimer,this));jQuery(document).bind("ad.foreplay.abort",jQuery.proxy(this.abort,this));
b.ui.HyperionAd.prototype.initialize.apply(this,arguments)},canLoadZones:function(){var c=b.ui.HyperionAd.prototype.canLoadZones.apply(this,arguments);if(this.cookieWasOk!==true){this.hideAd();this.setStatus("skipped");c=false}return c},checkCookie:function(){var d=jQuery.cookie("foreplay_count"),c=false;if(this.options.foreplay_frequency>0){if(d!==null){d=parseInt(d,10);if(d>=(this.options.foreplay_frequency-1)){c=true;d=0}else{d+=1}}else{d=(this.options.foreplay_frequency-1)}}jQuery.cookie("foreplay_count",d,{path:"/"});return c},countdown:function(){this.$countDown.html(this.secondsLeft+" second"+(this.secondsLeft>1?"s":""));if(!this.iStopped&&(this.secondsLeft>0)){this.secondsLeft-=1}if(this.secondsLeft===0&&this.autoFinish===true){this.finished()}if(!this.isFinished){this.timer=window.setTimeout(jQuery.proxy(function(){this.countdown()},this),1000)}},init:function(c,d){if(this.timer!==null){window.clearTimeout(this.timer)}this.autoFinish=d.auto_finish;this.setTimer(null,d.runtime);this.isFinished=false;this.$countDown=jQuery(".foreplay_countdown");if((d.auto_start===undefined||d.auto_start==="true")&&this.isFinished!==true){this.start()}jQuery("body").addClass("foreplayed");jQuery("#foreplay_skip button").bind("click",jQuery.proxy(function(){this.finish()},this))},start:function(){this.isStopped=false;this.secondsLeft=this.runtime;this.countdown();if(this.browser==="ie"){jQuery("#foreplay_countdown_container, #foreplay_bottom_info, #bannercontainer").css("opacity",1)}else{jQuery("#foreplay_countdown_container, #foreplay_bottom_info, #bannercontainer").animate({opacity:1},500)}jQuery(document).trigger("ad.foreplay.started")},showSkip:function(){jQuery("#foreplay_skip").show()},stop:function(){this.isStopped=true;jQuery(document).trigger("ad.foreplay.stopped")},finish:function(){if(this.isFinished===false){window.setTimeout(jQuery.proxy(function(){jQuery("#foreplay_countdown_container").remove();jQuery(document).trigger("ad.foreplay.finished");jQuery("body").removeClass("foreplayed");this.hideAd()},this),this.finishDelay);this.isFinished=true}},setTimer:function(d,c){c+=Math.floor(this.finishDelay/1000);this.runtime=c;if(this.stopped===false){this.secondsLeft=c}},abort:function(){if(this.timer!==null){window.clearTimeout(this.timer)}jQuery("#foreplay_countdown_container").remove();jQuery("body").removeClass("foreplayed");window.adRobot.isForeplayRunning=false},shower:function(){if(jQuery.browser.safari){jQuery(this.options.target_selector).fadeIn("slow")}else{jQuery(this.options.target_selector).slideDown("slow")}},onShow:function(){window.adRobot.isForeplayRunning=true;jQuery.cookie("foreplay_shown","true",{expires:(24*60*60),path:"/"});jQuery("#foreplay_bottom").show()},hider:function(){jQuery(this.options.target_selector).slideUp("slow")},onHide:function(){window.adRobot.isForeplayRunning=false;jQuery("#foreplay_bottom").hide();jQuery(document).trigger("ad.inpost300.refresh")}}))}(jQuery));(function(b){var a="HyperionAd_80x45_default";b.widget("ui."+a,b.extend({},b.ui.HyperionAd.prototype,{name:a,keywordsEnabled:false,onShow:function(){var c=jQuery(this.element);c.closest("li").hover(function(){var e=jQuery(this).height();jQuery(this).height(e+"px");jQuery(".thumbLink",jQuery(this)).hide();jQuery(".stamp_container",jQuery(this)).show()},function(){jQuery(".thumbLink",jQuery(this)).show();jQuery(".stamp_container",jQuery(this)).hide()}).css({"min-height":"60px"});var d=c.find("img").attr("alt");if(d!=="Click here to find out more!"){jQuery(".broughtby",c.closest(".text")).html(d)}},stepToRender:function(){if(this.hyperion.AdStats.get("80x45",this.adZone)<4){this.hyperion.AdStats.add("80x45",this.adZone);this.render()}else{this.setStatus("skipped")}}}))}(jQuery));(function(a){a.widget("ui.Marquee",{marquee_running:false,image_counter:0,finishedevent:null,initialize:function(){this.finishedevent=jQuery.proxy(this.marqueeFinished,this);jQuery(document).bind("ad.marquee.run",jQuery.proxy(this.runMarquee,this));jQuery(document).bind("ad.marquee.run",jQuery.proxy(this.runTrackers,this));jQuery(document).bind("ad.marquee.reset",jQuery.proxy(this.reset,this));this.subscribeForEvent("maincontent.load",jQuery.proxy(this.reset,this));if(window.adRobot.marquee_config){jQuery(document).trigger("ad.marquee.run")}},runMarquee:function(c){var b=window.adRobot.marquee_config;if(b.marquee_should_run===true){this.marquee_running=true;window.adRobot.marquee_running=true;jQuery("body").addClass("marqueed");jQuery(".ad_marquee").show();this.injectMarquee();if(b.frequency_limit_on===true){if(b.frequency!==undefined&&b.frequency>0){jQuery.cookie("marquee_shown_"+b.view_name,"a-ok",{expires:(b.frequency/24),path:"/"})}}jQuery(document).bind("ad.marquee.finished",this.finishedevent);jQuery("#marquee-frame").css({height:b.height+"px",width:b.width+"px"}).show();if(b.width>640){jQuery("#rightcontainer").css({zIndex:1897})}}else{window.adRobot.cancelMarquee();jQuery(".marqueed").removeClass("marqueed")}},runTrackers:function(b){this.triggerTracker("marquee");
this.triggerTracker("takeover")},reset:function(b){this.marquee_running=false;window.adRobot.marquee_running=false;jQuery(".ad_marquee").hide();jQuery(".marqueed").removeClass("marqueed");jQuery(document).unbind("ad.marquee.finished",this.finishedevent);this.showIllustration()},triggerTracker:function(b){var d=jQuery(".ad_container."+b);if(d.length){var c=d.attr("id").replace("ad_container_","");window.adRobot.runAdFromQueue(c)}},imageLoaded:function(){jQuery("#marquee_image").fadeIn("fast",function(){setTimeout(function(){jQuery("#marquee_image").fadeOut("fast",function(){marquee_finished()})},6000)})},injectMarquee:function(){var c=window.adRobot.marquee_config;if(c.is_ipad===true){var b=jQuery("<a>").attr({href:c.link,target:"_blank"});var d=jQuery("<img/>").attr({id:"marquee_image",src:c.image,width:c.width,height:c.height}).bind("load",jQuery.proxy(this.imageLoaded,this)).appendTo(b);b.appendTo(jQuery("#marquee-frame"))}else{AC_FL_RunContent("codebase","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0","width",c.width,"height",c.height,"src",c.swfFile,"quality","high","pluginspage","http://www.adobe.com/go/getflashplayer","align","middle","play","true","loop","true","scale","showall","wmode","transparent","devicefont","false","id","RSSTicker_gawker","bgcolor","transparent","name","RSSTicker_gawker","menu","true","allowFullScreen","false","allowScriptAccess","always","movie",c.swfFile,"salign","","insertinto",jQuery("#marquee-frame").attr("id"),"rev",c.rev)}},marqueeFinished:function(c,b){if(b!==undefined&&b.force!==undefined&&b.force===true){this.showIllustration(true)}else{this.showIllustration()}jQuery("#rightcontainer").css({zIndex:1952});jQuery(document).unbind("ad.marquee.finished",this.finishedevent)},showIllustration:function(b){if(b===true||this.marquee_running===false){this.marquee_running=false;jQuery(".ad_marquee").hide();jQuery("object, iframe",jQuery("#aboveheadlinevideo, #topvideo")).show();jQuery(".marqueed").removeClass("marqueed")}}});a.extend(a.ui.Marquee,{version:"1.0",defaults:{controlClass:"mc"}})}(jQuery));function marqueeCalled(){var a=window.adRobot.marquee_config;var b=function(){jQuery("object, iframe",jQuery("#aboveheadlinevideo, #topvideo")).show();jQuery(".marqueed").removeClass("marqueed")};if(a.load_splash===true){if(a.splash_delay>0){window.setTimeout(b,a.splash_delay)}else{b()}}}function marquee_finished(){window.adRobot.marquee_running=false;window.adRobot.marquee_finished=true;window.adRobot.marquee_config.marquee_config=false;window.adRobot.marquee_config.marquee_should_run=false;jQuery(document).trigger("ad.marquee.finished",{force:true});jQuery(document).trigger("ad.marquee.finish")}function closeExpandedAd(){}(function(a){a.widget("ui.MessagingWidget",{controls:{},initialize:function(){this.subscribeForEvent("maincontent.profilepageloaded",this.eventPageLoadedHandler.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));this.xhr=new XHR({klass:"messaging",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,{op:"postmessage",messageText:this.controls.text.val(),attachedObjId:this.controls.attachedObjId.val(),sentToId:this.controls.sentToId.val(),status:((this.controls.public_message.get(0).checked)?"PUBLIC":"PRIVATE")})}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(f){var d=jQuery(f.target);var h=this.getParam("cn",d);switch(h){case"openform":this.controls.form.slideDown("fast");f.preventDefault();f.stopPropagation();break;case"cancel":this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()},this));f.preventDefault();f.stopPropagation();break;case"submit":this.controls.form.submit();f.preventDefault();f.stopPropagation();break;case"delete":var b=jQuery(f.target).data("messageid");if(b===undefined){break}this.deleteMessage(b);f.preventDefault();f.stopPropagation();break;case"reply":f.preventDefault();f.stopPropagation();var c=jQuery(f.target).data("replyid");var g=jQuery(f.target).data("replyuserid");if(c===undefined||g===undefined){break}jQuery("#message_"+c+" .form_place").after(this.controls.form);this.controls.attachedObjId.val(c);this.controls.sentToId.val(g);this.controls.form.slideDown("fast");break}},eventPageLoadedHandler:function(b){this.resetElements();this.setControls();this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},handleAjaxRequest:function(){this.controls.indicator.show()},handleAjaxSuccess:function(c){switch(c.action){case"postmessage":if(c.success===true){Message.showMessage("Message sent.",this.controls.message[0],{stable:false,onComplete:function(){this.controls.form.slideUp("fast",jQuery.proxy(function(){this.resetForm()
},this))}.bind(this)})}this.controls.indicator.hide();break;case"changemessagestatus":if(c.success===true){var b=jQuery("#message_"+c.messageId);jQuery(".icon_progress",b).show();Message.showMessage("Post deleted",jQuery(".messagetext",b).get(0),{stable:false,onComplete:function(){b.next("hr").remove();b.remove()}.bind(this,b)})}break}},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide()},authEventHandler:function(b){if(this.auth.authenticated){this.controls.openform.show()}else{this.controls.openform.hide()}},resetForm:function(){this.controls.text.val("");this.controls.attachedObjId.val("");this.controls.public_message.get(0).checked=false;this.controls.form_default_place.after(this.controls.form)},deleteMessage:function(c){var b={op:"changemessagestatus",publishStatus:"DELETED",id:c};if(window.confirm("Are you sure you want to delete this message?")){jQuery("#message_"+c+" .icon_progress").show();this.xhr.send(this.options.action_url,b)}}});a.extend(a.ui.MessagingWidget,{version:"0.1",defaults:{action_url:"/index.php",controlClass:"mw",externalElement:".commenter_messaging_external, .commenter_tools, .userlist"}})})(jQuery);(function(a){a.widget("ui.PostStatusToggler",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"post_status_toggler",success:this.promoteSuccess.bind(this),error:this.ajaxFailure.bind(this)});this.registerEventHandler(this.element,"click",this.handleStatusToggleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.showWidget();break;case"user.auth.failure":this.hideWidget();break}},handleStatusToggleClick:function(c){var b=jQuery("a",c.target);if(b.hasClass(this.options.classes.promote)){c.stopPropagation();c.preventDefault();this.promoteItem(b.parent())}else{if(b.hasClass(this.options.classes.demote)){c.stopPropagation();c.preventDefault();this.demoteItem(b.parent())}else{if(b.hasClass(this.options.classes.sitetag)){c.stopPropagation();c.preventDefault();this.removeSiteTag(b.parent())}}}},getPostInfo:function(d,b){var c={el:d,id:this.getParam(this.options.prefixes["postid"],d)};if(b){c.realm=this.getParam(this.options.prefixes["postrealm"],d)}else{c.issued=this.getParam(this.options.prefixes["postissued"],d)}c.message=jQuery(".cn_message",d.parent());c.indicator=jQuery(".cn_indicator",d.parent());return c},promoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="demote";this.context.removeclass="promote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"PUBLISHED",realm:this.context.realm})},demoteItem:function(b){this.context=this.getPostInfo(b,true);this.context.addclass="promote";this.context.removeclass="demote";this.context.indicator.show();this.xhr.send(this.options.promote_url,{id:this.context.id,publishStatus:"REVIEWED",realm:this.context.realm})},removeSiteTag:function(b){this.context=this.getPostInfo(b,false);this.context.addclass="removesitetag";this.context.removeclass="addsitetag";this.context.indicator.show();this.xhr.send(this.options.sitetag_url,{postId:this.context.id,postIssued:this.context.issued})},promoteSuccess:function(c){this.context.indicator.hide();Message.showMessage(c.message,this.context.message[0]);var b=jQuery("a",this.context.el);if(c.deleted){var d=jQuery("#id_"+c.id+"_"+c.issued);window.setTimeout(function(){d.hide()},3000)}if(c.success){b.removeClass(this.options.classes[this.context.removeclass]);b.addClass(this.options.classes[this.context.addclass]);b.attr("title",this.options.titles[this.context.addclass]);b.attr("alt",this.options.titles[this.context.addclass])}},ajaxFailure:function(){this.context.indicator.hide();Message.showMessage("Network problem has occured.",this.context.message[0])},showWidget:function(){if(this.auth.user&&this.auth.hasLevel("editors")&&typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.show()}},hideWidget:function(){if(typeof this.controls.actionbutton!="undefined"){this.controls.actionbutton.hide()}}});a.extend(a.ui.PostStatusToggler,{version:"1.0",defaults:{controlClass:"pstcontrol",classes:{promote:"doPromote",demote:"doDemote",sitetag:"doRemoveSiteTag",removesitetag:"deleteButton",addsitetag:"addButton"},prefixes:{postid:"tpid",postissued:"tpissued",postrealm:"tprealm"},titles:{promote:"Promote this post",demote:"Demote this post",addsitetag:"Add this crosspromoted post to this site",removesitetag:"Remove this crosspromoted post from this site"},promote_url:"/index.php?op=changepoststatus",sitetag_url:"/index.php?op=removesitetag"}})})(jQuery);(function(a){a.widget("ui.SandboxWidget",{initialize:function(b){this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));this.subscribeForEvent("maincontent.postloaded",(function(c){return function(d){c.setControls()}})(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))
},handleClicks:function(c){var b=this.getParam("cn",c.target);if(b=="ssousermigrate_link"){c.stopPropagation();c.preventDefault();this.commondialogs.toggleDialog({which:"ssousermigrate"})}},authEventHandler:function(d){a(".sandboxMsg").hide();if(d.name=="user.auth.failure"){a(".sandboxMsg.sandboxLoginLabel").show()}else{if(d.name=="user.auth.success"){var c=false;if(this.auth.user.aka!==undefined&&this.auth.user.aka!==null&&this.auth.user.aka.length>0){for(var b=0;b<this.auth.user.aka.length;b++){if(this.auth.user.aka[b].authApp=="ZAP"){c=true}}}if(!c){a(".sandboxMsg.sandboxConvertLabel").show()}}}if(window.Powwow!==undefined){Powwow.loadUser()}}});a.extend(a.ui.SandboxWidget,{version:"1.0",defaults:{controlClass:"sb_control"}})})(jQuery);(function(a){a.widget("ui.SearchFormWidget",{initialize:function(){if(this.controls.q[0].value==""){this.controls.q[0].value=this.options.defaultValue;this.controls.q.addClass("noq")}this.xhr=new XHR({klass:"search",success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.registerEventHandler(this.controls.form[0],"submit",this.handleSubmit.bind(this));if(this.controls.submit!==undefined){this.registerEventHandler(this.controls.submit[0],"click",this.handleSubmit.bind(this))}this.registerEventHandler(this.controls.q[0],"focus",this.inputFocus.bind(this));this.registerEventHandler(this.controls.q[0],"blur",this.inputBlur.bind(this));this.subscribeForEvent("searchform.searchFinished",this.searchFinished.bind(this));this.subscribeForEvent("searchform.searchFailed",this.searchFailed.bind(this));this.selectFilter("filter","all");this.selectFilter("sort","date");this.searchRunning=false},selectFilter:function(b,c){if(this.searchRunning){return false}jQuery(".searchControl.cn_"+b).removeClass("selected");jQuery(".searchControl.cn_"+b+".cn_"+b+"_"+c).addClass("selected");var d=this.controls.q.val();if(d!=""&&d.toLowerCase()!="search"){this.handleSubmit()}},handleClick:function(c){var b=jQuery(c.target);if(b.hasClass("cn_filter")){this.selectFilter("filter",this.getModifier(b,"filter"));c.preventDefault()}if(b.hasClass("cn_sort")){this.selectFilter("sort",this.getModifier(b,"sort"));c.preventDefault()}},getModifier:function(e,d){var h={filter:"all",sort:"date"};var g=h[d];var c=e.attr("class");if(c!==undefined){c=c.split(" ");var f="cn_"+d+"_";for(var b=0;b<c.length;b++){if(c[b].indexOf(f)==-1){continue}g=c[b].substr(f.length)}}return g},handleSubmit:function(f){Logger.debugLog("SearchFormWidget handleSubmit");this.controls.msg.hide();if(this.controls.q.val()==""){Message.showMessage("Please provide a search phrase.",this.controls.q[0],{stable:false})}else{var c=this.getModifier(jQuery(".searchControl.cn_filter.selected"),"filter");var b=this.getModifier(jQuery(".searchControl.cn_sort.selected"),"sort");this.controls.q.get(0).disabled=true;var d=this.controls.q.val();this.controls.q.val("Searching...");this.searchRunning=true;this.raiseEvent("navigation.searchInitiated",{q:d,filter:c,sort:b})}if(f!==undefined){f.preventDefault();f.stopPropagation()}return false},handleAjaxSuccess:function(b){},searchFinished:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val(b.params.q);if(b.params.nochange){return true}var c="";if(b.params.results>0){c=b.params.results+" post"+(b.params.results>1?"s":"")+' found for "'+b.params.q+'"'}else{c='Your search "'+b.params.q+'" did not match any posts'}this.controls.msg.html(c);this.controls.msg.show()},searchFailed:function(b){this.searchRunning=false;this.controls.q.get(0).disabled=false;this.controls.q.val("Search");this.controls.msg.html("Search failed, please try again later");this.controls.msg.show()},inputFocus:function(b){Logger.debugLog("SearchFormWidget inputFocus");if(this.controls.q[0].value==this.options.defaultValue){this.controls.q[0].value=""}this.controls.q.removeClass("noq");this.controls.msg.hide()},inputBlur:function(b){Logger.debugLog("SearchFormWidget inputBlur");if(this.controls.q[0].value==""){this.controls.q.addClass("noq");this.controls.q[0].value=this.options.defaultValue}}});a.extend(a.ui.SearchFormWidget,{version:"1.0",defaults:{controlClass:"searchControl",defaultValue:"Search"}})})(jQuery);jQuery.widget("ui.spongeclient",{timeout_handler:null,default_options:{sponge_host:"sponge.gawker.com:8093",sponge_api_version:"v1",version:"0.2",chartbeat_update_interval:60,sponge_update_intervals:[60,120,180,300,600],sponge_update_limit:20,catch_events:["maincontent.postloaded","maincontent.forumloaded","maincontent.frontpageloaded","maincontent.classicfrontpageloaded"]},add_commas:function(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2},_init:function(){for(var a in this.default_options){if(this.options[a]===undefined){this.options[a]=this.default_options[a]}}jQuery(window).bind("navigation.load",jQuery.proxy(function(b){this.hideWidget();if(this.timeout_handler!==null){clearTimeout(this.timeout_handler)
}},this));jQuery(window).bind(this.options.catch_events.join(" "),jQuery.proxy(function(b){if(this.active){this.getChartbeatData()}},this));this.debug=false;this.first=true;this.notificationSent=new Array();this.getLatestPost()},startNotifier:function(){this.getLatestPost();return"post notifier started"},getLatestPost:function(){if(typeof spongelatestpost!=="undefined"){return false}var a="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getLatestPost/?siteId="+notification_options.siteId;this.sponge_update_intervals=this.options.sponge_update_intervals.slice(0);this.sponge_update_count=0;this.xhr=jQuery.ajax({url:a,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongelatestpost",success:jQuery.proxy(function(c){var b=c.data.kinjalatestpost[notification_options.siteId];if(typeof b.postId!=="undefined"){this.latestPostId=c.data.kinjalatestpost[notification_options.siteId].postId;if(this.first&&this.debug){this.latestPostId=5885998;this.first=false}this.getNewPost()}else{if(typeof this.latestpost_timer!=="undefined"){window.clearTimeout(this.latestpost_timer)}this.latestpost_timer=setTimeout(jQuery.proxy(function(){this.getLatestPost()},this),(15*1000))}},this)})},refreshLatestPost:function(){if(typeof this.newpost_timer!=="undefined"){window.clearTimeout(this.newpost_timer)}if(typeof this.latestpost_timer!=="undefined"){window.clearTimeout(this.latestpost_timer)}this.latestpost_timer=setTimeout(jQuery.proxy(function(){this.getLatestPost()},this),(70*1000))},getNewPost:function(){if(typeof spongenewpost!=="undefined"){return false}var a="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getPostsSince/?siteId="+notification_options.siteId+"&postId="+this.latestPostId;this.xhr=jQuery.ajax({url:a,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongenewpost",success:jQuery.proxy(function(d){if(typeof this.newpost_timer!=="undefined"){window.clearTimeout(this.newpost_timer)}var c=d.data.kinjapostssince[notification_options.siteId];if(c.ready==true&&typeof c.count!=="undefined"){var b=c.count;if(b>0&&(typeof this.notificationSent[this.latestPostId]=="undefined"||this.notificationSent[this.latestPostId]!=b)){this.notificationSent[this.latestPostId]=b;window.setTimeout(function(){jQuery(".newstory a").html(b==1?"New story posted":"New stories posted");jQuery(".newstory").slideDown("500")},5*60*1000)}if((b<2)&&(this.sponge_update_count++<this.options.sponge_update_limit)){if(this.sponge_update_intervals.length){interval=this.sponge_update_intervals.shift()}else{interval=this.options.sponge_update_intervals[this.options.sponge_update_intervals.length-1]}this.newpost_timer=setTimeout(jQuery.proxy(function(){this.getNewPost()},this),(interval*1000))}}else{this.newpost_timer=setTimeout(jQuery.proxy(function(){this.getNewPost()},this),(15*1000))}},this)})},getChartbeatData:function(){this.getChartbeatDataForUrl(this.getCurrentUrl(this.options.forDomain));this.timeout_handler=setTimeout(jQuery.proxy(function(){this.getChartbeatData()},this),(this.options.chartbeat_update_interval*1000));this.active=true},getChartbeatDataForUrl:function(a){if(a===false){return false}if(typeof spongeresponse!=="undefined"){return false}var b="http://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getStats/?url="+a+"&source=chartbeat";this.xhr=jQuery.ajax({url:b,crossDomain:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:"spongeresponse",success:jQuery.proxy(this.insertResults,this)})},insertResults:function(c){delete this.xhr;if(c.meta===undefined||c.meta.success!==true){this.hideWidget();return false}var b=0;for(var a in c.data){chartbeat_data=c.data[a].chartbeat;if(chartbeat_data.ready===undefined||(chartbeat_data.ready!==undefined&&chartbeat_data.ready===true)){this.hideProgress();b=chartbeat_data.people;if(parseInt(b,10)===0){b=1}jQuery("#cb_number").html(this.add_commas(b))}else{this.showProgress()}}this.showWidget()},getCurrentUrl:function(b){if(!b){var a=jQuery("link[rel=canonical]").attr("href")}else{a=window.location.protocol+"//"+siteConfig.canonicalHost}a=a.replace(".local",".com");return a},showWidget:function(){if(this.element.is(":visible")){this.element.hide()}this.element.show()},hideWidget:function(){this.element.hide();this.hideProgress()},showProgress:function(){jQuery("#cb_progress").show();jQuery("#cb_label").hide()},hideProgress:function(){jQuery("#cb_progress").hide();jQuery("#cb_label").show()},stop:function(){if(this.xhr){this.xhr.abort()}clearTimeout(this.timeout_handler);this.active=false},start:function(){this.stop();this.getChartbeatData()}});jQuery.widget("ui.spongestatsclient",{timeout_handler:null,default_options:{sponge_protocol:"http",sponge_host:"api.gawker.com/sponge",sponge_api_version:"v1",version:"0.2",views_limit:1000,comments_limit:100,stats_enabled:true},requests_running:0,_init:function(){var a;for(a in this.default_options){if(this.options[a]===undefined){this.options[a]=this.default_options[a]
}}},getStats:function(h,a,j){var e=[],b=5,k,d,m,f,c,g;if(this.options.stats_enabled!==true){return false}if(h.length===0){return false}g=this.options.sponge_protocol+"://"+this.options.sponge_host+"/api/"+this.options.sponge_api_version+"/getStats/";for(f=0,c=h.length;f<c;f++){k=Math.floor(f/b);if(e[k]===undefined){e[k]={params:{url:[],source:["views","comments"]}}}e[k].params.url.push(h[f])}for(f=0,c=e.length;f<c;f++){d=e[f].params;m="spcb_"+jQuery().crypt({method:"md5",source:"_"+d.url.join(" ")});if(jQuery.isFunction(window[m])){continue}this.requests_running++;this.xhr=jQuery.ajax({url:g,crossDomain:true,data:d,traditional:true,dataType:"jsonp",jsonp:"jsonP",jsonpCallback:m,success:jQuery.proxy(j,a)})}}});(function(a){a.widget("ui.ThreadWidget",{controls:{},params:{post_id:null,thread_id:null,mode:"all",page:0,append:false,repliesmode:"hide",nouser:false},threadlist:{},selected_thread:null,thread_visible:true,auth_done:false,post_load_done:false,initialize:function(){this.xhr=new XHR({klass:"thread",type:"GET",disableToken:true,beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.eventPostLoadedHandler.bind(this));this.subscribeForEvent("maincontent.tagpageloaded",this.eventPostLoadedHandler.bind(this));this.subscribeForEvent("maincontent.forumloaded",this.eventForumLoadedHandler.bind(this));this.subscribeForEvent("commentform.",this.eventCommentFormHandler.bind(this));this.subscribeForEvent("threads.",this.eventHandler.bind(this))},traverse:function(){var b=this;var c=function(d,h,g){var f=b.getParam("cid",h),e=d.find(".jumpto_"+f).closest(".comment");h.addClass("l_"+g);if(e.length){e.each(function(j,k){c(d,jQuery(k),g+1)})}};this.controls.threadlist.find(".thread").each(function(d,f){c(jQuery(f),jQuery(f).children(".comment"),0)})},eventAuthHandler:function(b){if(this.auth_done===false){this.auth_done=true;if(this.post_load_done){this.parseUserSettings();this.loadThreadsForPost()}}},eventPostLoadedHandler:function(c){if(c.params.data.action=="post"||c.params.data.action=="tag"){this.resetElements();this.setControls();this.parseUserSettings();this.hideThreads();this.traverse();if(c.params.data.disable_comments===true){return false}this.post_load_done=true;this.registerDOMHandlers();this.params.post_id=c.params.data.originalPostId||c.params.data.id;if(window.location.href.indexOf("?comment=")!=-1){var b=(window.location.href.match(/[?&]comment=(?:([0-9]+)\:)?([0-9]+)/));if(b!==null&&b[2]!==undefined){this.selected_thread=b[2];this.params.mode="permalink"}}if(this.auth_done===true){this.loadThreadsForPost()}}},eventForumLoadedHandler:function(b){this.params.mode="all";this.raiseEvent("threads.listloaded",{});this.resetElements();this.setControls();this.traverse();this.registerDOMHandlers()},eventCommentFormHandler:function(b){switch(b.name){case"commentform.cancel":if(this.thread_visible===false){this.showThreads()}if(this.params.thread_id&&jQuery(".t_"+this.params.thread_id).length>0){jQuery(".t_"+this.params.thread_id+" .comment:hidden").show()}break;case"commentform.open":this.setPagerMode("comment");break;case"commentform.setreplyto":this.setPagerMode();break;case"commentform.close":this.setPagerMode();break}},eventHandler:function(c){var b={};switch(c.name){case"threads.updatelist":this.loadThreadList();break;case"threads.listloaded":if(this.controls.showfeatured!==undefined){this.setPagerMode()}jQuery("#comments").lytebox({pager:false,spinner:true});break;case"threads.reloadthread":b.selected_thread=c.params.selected_thread;this.loadThread(b);break;case"threads.threadloaded":jQuery("#comments").lytebox({pager:false});break;case"threads.showthreads":this.showThreads();break;case"threads.insertcomment":this.appendComment(c.params.comment);break;case"threads.replacecomment":this.replaceComment(c.params.comment);break}},handleClick:function(j){var f=this.getParam("cn",jQuery(j.target));var m=null;switch(f){case"openthread":m=this.getParam("tid",jQuery(j.target));if(!m){j.stopPropagation();j.preventDefault()}this.loadThread({selected_thread:m,jumpto:false});j.stopPropagation();j.preventDefault();break;case"threadexpand":this.loadThread({jumpto:false});j.stopPropagation();j.preventDefault();break;case"togglereplies":m=this.getParam("tid",jQuery(j.target));var n=this.element.find(".t_"+m);var b=n.find(".cn_togglereplies").eq(0);var k=n.find(".replies").eq(0);var h=n.find("span.repliestoggle").eq(0);if(k.is(":visible")){k.slideUp("fast");h.html("Show");b.addClass("show").removeClass("hide")}else{k.slideDown("fast");h.html("Hide");b.addClass("hide").removeClass("show")}j.stopPropagation();j.preventDefault();break;case"jumpto":m=this.getParam("jumpto",jQuery(j.target));jQuery.scrollTo(".cid_"+m,"fast");j.stopPropagation();j.preventDefault();break;case"showfeatured":this.showSpinner();this.params.mode="featured";this.params.append=false;
this.params.page=0;this.loadThreadList();j.stopPropagation();j.preventDefault();break;case"showall":this.showSpinner();this.params.mode="all";this.params.append=false;this.loadThreadList();j.stopPropagation();j.preventDefault();break;case"nextpage":this.params.page++;this.params.append=true;this.loadThreadList();j.stopPropagation();j.preventDefault();break;case"newdiscussion":this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place")});j.stopPropagation();j.preventDefault();break;case"reply":var s=jQuery(j.target).closest(".comment");var d=this.getParam("cid",s);this.raiseEvent("commentform.open",{after:jQuery(".cid_"+d)});this.raiseEvent("commentform.setreplyto",{replyto:d});j.stopPropagation();j.preventDefault();break;case"question":var l=jQuery(j.target).children(".shortcomment_explained");if(jQuery(j.target).children(".shortcomment_explained:visible").length===0){l.show();l.bind("clickoutside",function(){l.hide();l.unbind("clickoutside")})}else{l.hide()}j.stopPropagation();j.preventDefault();break;case"dismiss":var g=jQuery(j.target).closest(".comment"),n=jQuery(j.target).closest(".thread"),r=this;var o=function(u){var t=r.getParam("cid",u),e=n.find(".jumpto_"+t).closest(".comment");if(e.length){e.each(function(v,w){e=e.add(o(jQuery(w)))})}return e};var k=o(g);var c=g.find(".pw_dismissedtext");var p=k.length+1;var q=p==1?"One comment has been moved to its":(""+p+" comments have been moved to their");c.html(c.html().replace("This comment has been moved to its",q));k.addClass("pw_dismissed_child");g.addClass("pw_dismissed");k.each(function(t,u){jQuery(u).height(jQuery(u).height())});j.stopPropagation();j.preventDefault();break}},loadThreadsForPost:function(){try{var b=-1;this.params.page=0;this.params.append=false;this.loadThreadList()}catch(c){}},loadThreadList:function(){try{var c={op:this.options.thread_action,post_id:this.params.post_id,mode:this.params.mode,page:this.params.page,repliesmode:this.params.repliesmode,nouser:this.params.nouser};if(this.selected_thread!==undefined){c.selected_thread=this.selected_thread;this.selected_thread=null}if(this.feature.isOn("powwow")){c.powwow=true}this.xhr.send("/index.php",c)}catch(b){}},loadThread:function(d){if(d.selected_thread!==undefined||(d.collapse_thread!==undefined&&d.collapse_thread)){this.params.thread_id=d.selected_thread}var c=this.controls.threadlist.find(".t_"+this.params.thread_id);if(d.jumpto===true&&c.length>0){jQuery.scrollTo(c,"fast")}c.addClass("inprogress");var b={op:"commentthread",thread_id:this.params.thread_id,jumpto:d.jumpto};if(d.selected_comment){b.comment_id=d.selected_comment}if(window.pageType==="site_comments_admin"){b.external_tools=true}this.xhr.send("/index.php",b)},appendComment:function(c){if(c.is_reply===true){var b=jQuery(".cid_"+c.thread_id).closest(".thread");jQuery(".comment:last",b).after(c.content)}else{if(this.params.mode=="featured"){this.controls.threadlist.children().remove();this.controls.threadlist.html(c.content)}else{this.controls.threadlist.prepend(c.content);this.showThreads()}}},replaceComment:function(c){var b=jQuery(".cid_"+c.comment_id);if(b.length>0){b.replaceWith(c.content).show()}},hideThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().hide();this.thread_visible=false}},showThreads:function(){if(this.controls.threadlist!==undefined){this.controls.threadlist.children().show();this.thread_visible=true}},setPagerMode:function(b){if(b===undefined){b=this.params.mode}this.controls.showfeatured.removeClass("selected");this.controls.showall.removeClass("selected");this.controls.newdiscussion.removeClass("selected");switch(b){case"permalink":break;case"all":this.controls.showall.addClass("selected");break;case"featured":this.controls.showfeatured.addClass("selected");break;case"comment":this.controls.newdiscussion.addClass("selected");break}},ajaxRequestHandler:function(){},ajaxSuccessHandler:function(c){if(c.action=="threadlist"){if(this.params.append===true){this.controls.threadlist.append(c.content)}else{this.controls.threadlist.html(c.content)}this.setControls();this.traverse();if(this.params.mode=="all"&&c.pager===true){this.controls.nextpage.show()}else{this.controls.nextpage.hide()}this.raiseEvent("threads.listloaded",{selected_thread:c.selected_thread});if(jQuery(".comment_list_placeholder .thread").length===0){this.raiseEvent("commentform.open",{clear:true,after:jQuery(".input_box_place"),nofocus:true})}this.hideSpinner();this.markSelfComments()}else{if(c.action=="commentthread"){jQuery(".inprogress").removeClass("inprogress");if(c.moved_comment!==true){var b=jQuery(".t_"+c.thread_id);if(b.length>0){b.html(c.content).slideDown("normal",function(){if(c.jumpto===true){var d=".t_"+c.thread_id;if(c.comment_id>0){d=".comment.cid_"+c.comment_id}jQuery.scrollTo(d,"fast")}})}}this.raiseEvent("threads.threadloaded",{data:c})}}},ajaxFailHandler:function(b){},registerDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));
jQuery(document).bind("keyup",this.keyupHandler.bind(this))},keyupHandler:function(b){},unregisterDOMHandlers:function(){this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));jQuery(document).unbind("keyup",this.keyupHandler.bind(this))},refreshWidget:function(){this.setControls();this.traverse();this.toggleEditIcons()},parseUserSettings:function(){this.params.repliesmode="hide";if(this.auth.authenticated){this.params.mode=(this.params.mode!="permalink")?"all":"permalink";this.params.nouser=false}else{this.params.mode=(this.params.mode!="permalink")?"featured":"permalink";this.params.nouser=true}},markSelfComments:function(){if(this.auth.user!==null){jQuery(".comment.aid_"+this.auth.user.id).addClass("self")}},hideSpinner:function(){jQuery(this.controls.spinner).spin(false)},showSpinner:function(){jQuery(this.controls.spinner).spin("small")}});a.extend(a.ui.ThreadWidget,{version:"1.0",defaults:{action_name:"commentlist",thread_action:"threadlist",onHide:{},onShow:{},onReset:{},controlClass:"tc",externalElement:"#comments"}})})(jQuery);(function(a){a.widget("ui.ThreadAdminWidget",{controls:{},scope:"thread",initialize:function(){this.xhr=new XHR({klass:"threadadmin",type:"POST",beforeSend:this.ajaxRequestHandler.bind(this),error:this.ajaxFailHandler.bind(this),success:this.ajaxSuccessHandler.bind(this)});this.subscribeForEvent("threadadmin.",this.eventHandler.bind(this));this.subscribeForEvent("threads.",this.eventThreadLoadedHandler.bind(this));this.subscribeForEvent("user.auth.",this.eventAuthHandler.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},eventHandler:function(c){switch(c.name){case"threadadmin.messageadd":break;case"threadadmin.setpriority":break;case"threadadmin.priorityset":var d=this.element.find(".cid_"+c.params.comment_id).parents(".thread");var b=this.getParam("t",d);this.handlePriorityChange({comment_id:c.params.comment_id,priority:c.params.priority,thread_root_id:b});break;case"threadadmin.commentapproved":break;case"threadadmin.commentdeleted":this.element.find(".threadwrap.tid_"+c.params.comment_id).fadeOut();break;case"threadadmin.userstatusset":this.handleUserStatusChange({comment_id:c.params.comment_id,commenter_id:c.params.commenter_id,action:c.params.action});break}},eventThreadLoadedHandler:function(b){switch(b.name){case"threads.listloaded":case"threads.threadloaded":case"threads.insertcomment":case"threads.replacecomment":this.tearDownEventHandler(this.element,"click",this.handleClick.bind(this));this.resetElements();this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.setControls();this.showIcons();break}},eventAuthHandler:function(b){this.showIcons()},handleClick:function(d){var c=jQuery(d.target);var h=this.getParam("cn",c);var g=c.closest(".comment");var b=this.getParam("cid",g);var f=this.getParam("aid",g);if(c.hasClass("single")){this.scope="comment"}else{this.scope="thread"}switch(h){case"promote":case"adminpromote":if(g.hasClass("us_pending")||g.hasClass("us_banned")){this.changeUserStatus({comment_id:b,commenter_id:f,action:"approve"})}else{this.setPriority({comment_id:b,priority:1,star_user:false})}d.preventDefault();d.stopPropagation();break;case"demote":case"admindemote":this.setPriority({comment_id:b,priority:0,star_user:false});d.preventDefault();d.stopPropagation();break;case"admindelete":this.setState({comment_id:b,commenter_id:f,state:"DELETED"});d.preventDefault();d.stopPropagation();break;case"adminpending":this.changeUserStatus({comment_id:b,commenter_id:f,action:"maybe"});d.preventDefault();d.stopPropagation();break;case"adminlinks":this.toggleAdminBox({comment_id:b,commenter_id:f});d.preventDefault();d.stopPropagation();break;case"adminpage":this.toggleAdminBox({});window.location="http://commentadmin."+window.location.hostname+"/index.php?op=userlist_search&id="+f+"&siteId="+siteConfig.id;d.preventDefault();d.stopPropagation();break;case"edit":case"adminedit":this.editComment({comment_id:b});d.preventDefault();d.stopPropagation();break;case"approveuser":this.controls.s_ind.show();this.changeUserStatus({comment_id:b,commenter_id:f,action:"approve"});d.preventDefault();d.stopPropagation();break;case"openwarndialog":this.toggleWarnDialog({comment_id:b,commenter_id:f});this.toggleAdminBox({});d.preventDefault();d.stopPropagation();break;case"closewarndialog":this.toggleWarnDialog({});this.toggleAdminBox({});d.preventDefault();d.stopPropagation();break;case"submituserwarn":this.submitWarning({comment_id:b,commenter_id:f});d.stopPropagation();d.preventDefault();break;case"communitypolicy":this.raiseEvent("policypopup.toggle",{});d.stopPropagation();d.preventDefault();break}},ajaxRequestHandler:function(){this.controls.s_ind.show()},ajaxSuccessHandler:function(c){this.controls.s_ind.hide();var d={};var b=jQuery(".comment.cid_"+c.commentId+" .please_leave_a_message");switch(c.action){case"promotethread":if(c.success===true){d={comment_id:c.commentId,priority:c.priority};this.raiseEvent("threadadmin.priorityset",d)
}else{Message.showMessage(c.message,b[0],{stable:false})}break;case"changecommentstatus":if(c.success===true){d={comment_id:c.commentId};if(c.publishStatus=="DELETED"){this.raiseEvent("threadadmin.commentdeleted",d)}}else{Message.showMessage("Comment status setting failed, please try again later",b[0],{stable:false})}break;case"approveuser":if(c.success===true){d={comment_id:c.commentId,commenter_id:c.commenterId,action:"approve"};this.raiseEvent("threadadmin.userstatusset",d)}else{Message.showMessage("User approve failed, please try again later",b[0],{stable:false})}break;case"maybeuser":if(c.success===true){d={comment_id:c.commentId,commenter_id:c.commenterId,action:"maybe"};this.raiseEvent("threadadmin.userstatusset",d)}else{Message.showMessage("Setting user pending status failed, please try again later",b[0],{stable:false})}break;case"ajax_warncommenter":this.controls.uw_progress.hide();if(c.success){Message.showMessage("Success",this.controls.uw_message[0],{stable:false,onComplete:function(){this.toggleWarnDialog({});var e='(see <a href="/communitypolicy" class="tac cn_policylink">Community Policy</a>)';var f;f='<a href="/people/'+this.auth.user.username+'/">'+this.auth.user.displayName+"</a> ";if(c.type){switch(c.type){case"warn":f+="warned ";break;case"suspend":f+="suspended ";break;case"ban":f+="banned ";break}f+="this user"}if(c.tagname){if(c.type){f+=" and "}f+='moved this <a href="/'+c.tagname+"/forum?comment="+c.moved_id+'">thread</a> to <a href="/'+c.tagname+'/forum">#'+c.tagname+"</a>";this.element.find(".cid_"+c.root_id+" .ctedit").html("");this.element.find(".cid_"+c.root_id+" .metatext").append('<div class="warnedBy">'+f+" "+e+"</div>");this.element.find(".thread.t_"+c.root_id+" .threadfooter").html("")}else{this.element.find(".cid_"+c.id+" .metatext").append('<div class="warnedBy">'+f+" "+e+"</div>")}}.bind(this,c)})}else{Message.showMessage(c.reason,this.controls.uw_message[0],{stable:false,onComplete:function(){}})}break}},ajaxFailHandler:function(b){this.controls.s_ind.hide()},showIcons:function(){if(this.controls.adminlinks===undefined){return false}if(this.controls.promote){this.controls.promote.css({display:"none"})}if(this.controls.demote){this.controls.demote.css({display:"none"})}if(this.controls.adminedit){this.controls.adminedit.css({display:"none"})}this.element.find(".cn_togglestar").removeClass("hoverable");this.element.find(".cn_togglestar").attr("title","");if(!this.auth.authenticated){return false}if(this.auth.hasLevel("editors",siteConfig.id)){this.element.find(".p_1 .cn_demote").css({display:""});this.element.find(".p_0 .cn_promote").css({display:""});this.controls.adminlinks.css({display:""});this.element.find(".cn_togglestar").addClass("hoverable");this.element.find(".cn_togglestar").attr("title","Toggle star")}else{if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminlinks.css({display:""});this.element.find(".cn_togglestar").addClass("hoverable");this.element.find(".cn_togglestar").attr("title","Toggle star");this.element.find(".p_0 .cn_promote").css({display:""})}else{if(this.auth.hasLevel("starcommenters",siteConfig.id)){this.element.find(".p_0 .cn_promote").css({display:""})}}}if(this.auth.hasLevel("commentadmins",siteConfig.id)){this.controls.adminedit.css({display:""})}this.controls.edit.css({display:"none"});this.element.find(".ue.aid_"+this.auth.user.id+" .commentedit").css({display:""})},toggleAdminBox:function(b){if(this.controls.adminbox===undefined){return false}if(b.comment_id===undefined||this.controls.adminbox.is(":visible")){this.controls.adminbox_placetobe.append(this.controls.adminbox).hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.adminbox.show())}},setPriority:function(c){var b={op:"ajax_promotethread",comment_id:c.comment_id,priority:c.priority};this.xhr.send(this.options.action_url,b)},handlePriorityChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});if(this.scope==="comment"){this.element.find(".cid_"+b.comment_id).removeClass("p_0 p_1").addClass("p_"+b.priority)}else{if(b.thread_root_id){this.raiseEvent("threads.reloadthread",{selected_thread:b.thread_root_id})}}},setState:function(c){var b={op:"changecommentstatus",id:c.comment_id,publishStatus:c.state};this.xhr.send(this.options.action_url,b)},changeUserStatus:function(c){if(c.commenter_id===undefined||c.action===undefined){return false}var b={op:"changeuserstatus",action:c.action,id:c.commenter_id,siteId:siteConfig.id,commentId:c.comment_id};this.xhr.send(this.options.action_url,b)},handleUserStatusChange:function(b){this.controls.s_ind.hide();this.toggleAdminBox({});switch(b.action){case"approve":this.element.find(".aid_"+b.commenter_id).removeClass("cs_draft us_pending us_banned");this.element.find(".cid_"+b.comment_id+" cite").after('<span class="promotedBy">approved by '+this.auth.user.smartName+"</span>");break;case"maybe":this.element.find(".aid_"+b.commenter_id).addClass("cs_draft us_pending");break}},toggleWarnDialog:function(b){if(b.comment_id===undefined&&this.controls.warndialog.is(":visible")){this.controls.warndialog_placetobe.append(this.controls.warndialog).hide();
this.controls.uw_moveto.unbind("change");this.controls.uw_state.val("");this.controls.uw_moveto.val("");this.controls.uw_moveto_other.val("").hide()}else{this.element.find(".cid_"+b.comment_id).append(this.controls.warndialog.show());this.controls.uw_moveto.bind("change",function(){if(this.controls.uw_moveto.val()=="other"){this.controls.uw_moveto_other.show()}else{this.controls.uw_moveto_other.hide()}}.bind(this))}},submitWarning:function(e){var b=this.controls.uw_moveto.val();if(b=="other"){b=this.controls.uw_moveto_other.val()}if(b.substring(0,1)=="#"){b=b.substring(1)}var d=this.controls.uw_state.val();if(b||d){var c={op:"ajax_warncommenter",id:e.comment_id,tagname:b,type:d};this.controls.uw_progress.show();this.xhr.send(this.options.action_url,c)}else{this.toggleWarnDialog({})}},editComment:function(b){if(b.comment_id===undefined){return false}this.raiseEvent("commentform.setedit",{comment_id:b.comment_id});this.toggleAdminBox({})}});a.extend(a.ui.ThreadAdminWidget,{version:"1.0",defaults:{action_url:"/index.php",onHide:{},onShow:{},onReset:{},controlClass:"tac",externalElement:"#comments"}})})(jQuery);(function($){$.widget("ui.UserWidget",{xhr:null,default_options:{},initialize:function(){this.xhr=new XHR({klass:"presence",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));var panels={};if(this.controls.userinit_dialog){panels.userinit={el:this.controls.userinit_dialog}}if(this.controls.burnerlogin_dialog){panels.burnerlogin={el:this.controls.burnerlogin_dialog};$("#burnerLoginForm").submit(this.handleBurnerLogin.bind(this))}if(this.controls.burnercreate_dialog){panels.burnercreate={el:this.controls.burnercreate_dialog,focus:$(".burnercreate_dialog #burnerCreateScreenName")};$("#burnerCreateForm").submit(this.handleBurnerCreate.bind(this))}if(this.controls.burnercreatesuccess_dialog){panels.burnercreatesuccess={el:this.controls.burnercreatesuccess_dialog}}if(this.controls.oauthscreenname_dialog){panels.oauthscreenname={el:this.controls.oauthscreenname_dialog};$("#oauthScreenForm").submit(this.handleOauthScreen.bind(this));var obj=this}if(this.controls.oauthclaim_dialog){panels.oauthclaim={el:this.controls.oauthclaim_dialog};$("#oauthClaimForm").submit(this.handleOauthClaim.bind(this))}if(this.controls.resetpw_dialog){panels.resetpw={el:this.controls.resetpw_dialog};$("#resetKinjaPwForm").submit(this.handleResetKinjaPw.bind(this))}if(this.controls.converted_dialog){panels.converted={el:this.controls.converted_dialog}}if(this.controls.login_dialog){panels.login={el:this.controls.login_dialog};$("#kinjaLoginForm").submit(this.handleKinjaLogin.bind(this))}if(this.controls.oauthconvert_dialog){panels.oauthconvert={el:this.controls.oauthconvert_dialog}}if(this.controls.user_dialog){panels.user={el:this.controls.user_dialog}}if(this.controls.recaptcha_dialog){panels.recaptcha={el:this.controls.recaptcha_dialog}}this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:panels,group:false});if(location.search.indexOf("dialog=")!==-1){var obj=this;setTimeout(function(){var dialogName=location.search.replace(/^.*dialog=([a-z]+).*$/,"$1");obj.commondialogs.toggleDialog({which:dialogName})},1000)}this.subscribeForEvent("presence.requiredialog",this.outsideEventHandler.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("presence.requiresequence.",this.outsideEventHandler.bind(this));this.subscribeForEvent("dialog.afterOpen.",this.handleDialogOpen.bind(this));jQuery("body").live("loginRequest",$.proxy(function(){this.raiseEvent("presence.requiresequence.guest",{})},this));this.auth.getUserState()},toggleUserInitDialog:function(e){this.commondialogs.toggleDialog({which:"userinit"})},handleClicks:function(e){var target=$(e.target);var controlName=this.getParam("cn",e.target);if(target.attr("id")==="burnerButton"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(controlName==="togglelogindialog"){this.toggleUserInitDialog(e);e.stopPropagation();e.preventDefault()}else{if(target.attr("id")==="burnerLoginButton"){this.commondialogs.toggleDialog({which:"burnerlogin"});e.stopPropagation();e.preventDefault()}else{if(controlName==="touserinit"){this.toggleUserInitDialog(e);e.stopPropagation();e.preventDefault()}else{if(controlName==="toburnercreate"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(target.attr("id")==="burnerRegisterButton"||controlName==="toggleburnercreate"){this.commondialogs.toggleDialog({which:"burnercreate"});e.stopPropagation();e.preventDefault()}else{if(controlName==="login_oauth"){var loginType=this.getParam("type",e.target);this.oauthLogin(loginType);e.stopPropagation();e.preventDefault()}else{if(controlName==="logout_link"){e.stopPropagation();e.preventDefault();this.mystate="loggedin:logging_out:clicked";
this.controls.user_menu.hide();if(this.controls.loginmessage!==undefined){this.controls.loginmessage.html("")}var public_profile=this.auth.user?"/people/"+this.auth.user.username:false;var s=document.createElement("script");s.type="text/javascript";s.src="/sso/logout_request";s.async=true;var obj=this;globalLogoutFunc=function(){obj.auth.getUserState();if(window.Powwow!==undefined){Powwow.loadUser()}if(window.location.pathname.indexOf("/me/")==0||window.location.pathname=="/me"){if(public_profile){window.location.href=public_profile}}obj.controls.user_dialog.hide()};jQuery("body").append(s);var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r);this.controls.profile_link.html("Logging out...");if(this.controls.logout_panel){this.controls.logout_panel.hide()}}else{if(controlName==="profile_link"){e.stopPropagation();e.preventDefault();this.raiseEvent("notification.togglelist")}else{if(controlName==="profile_link_icon"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"user"})}else{if(controlName==="toggleclaim"){e.stopPropagation();e.preventDefault();this.showClaimDialog()}else{if(controlName==="kinjalogin"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"login"})}else{if(controlName==="converted_ok"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"converted"})}else{if(controlName==="burnercreatesucces_ok"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"burnercreatesuccess"})}else{if(controlName==="toggleforgotpassword"){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog({which:"resetpw"})}else{if(controlName.indexOf("_cancel")!==-1){e.stopPropagation();e.preventDefault();var dialogName=controlName.replace("_cancel","");this.commondialogs.toggleDialog({which:dialogName})}else{if(controlName==="overlay"){if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){e.stopPropagation();e.preventDefault();this.commondialogs.toggleDialog()}}else{if(controlName==="recaptcha_submit"){e.stopPropagation();e.preventDefault();this.submitCaptcha()}}}}}}}}}}}}}}}}}}},handleAjaxRequest:function(e){},handleAjaxFail:function(e){this.workingInBackground=false},handleAjaxSuccess:function(data){var action=null;if(data.action!==undefined){action=data.action}else{if(data.meta!==undefined&&data.meta["method"]!==undefined){action=data.meta["method"]}}this.workingInBackground=false;switch(action){case"registerBurner":if(data.meta.success){jQuery("#burnerCreateSuccessScreenName").html($("#burnerCreateScreenName").val());jQuery("#burnerCreateSuccessToken").html(data.data.token);if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();this.justLoggedIn=false;this.commondialogs.toggleDialog({which:"burnercreatesuccess"});_gaq.push(["_trackEvent","New User Registration","Burner"])}else{if(data.data.type=="InvalidRecaptchaException"){this.showMessage("burnerCreate","CaptchaFail");Recaptcha.reload()}else{if(data.data.type=="InvalidScreenNameException"){this.showMessage("burnerCreate","Invalid")}else{this.showMessage("burnerCreate","Fail")}}}break;case"checkLogin":var prefix="";if(data.target==="oauthscreenform"){if(data.success&&data.available&&data.valid){this.workingInBackground=true;this.xhr.send("/sso/attach?username="+encodeURIComponent($("#oauthScreenName").val()))}else{if(!data.valid){this.showMessage("oauthScreenName","Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage("oauthScreenName","Kinja")}else{this.showMessage("oauthScreenName","Fail")}}}}else{if(data.target==="burnercreate"){if(data.success&&data.available&&data.valid){this.hideMessages("burnerCreate");this.displayBurnerCaptcha()}else{if(!data.valid){this.showMessage("burnerCreate","Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage("burnerCreate","Kinja")}else{this.showMessage("burnerCreate","Fail")}}}}else{switch(data.target){case"login":prefix="burnerLogin";break;case"create":prefix="burnerCreate";break;case"oauthscreenname":prefix="oauthScreenName";if(data.success&&!data.available){this.existingScreenName=true}break}if(data.success&&data.available&&data.valid){this.showMessage(prefix,"Success")}else{if(!data.valid){this.showMessage(prefix,"Invalid")}else{if(data.inKinja&&!data.inSso){this.showMessage(prefix,"Kinja")}else{this.showMessage(prefix,"Fail")}}}}}break;case"burnerLogin":if(data.meta.success){this.showMessage("burnerLogin","Success");if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();this.justLoggedIn=false;(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this)}else{this.showMessage("burnerLogin","Fail")}break;case"attach":if(data.success){this.showMessage("oauthScreenName","Saved");if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState();(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this);_gaq.push(["_trackEvent","New User Registration",this.ssoUser.authType])
}else{if(!data.valid){this.showMessage("oauthScreenName","Invalid")}else{this.showMessage("oauthScreenName","NotSaved")}}break;case"attach_existing":if(data.success){this.commondialogs.toggleDialog({which:"converted"});if(window.Powwow!==undefined){Powwow.loadUser()}this.auth.getUserState()}else{this.showMessage("oauthClaim","NotSaved")}break;case"kinja_login":if(data.success){this.commondialogs.toggleDialog({which:"oauthconvert"})}else{this.showMessage("kinjaLogin","Fail")}break;case"resetpassword":if(data.success){$("#resetKinjaPwdSuccessMessage").html(data.message);this.showMessage("resetKinjaPwd","Success");(function(obj){setTimeout(function(){obj.commondialogs.toggleDialog({})},1000)})(this)}else{$("#resetKinjaPwdFailMessage").html(data.message);this.showMessage("resetKinjaPwd","Fail")}}},addCheckLogin:function(selector,prefix,target,callback){(function(obj){var timer=null;$(selector).keyup(function(e){if(callback!==undefined){callback()}if(timer!==null){clearTimeout(timer)}if($(e.target).val().length==0){obj.hideMessages()}else{timer=setTimeout(function(){obj.showMessage(prefix,"Check");obj.checkLogin($(selector).val(),target)},1000)}})})(this)},checkLogin:function(username,target){this.xhr.send("/sso/checkLogin?target="+target+"&username="+encodeURIComponent(username))},handleBurnerLogin:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#burnerLoginScreenName").val();var token=$("#burnerLoginToken").val($("#burnerLoginToken").val().replace(/[^a-zA-Z]/g,"")).val();if(screenName.length===0){this.showMessage("burnerLogin","NameEmpty")}else{if(token.length===0){this.showMessage("burnerLogin","TokenEmpty")}else{if(this.workingInBackground!==true){this.workingInBackground=true;var s=document.createElement("script");s.async="async";var funcName="burnerLogin"+Math.round(Math.random()*1000000);var obj=this;eval(funcName+' = function(data) { data.action = "burnerLogin"; obj.handleAjaxSuccess(data)};');if(this.feature.isOn(this.feature.CORESSO)){s.src=window.coressoOptions.ssoHost+"/burnerLogin?consumer="+window.coressoOptions.consumerId+"&screenName="+encodeURIComponent(screenName)+"&token="+token+"&cookieSuffix="+window.coressoOptions.cookieSuffix+"&jsonp="+funcName}else{s.src=window.ssoOptions.ssoHost+"/v1/burnerLogin?consumer="+window.ssoOptions.consumerId+"&username="+encodeURIComponent(screenName)+"&burner="+token+"&cookieSuffix="+window.ssoOptions.cookieSuffix+"&jsonP="+funcName}var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);this.showMessage("burnerLogin","Login")}}}},handleBurnerCreate:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#burnerCreateScreenName").val();if(screenName.length===0){this.showMessage("burnerCreate","NameEmpty")}else{if(this.workingInBackground!==true){this.checkLogin(screenName,"burnercreate");this.showMessage("burnerCreate","Check")}}},displayBurnerCaptcha:function(){var screenName=$("#burnerCreateScreenName").val();var callback=(function(obj,name,options){return function(challenge,response){obj.commondialogs.toggleDialog({which:"burnercreate",resetName:false});var s=document.createElement("script");s.async="async";var funcName="getBurner"+Math.round(Math.random()*1000000);eval(funcName+' = function(data) { data.action = "registerBurner"; obj.handleAjaxSuccess(data)};');var params=["consumer="+options.consumerId,"loginName="+encodeURIComponent(name),"screenName="+encodeURIComponent(name),"cookieSuffix="+options.cookieSuffix,"recaptcha_challenge_field="+encodeURIComponent(challenge),"recaptcha_response_field="+encodeURIComponent(response),"jsonp="+funcName,"jsonP="+funcName];if(obj.feature.isOn(obj.feature.CORESSO)){s.src=window.coressoOptions.ssoHost+"/registerBurner?"+params.join("&")}else{s.src=window.ssoOptions.ssoHost+"/v1/registerBurner?"+params.join("&")}var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);obj.showMessage("burnerCreate","Create")}})(this,screenName,(this.feature.isOn(this.feature.CORESSO)?window.coressoOptions:window.ssoOptions));this.displayCaptcha(callback)},displayCaptcha:function(callback){this.captchaCallback=callback;if(window.Recaptcha!==undefined){this.showCaptcha(false)}else{var that=this;var checkRecaptcha=function(tries){if(tries===undefined){tries=0}if(tries<50){if(window.Recaptcha===undefined){setTimeout(function(){checkRecaptcha(tries+1)},100)}else{that.showCaptcha(true)}}};var s=document.createElement("script");s.async="async";s.src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js";var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);checkRecaptcha()}},showCaptcha:function(init){this.commondialogs.toggleDialog({which:"recaptcha"});if(init){Recaptcha.create(window.ssoOptions.recaptchaKey,"recaptchaContainer",{callback:Recaptcha.focus_response_field})}else{Recaptcha.reload({callback:Recaptcha.focus_response_field})
}function focusCaptchaField(tries){var el=document.getElementById("recaptcha_response_field");if(el){el.focus()}else{if(tries<50){setTimeout(function(){focusCaptchaField(tries+1)},700)}}}focusCaptchaField(0)},submitCaptcha:function(){this.captchaCallback(Recaptcha.get_challenge(),Recaptcha.get_response())},showClaimDialog:function(){var screenName=$("#oauthScreenName").val();$("#oauthClaimScreenNameData").val(screenName);$("#oauthClaimScreenName").html(screenName);this.commondialogs.toggleDialog({which:"oauthclaim"})},handleOauthScreen:function(e){e.stopPropagation();e.preventDefault();var screenName=$("#oauthScreenName").val();if(screenName.length===0){this.showMessage("oauthScreenName","Empty")}else{if(this.existingScreenName){this.showClaimDialog()}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.checkLogin(screenName,"oauthscreenform");this.showMessage("oauthScreenName","Save")}}}},handleOauthClaim:function(e){e.stopPropagation();e.preventDefault();var username=$("#oauthClaimScreenName").html();var password=$("#oauthClaimPassword").val();if(password.length===0){this.showMessage("oauthClaim","Empty")}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.showMessage("oauthClaim","Save");this.xhr.send("/sso/attach_existing",{username:username,password:password})}}},handleKinjaLogin:function(e){e.stopPropagation();e.preventDefault();var username=$("#kinjaLoginUsername").val();var password=$("#kinjaLoginPassword").val();if(username.length===0){this.showMessage("kinjaLogin","EmptyUsername")}else{if(password.length===0){this.showMessage("kinjaLogin","EmptyPassword")}else{if(this.workingInBackground!==true){this.workingInBackground=true;this.showMessage("kinjaLogin","Save");this.xhr.send("/sso/kinja_login",{username:username,password:password})}}}},handleResetKinjaPw:function(e){e.stopPropagation();e.preventDefault();var email=jQuery("#kinjaResetEmail").val();if(email.length==0){this.showMessage("resetKinjaPwd","Empty")}else{if(email.match(/^.+@[a-zA-Z0-9\-\.]+$/)==null){this.showMessage("resetKinjaPwd","Invalid")}else{if(this.workingInBackground!==true){this.workingInBackground=true;var params={email:email,recaptcha_challenge_field:jQuery("#recaptcha_challenge_field").val(),recaptcha_response_field:jQuery("#recaptcha_response_field").val()};this.xhr.send("/index.php?op=emailpassword",params);this.showMessage("resetKinjaPwd","Sending")}}}},delFetchUserState:function(){var domain=location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2");jQuery.cookie("fetchUserState2",null,{path:"/",domain:"."+domain});jQuery.cookie("fetchUserState2",null,{path:"/",domain:domain});jQuery.cookie("fetchUserState2",null,{path:"/"})},oauthLogin:function(type){var url="/sso/login_request?&provider="+type.replace(/[^a-z]/,"");if(jQuery("html").hasClass("safari")){url+="&engine=safari"}this.delFetchUserState();var obj=this;var checkCookies=function(){if(jQuery.cookie("fetchUserState2")==1){obj.commondialogs.toggleDialog({});var regNeedle="redirectToProfilePage=1";obj.auth.resetRevision();if(document.cookie.indexOf(regNeedle)!=-1||document.location.pathname.substring(0,3)=="/me"){obj.delFetchUserState();window.location="/me#|profileedit"}else{if(window.Powwow!==undefined){Powwow.loadUser()}}obj.auth.getUserState();obj.justLoggedIn=true}else{setTimeout(checkCookies,200)}};checkCookies();window.open(url,"","width=900,height=500")},handleDialogOpen:function(e){this.workingInBackground=false;var dialogName=e.name.replace("dialog.afterOpen.","");switch(dialogName){case"burnercreate":if(e.params.resetName===undefined||e.params.resetName===true){this.hideMessages("burnerCreate");$("#burnerCreateScreenName").val("")}break;case"burnerlogin":this.hideMessages("burnerLogin");$("#burnerLoginScreenName").val("");$("#burnerLoginToken").val("");break;case"oauthscreenname":this.hideMessages("oauthScreenName");if(jQuery.cookie("newUser")==0){jQuery("#oauthScreenNameReturningUserLabel").show();jQuery("#oauthScreenNameNewUserLabel").hide()}else{jQuery("#oauthScreenNameReturningUserLabel").hide();jQuery("#oauthScreenNameNewUserLabel").show()}$("#oauthScreenName").val("");break;case"oauthclaim":this.hideMessages("oauthClaim");$("#oauthClaimPassword").val("");break;case"login":this.hideMessages("kinjaLogin");$("#kinjaLoginUsername").val("");$("#kinjaLoginPassword").val("");break;case"resetpw":if(this.recaptchaKey===undefined){this.recaptchaKey=$("#kinjaResetRecaptcha").html();$("#kinjaResetRecaptcha").html("")}if(window.Recaptcha===undefined){(function(key){$.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){try{Recaptcha.create(key,"resetPwRecaptcha")}catch(e){}})})(this.recaptchaKey)}else{try{if($("#kinjaResetRecaptcha").html()==""){Recaptcha.create(this.recaptchaKey,"resetPwRecaptcha")}else{Recaptcha.reload()}}catch(e){}}this.hideMessages("resetKinjaPwd");$("#kinjaResetEmail").val("");break;case"converted":var provider="";if(this.ssoUser!==null&&this.ssoUser!==undefined){provider=this.ssoUser.authType;
provider=provider.substr(0,1).toUpperCase()+provider.substr(1)}$("#convertedProviderName").html(provider);break}},outsideEventHandler:function(e){switch(e.name){case"presence.requiresequence.guest":this.toggleUserInitDialog(e);break}},authEventHandler:function(e){this.authEventObject=e;var is_init=this.inState("init");var max_name_length=22;var ssoFailure=function(obj){obj.controls.profile_panel.hide();obj.controls.login_panel.show();obj.mystate="loggedout:no_dialog";if(obj.options.loginNeeded==true){obj.commondialogs.toggleDialog({which:"login"})}};switch(e.name){case"user.auth.ssoSuccess":this.ssoUser=e.source.data.user;if(e.source.data.user.converted>0){if(this.controls.profile_link){var profileLabel=e.source.data.user.displayName;if(profileLabel.length>max_name_length){profileLabel=profileLabel.substr(0,max_name_length)+"..."}profileLabelTxt=profileLabel;profileLabel+='<span id="profileNotificationCounter" class="site-bg-color" style="display:none"></span>';var href="/me";var isBurner=false;jQuery("#userNotificationContainer").removeClass("burner");jQuery("#userMenu").removeClass("burner");if(e.source.data.user.authType=="burner"){isBurner=true}if(this.controls.profile_link){this.controls.profile_link.attr("href",href).html(profileLabel)}if(this.controls.profile_link_icon){this.controls.profile_link_icon.attr("href",href).attr("title",profileLabelTxt)}if(this.controls.goto_profile){this.controls.goto_profile.attr("href",href);this.controls.goto_profile.show()}}this.controls.profile_panel.show();this.controls.login_panel.hide();if(this.justLoggedIn!==undefined&&this.justLoggedIn===true){this.justLoggedIn=false;var user=this.auth.ssoUser;if(user===null&&this.auth.kinjaUserId>0){this.commondialogs.toggleDialog({which:"oauthconvert"})}}this.mystate="loggedin"}else{if(e.source.data.user.converted==0){ssoFailure(this);if(this.justLoggedIn!==undefined&&this.justLoggedIn===true){this.justLoggedIn=false;this.commondialogs.toggleDialog({which:"oauthscreenname"})}}}break;case"user.auth.ssoFailure":this.ssoUser=null;ssoFailure(this);break}if(typeof(this.dialogHandler)=="function"){this.dialogHandler()}this.dialogHandler=-1;if(is_init&&window.location.hash.length>0){var hashparts=window.location.hash.split("|");if(hashparts.length>1){this.raiseEvent("presence.requiredialog",{mode:hashparts[1],hash:window.location.pathname})}}if(pageType=="frontpage"){jQuery.cookie("ad_url_visited_"+this.auth.site.canonicalHost.replace(/\./,"_"),"true",{expires:2592000,path:"/"})}_gaq.push(["_setCustomVar",1,"Visitor Level",this.ssoUser==null?"guest":"member",2])},showMessage:function(prefix,selectedId){this.hideMessages(prefix);jQuery("#"+prefix+selectedId+"Message").show()},hideMessages:function(prefix){jQuery("."+prefix+"Message").hide()}});$.extend($.ui.UserWidget,{version:"1.0",defaults:{controlClass:"user_control"}})})(jQuery);(function(a){a.widget("ui.WarningCountWidget",{xhr:null,initialize:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.xhr=new XHR({klass:"warningcount",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)})},handleClick:function(f){var d=this.getParam("cn",jQuery(f.target));switch(d){case"decrease":case"increase":var h=prompt("Add some comment please");if(null!=h){var c=this.getParam("uId",jQuery(f.target));var g={op:"changewarningcount",userId:c,direction:(jQuery(f.target).hasClass("cn_decrease")?-1:1),comment:h};this.xhr.send(this.options.action_url,g);jQuery("#action_indicator_"+c).show()}f.stopPropagation();f.preventDefault();break;case"history_toggle":var c=this.getParam("uId",jQuery(f.target));var b=jQuery("#warning_history_container_"+c)[0];if(b.style.display=="none"){b.style.display="";this.loadHistory(c)}else{b.style.display="none"}f.stopPropagation();f.preventDefault();break}},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){jQuery("#action_indicator_"+b.userId).hide();jQuery(".cn_history_toggle").filter(".uId_"+b.userId)[0].innerHTML=b.warnCount;this.loadHistory(b.userId)},handleAjaxFail:function(){jQuery("#action_indicator_"+data.userId).hide()},loadHistory:function(b){var c={op:"userlist_warning_history",userId:b};jQuery("#warning_history_openable_indicator_"+b).show();jQuery("#warning_history_"+b).hide();jQuery("#warning_history_"+b).load(this.options.action_url,c,function(){jQuery("#warning_history_openable_indicator_"+b).hide();jQuery("#warning_history_"+b).show()})},hideWidget:function(){},showWidget:function(){},resetWidget:function(){}});a.extend(a.ui.WarningCountWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"warningcount_control"}})})(jQuery);(function(a){a.widget("ui.AdUnit",a.extend({},a.ui.AdUnitAncestor.prototype,{}));a.extend(a.ui.AdUnit,{version:"1.0",defaults:a.extend({},a.ui.AdUnitAncestor.defaults,{adserver_host:"localhost:8800",controlClass:"ad_control",selectors:{"80x45_container":"li",thumb_container:".thumbLink","80x45_text":".text"},special_togglers:{"300x250_rightbar":{show:{right_on:function(b){jQuery("#tomorrowsnews").hide();
window.adRobot.runAdBySelector(".ad_300x250.inpost .ad_container");window.adRobot.runAdBySelector(".ad_300x600 .ad_container");if(window.navigator.userAgent.match(/iPad/i)===null){jQuery(b).hover(function(){jQuery(".wrap").css({overflow:"visible"})},function(){jQuery(".wrap").css({overflow:"auto"})})}}},hide:{right_on:function(b){jQuery("#tomorrowsnews").show();window.adRobot.runAdBySelector(".ad_300x250.inpost .ad_container");window.adRobot.runAdBySelector(".ad_300x600 .ad_container")}}}}})})}(jQuery));(function(a){a.widget("ui.EditorControlsWidget",{adminlinks_open:false,initialize:function(){this.xhr=new XHR({klass:"editorcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var b={};var c=false;if(this.controls.starinvite_form){b.starinvite={el:this.controls.starinvite_dialog,focus:this.controls.starinvite_email};this.starinvite_validator=new Validator(jQuery.extend({},{scope:this.controls.starinvite_form}));this.registerEventHandler(this.controls.starinvite_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.starinvite_form,"submit",this.handleStarInviteSubmit.bind(this));this.controls.starinvite_form[0].reset();c=true}if(this.controls.tagheader_form){b.tagheader={el:this.controls.tagheader_dialog,focus:this.controls.tagheader_entry};this.tagheader_validator=new Validator(jQuery.extend({},{scope:this.controls.tagheader_form}));this.registerEventHandler(this.controls.tagheader_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.tagheader_form,"submit",this.handleTagheaderSubmit.bind(this));this.controls.tagheader_form[0].reset();c=true}if(c){this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:b,group:this.options.dialoggroup?this.options.dialoggroup:false})}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.setupControls();break;case"user.auth.failure":if(this.controls.for_editors){this.controls.for_editors.hide()}if(this.controls.starinvite_link){this.controls.starinvite_link.hide()}if(this.controls.tagheader_link){this.controls.tagheader_link.hide()}this.element.eq(0).hide();break}},setupControls:function(){var f=false;if(this.controls.for_editors){if(this.auth.hasLevel("authors")){this.controls.for_editors.show()}else{this.controls.for_editors.hide()}}if(this.controls.starinvite_link){if(this.auth.hasLevel("commentadmins")){var e=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+e);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("");this.controls.starinvite_link.show()}else{if(this.auth.hasLevel("commenters")){var c=this.getParam("limitnormal",this.controls.starinvite_link);var h=parseInt(this.getParam("epoch",this.controls.starinvite_link),10);var b=parseInt(this.getParam("timeframe",this.controls.starinvite_link),10);if(this.auth.hasLevel("starcommenters")){c=this.getParam("limitstar",this.controls.starinvite_link)}c=parseInt(c,10);var g=c?c:10;if(this.auth&&this.auth.now&&this.auth.user&&this.auth.user.lastInviteTime){var d=parseInt(this.auth.user.lastInviteTime,10);if((this.auth.now-d)<(b-((d-h)%b))){g=c-parseInt(this.auth.user.recentInviteCount,10)}}var e=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+e).addClass("valid_limit_comma-"+g);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+g+" left)");if(g>0){this.controls.starinvite_link.show()}}else{this.controls.starinvite_link.hide()}}}if(this.controls.tagheader_link){if(this.controls.tagheader_enabled.html()=="true"){if(this.auth.hasLevel("editors")){this.controls.tagheader_entry.val(this.controls.tagheader_entry_orig.html().trim());this.controls.tagheader_postid.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_id.val(this.controls.tagheader_postid_orig.html());this.controls.tagheader_tags.val(this.controls.tagheader_tags_orig.html());this.controls.tagheader_link.show()}}}if(this.adminlinks_open&&jQuery("#debug_pane").css("display")=="block"){jQuery("#editorControlsWidget").toggle();jQuery(".cn_debug_info").html("Hide Debug Info")}else{this.adminlinks_open=false}if(f){this.element.eq(0).show()}else{this.element.eq(0).hide()}},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},handleClick:function(c){var b=this.getParam("cn",c.target);switch(b){case"draft_link":if(confirm("Delete post?")){var d=[];
d.push("op=changepoststatus");d.push("v2=true");d.push("id="+this.getParam("postId",this.controls.draft_link));d.push("publishStatus=DRAFT");d.push("realm=");this.xhr.send("/index.php",d.join("&"))}break;case"starinvite_link":this.controls.starinvite_postid.val(this.getParam("postId",c.target));case"starinvite_cancel":if(this.auth.hasLevel("commentadmins")||this.auth.hasLevel("commenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites, paste in a list of comma-separated email addresses, and then click send invites.")}}else{if(this.auth.hasLevel("starcommenters")){if(this.controls.starinvite_copy){this.controls.starinvite_copy.html("To create invites for new users, paste in a list of comma-separated email addresses, and then click send invites.")}}}this.commondialogs.toggleDialog({which:"starinvite"});break;case"tagheader_link":case"tagheader_cancel":if(this.auth.hasLevel("editors")){this.commondialogs.toggleDialog({which:"tagheader"})}break;case"toggleadminlinks":jQuery("#editorControlsWidget").toggle();this.adminlinks_open=!this.adminlinks_open;break;default:return true;break}c.stopPropagation();c.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleStarInviteSubmit:function(b){b.stopPropagation();b.preventDefault();this.starinvite_validator.hideErrors();if(this.starinvite_validator.validate()){this.mystate="starinvite_sent";this.xhr.send(this.options.starinvite_action_url,this.controls.starinvite_form.serialize())}else{this.mystate="starinvite_dialog_visible";if(this.options.show_validation_errors){this.starinvite_validator.showErrors()}}},handleTagheaderSubmit:function(b){b.stopPropagation();b.preventDefault();this.tagheader_validator.hideErrors();if(this.tagheader_validator.validate()){this.mystate="tagheader_sent";this.xhr.send(this.options.tagheader_action_url,this.controls.tagheader_form.serialize())}else{this.mystate="tagheader_dialog_visible";if(this.options.show_validation_errors){this.tagheader_validator.showErrors()}}},handleAjaxRequest:function(){switch(this.mystate){case"starinvite_sent":this.disableInputs("starinvite");this.controls.starinvite_indicator.show();break;case"tagheader_sent":this.disableInputs("tagheader");this.controls.tagheader_indicator.show();break}},handleAjaxSuccess:function(d){if(d.postSave){d={action:"postSave",success:d.postSave.success,postid:d.postSave.postId}}switch(d.action){case"changeposttag_add":if(d.success){this.controls.top_link.hide();this.controls.untop_link.show()}break;case"changeposttag_remove":if(d.success){this.controls.top_link.show();this.controls.untop_link.hide()}break;case"starinvite":this.enableInputs("starinvite");this.controls.starinvite_indicator.hide();if(d.success){if(!this.auth.hasLevel("commentadmins")){var c=d.left?d.left:0;var b=this.controls.starinvite_email[0].className.split("valid_limit_comma-").pop().split(" ")[0];this.controls.starinvite_email.removeClass("valid_limit_comma-"+b).addClass("valid_limit_comma-"+c);this.starinvite_validator.setupInfield(this.controls.starinvite_email[0]);this.controls.starinvite_left.html("("+c+" left)");this.auth.resetRevision();if(c==0){this.controls.starinvite_link.hide()}Message.showMessage((d.message?d.message:"Invitation(s) sent. "+c+" left."),this.controls.starinvitemessage[0])}else{Message.showMessage((d.message?d.message:"Invitation(s) sent."),this.controls.starinvitemessage[0])}this.fireEvent("onInviteSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"starinvite",sync_this:this.syncEffect.bind(this)}});this.controls.starinvite_email.val("");this.mystate="idle"}else{Message.showMessage((d.message?d.message:"Invitation failed."),this.controls.starinvitemessage[0]);this.mystate="starinvite_dialog_visible"}break;case"postSave":this.enableInputs("tagheader");this.controls.tagheader_indicator.hide();if(d.success){Message.showMessage((d.message?d.message:"Tagheader saved."),this.controls.tagheadermessage[0]);this.fireEvent("onTagheaderSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"tagheader",sync_this:this.syncEffect.bind(this)}});this.controls.tagheader_entry_orig.html(this.controls.tagheader_entry.val());this.mystate="idle"}else{Message.showMessage((d.message?d.message:"Tagheader save failed."),this.controls.tagheadermessage[0]);this.mystate="tagheader_dialog_visible"}break}},handleAjaxFail:function(){switch(this.mystate){case"starinvite_sent":this.enableInputs("starinvite");this.mystate="starinvite_dialog_visible";break;case"tagheader_sent":this.enableInputs("tagheader");this.mystate="tagheader_dialog_visible";break}},disableInputs:function(b){switch(b){case"starinvite":this.controls.starinvite_email[0].disabled=true;this.controls.starinvite_submit[0].disabled=true;this.controls.starinvite_cancel[0].disabled=true;break;case"tagheader":this.controls.tagheader_entry[0].disabled=true;
this.controls.tagheader_submit[0].disabled=true;this.controls.tagheader_cancel[0].disabled=true;break}},enableInputs:function(b){switch(b){case"starinvite":this.controls.starinvite_email[0].disabled=false;this.controls.starinvite_submit[0].disabled=false;this.controls.starinvite_cancel[0].disabled=false;break;case"tagheader":this.controls.tagheader_entry[0].disabled=false;this.controls.tagheader_submit[0].disabled=false;this.controls.tagheader_cancel[0].disabled=false;break}}});a.extend(a.ui.EditorControlsWidget,{version:"1.0",defaults:{controlClass:"editor_control",externalElement:".presence_control_external, .editorControlsWidget_external, #presence_external_templates",show_validation_errors:true,starinvite_action_url:"/index.php?op=sendinvite",tagheader_action_url:"/index.php?op=admin_savepost",onInviteSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"},onTagheaderSuccess:function(b){window.setTimeout(function(){b.syncEffect()},1000);return"will_sync"}}})})(jQuery);(function(a){a.widget("ui.GalleryWidget",{initialize:function(){this.gallery=this.options.galleryData;if(this.gallery===undefined){this.gallery={}}if(this.gallery.images===undefined){this.gallery.images=[]}var c=this;jQuery("#galleryNextImage").click(function(d){c.loadItem("next");d.preventDefault();d.stopPropagation()});jQuery("#galleryPrevImage").click(function(d){c.loadItem("prev");d.preventDefault();d.stopPropagation()});jQuery("#thumbs .thumb").click(function(d){var f=parseInt(jQuery(d.target).data("pos"),10);c.loadItem(f);d.preventDefault();d.stopPropagation()});jQuery("#thumbPagerPrev").click(function(d){c.pageThumbs(false);d.preventDefault();d.stopPropagation()});jQuery("#thumbPagerNext").click(function(d){c.pageThumbs(true);d.preventDefault();d.stopPropagation()});this.selImage=this.options.selImgPos;this.curContainer=1;this.thumbPages=[0];this.thumbs=jQuery("#thumbList img");var b=0;setBodyPageType("gallery");this.prepareOverlay();if(typeof this.overlaydiv!=="undefined"){this.overlaydiv.show()}},prepareOverlay:function(){if(typeof this.overlaydiv=="undefined"){var c=jQuery("#illustration_overlay");if(c.length>0){var d=c.attr("data-src");this.overlaydiv=jQuery(document.createElement("div"));this.overlaydiv.attr("id","illustration_overlay");this.overlaydiv.hide();overlayimg=jQuery(document.createElement("img"));overlayimg.attr("src",d);c.remove();jQuery("#gallery_container").before(this.overlaydiv);this.overlaydiv.html(overlayimg);var b=this.overlaydiv;overlayimg.load(function(){b.css("width",overlayimg.width());b.css("height",overlayimg.height())})}}},loadItem:function(h){if(h=="next"){if(this.selImage<this.gallery.images.length-1){h=this.selImage+1}else{h=0}}else{if(h=="prev"){if(this.selImage>0){h=this.selImage-1}else{h=this.gallery.images.length-1}}}var e=3-this.curContainer;var g=this.gallery.images[h];if(g==undefined){return}jQuery("#galleryOverlay").show();jQuery("#galleryOverlay .spinner").spin("large","white");var d=function(l,k,j){return function(){l.thumbs.removeClass("current");l.thumbs.eq(j).addClass("current");var n=jQuery("#galleryItem"+k+" img");jQuery("#galleryItem"+k).show();jQuery("#captionHolder"+k).show();jQuery("#captionHolder"+l.curContainer).hide();jQuery("#gallerypost_container").removeClass("selImage_"+l.selImage).addClass("selImage_"+j);if(n.length>0){var m=n.width()/n.height();var q=16/9;if(m>=q){n.width(640)}if(m<=q){n.height(360)}}jQuery("#galleryItem"+(3-k)).hide().html('<span id="galleryPlaceholder'+(3-k)+'"></span>');l.curContainer=k;l.selImage=j;var o=l.thumbs.last();var r=jQuery("#thumbs").width();if(o.position().left+o.width()>jQuery("#thumbWindow").width()){var p=0;if(j>2){p=l.thumbs.eq(j-2).position().left-5}jQuery("#thumbList").css("left",-1*p);jQuery.proxy(l.disableButtons(p,r),l)}jQuery("#galleryOverlay .spinner").spin(false);jQuery("#galleryOverlay").hide();if(l.selImage==0){l.prepareOverlay();if(typeof l.overlaydiv!=="undefined"){l.overlaydiv.show()}}else{if(typeof l.overlaydiv!=="undefined"){l.overlaydiv.hide()}}}};var c=d(this,e,h);jQuery("#captionHolder"+e).html(g.caption);if(g.videoData!==false){g.videoData.customHandler=c;g.videoData.width=640;g.videoData.height=360;VideoHandler.dumpObject(g.videoData,"galleryItem"+e);jQuery("#galleryExpand").attr("href","#").css("opacity",0)}else{var b=jQuery(document.createElement("img"));var f=this;b.click(function(j){f.loadItem("next");j.preventDefault();j.stopPropagation()});b.load(c);b.attr("src",g.bigimage);jQuery("#galleryPlaceholder"+e).replaceWith(b);if(g.bigimage1600!==undefined){jQuery("#galleryExpand").attr("href",g.bigimage1600).css("opacity",1)}else{jQuery("#galleryExpand").attr("href","#").css("opacity",0)}}trackers.reload({post_id:window.postId});a(document).trigger("gallery.image.changed")},pageThumbs:function(b){var h=this.thumbs.last();var j=h.position().left+h.width();var e=595;if(j>e){var g=-1*parseInt(jQuery("#thumbList").css("left"),10);var d=0;if(b!==true){b=false}if(b&&j-g<e){return}if(!b&&g==0){return
}var c=g+((b?1:-1)*e);if(c<0){c=0}if(c>j-e+7){c=j-e+7}var f=-1*c+"px";jQuery("#thumbList").css("left",f);this.disableButtons(c,e)}},disableButtons:function(e,c){var d=jQuery("#thumbPagerPrev");var b=jQuery("#thumbPagerNext");if(e==0){d.addClass("inactive")}else{if(d.hasClass("inactive")){d.removeClass("inactive")}}if(c<e){b.addClass("inactive")}else{if(b.hasClass("inactive")){b.removeClass("inactive")}}}});a.extend(a.ui.GalleryWidget,{version:"1.0",defaults:{controlClass:"galcn",externalElement:".galcn_external"}})})(jQuery);(function(a){a.widget("ui.HybridLink",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"hybridlink",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.showWidget()},handleClick:function(c){var b=this.getParam("cn",jQuery(c.target));switch(b){case"link":var d={op:"hybrid_add_tag",tagName:this.getParam("tag",jQuery(c.target))};this.xhr.send("/",d);c.stopPropagation();c.preventDefault();break}},handleAjaxRequest:function(){this.controls.indicator.show()},handleAjaxSuccess:function(b){Message.showMessage(b.message,this.controls.message[0]);document.location=b.url},handleAjaxFail:function(){this.controls.indicator.hide();Message.showMessage("Request failed",this.controls.message[0])}});a.extend(a.ui.HybridLink,{version:"1.0",defaults:{controlClass:"hybrid_control"}})})(jQuery);var SocialButtons={thirdpartyDisabled:gawker_parseQueryString(window.location.search.substring(1)).thirdparty==="false",referrerDomain:gawker_getDomain(document.referrer),referrers:{"twitter.com":"twitter","t.co":"twitter","linkedin.com":"linkedin","www.linkedin.com":"linkedin","www.stumbleupon.com":"stumbleupon"},scripts:{},getScript:function(a){if(this.thirdpartyDisabled){return Promise.NEVER}else{if(!this.scripts[a]){this.scripts[a]=gawker_getScript(a)}return this.scripts[a]}},googleplusScript:function(){window.___gcfg={parsetags:"explicit"};return this.getScript("https://apis.google.com/js/plusone.js")},fbScript:function(){window.fbAsyncInit=function(){FB.init({appId:"236575159691634",status:true,cookie:true,xfbml:true})};return this.getScript("//connect.facebook.net/en_US/all.js")},twitterScript:function(){return this.getScript("//platform.twitter.com/widgets.js")},stumbleuponScript:function(){return this.getScript("//platform.stumbleupon.com/1/widgets.js")},linkedinScript:function(){return this.getScript("//platform.linkedin.com/in.js")},update:function(b){if(b.length){b.children().hide();var c=this.referrers[this.referrerDomain];if(!this[c]){c="facebook"}var a=b.children("."+c).show();this[c](a)}},facebook:function(a){this.fbScript().then(function(){if(window.FB){FB.XFBML.parse(a[0])}})},twitter:function(){this.twitterScript().then(function(){if(window.twttr){twttr.widgets.load()}})},stumbleupon:function(){this.stumbleuponScript().then(function(){if(window.STMBLPN){STMBLPN.processWidgets()}})},linkedin:function(a){a.append('<script type="IN/Share" data-url="'+jQuery("link[rel=canonical]").attr("href")+'" data-counter="right"><\/script>');this.linkedinScript().then(function(){console.log(IN,IN.parse);if(window.IN){IN.init()}})}};var spongedebug;(function(a){a.widget("ui.MiniRightbarWidget",{de:{posts:{}},initialize:function(){jQuery("#load_more").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.gotoPage({target:b.target,direction:"next"})},this));jQuery("#load_previous").click(jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();this.gotoPage({target:b.target,direction:"prev"})},this));jQuery("#switch_popular").click(jQuery.proxy(function(b){jQuery("#sidebarmode span.selected").html("MOST POPULAR");jQuery("#sidebarmode ul").hide();b.stopPropagation();b.preventDefault();this.loadPopular()},this));jQuery("#switch_latest").click(jQuery.proxy(function(b){jQuery("#sidebarmode span.selected").html("LATEST STORIES");jQuery("#sidebarmode ul").hide();b.stopPropagation();b.preventDefault();this.loadLatest()},this));jQuery("#switch_commented").click(jQuery.proxy(function(b){jQuery("#sidebarmode span.selected").html("MOST DISCUSSED");jQuery("#sidebarmode ul").hide();b.stopPropagation();b.preventDefault();this.loadCommented()},this));if(jQuery("#post_list .latestpost").length){jQuery("#load_previous").hide()}if(jQuery("#post_list .oldestpost").length){jQuery("#load_more").hide()}this.initAirportIterator();this.restoreRightbarState();this.setDropdown();this.spongesettings={retries:10,interval:1};this.refreshPostlist()},initAirportIterator:function(){this.airiterator=0;this.tid=setTimeout(jQuery.proxy(this.airportDisplayChange,this),5000);jQuery("#post_list .airport").live("click",jQuery.proxy(this.airportDisplayChange,this))},gotoPage:function(e){var c,d,b;if(e.direction=="prev"){c=jQuery("#post_list li:first-child").get(0).id.substring(7)}else{if(e.direction=="next"){c=jQuery("#post_list li:last-child").get(0).id.substring(7)}}d=this.getParam("tag",jQuery("#post_list"));
if(typeof d!="undefined"){b="&tagName="+d}else{b=""}a("#rightcontainer .wrap").addClass("loading");a(e.target).html("Loading&hellip;");jQuery.get("/index.php?op=ajaxlight_rightbar&direction="+e.direction+"&refId="+c+b,jQuery.proxy(function(f){this.insertContent(f,e.direction)},this))},insertContent:function(d,e){var c,b;if(e=="prev"){c=".latestpost";b="#load_previous";jQuery("#post_list").prepend(d.content)}else{c=".oldestpost";b="#load_more";jQuery("#post_list").append(d.content)}a("#rightcontainer .wrap").removeClass("loading");a(b).html((e=="prev"?"Newer":"More")+"&nbsp;Stories&hellip;");if(jQuery("#post_list "+c).length){jQuery(b).hide()}var f=this.getParam("tag",jQuery("#post_list"));if(window.sponsored!==undefined&&typeof f=="undefined"){window.sponsored.displayOldSponsoredPosts()}if(typeof f!="undefined"){jQuery("#rightcontainer :not(.tag:contains('"+f+"'))").fadeTo("slow","0.3")}this.refreshPostlist()},loadPopular:function(){var b=jQuery("#post_list");this.mode="popular";b.css({opacity:0.4});jQuery("#post_list_cache").html(b.html());jQuery.get("/index.php?op=ajaxlight_rightbar&mode=popular",jQuery.proxy(function(c){jQuery("#rightcontainer .stories").hide();if(c.content){b.html(c.content)}this.refreshPostlist();this.airportDisplayChange({},"uniques");b.css({opacity:1})},this));this.saveRightbarState("popular")},loadCommented:function(){var b=jQuery("#post_list");this.mode="commented";b.css({opacity:0.4});jQuery("#post_list_cache").html(b.html());jQuery.get("/index.php?op=ajaxlight_rightbar&mode=commented",jQuery.proxy(function(c){jQuery("#rightcontainer .stories").hide();if(c.content){b.html(c.content)}this.refreshPostlist();this.airportDisplayChange({},"comments");b.css({opacity:1})},this));this.saveRightbarState("commented")},loadLatest:function(){var b=jQuery("#post_list");this.mode="latest";if(jQuery("#post_list_cache li").eq(0).html().length){jQuery("#rightcontainer .stories").show();b.html(jQuery("#post_list_cache").html())}else{b.css({opacity:0.4});jQuery.get("/index.php?op=ajaxlight_rightbar&direction=latest&mode=current&"+(window.postId?"&refId="+window.postId:""),function(c){jQuery("#rightcontainer .stories").show();if(c.content){b.html(c.content)}b.css({opacity:1})})}this.refreshPostlist();this.airportDisplayChange();this.saveRightbarState("")},saveRightbarState:function(b){jQuery.cookie("gawkermedia_rightbarstate",b,{path:"/"})},restoreRightbarState:function(){var b=jQuery.cookie("gawkermedia_rightbarstate");if(b!=="popular"&&b!=="commented"){return}jQuery("#switch_"+b).click()},setDropdown:function(){jQuery("#sidebarmode").bind("click",function(){if(jQuery("#sidebarmode ul:visible").length===0){jQuery("#sidebarmode ul").show();jQuery("#sidebarmode").bind("clickoutside",function(){jQuery("#sidebarmode ul").hide();jQuery("#sidebarmode").unbind("clickoutside")})}else{jQuery("#sidebarmode ul").hide()}})},airportDisplayChange:function(b,d){clearTimeout(this.tid);var c=[];if(d===undefined){if(jQuery("#post_list .airport.views").length>0){c=["views"]}if(jQuery("#post_list .airport.uniques").length>0){c.push("uniques")}if(jQuery("#post_list .airport.comments").length>0){c.push("comments")}if(jQuery("#post_list .airport.date").length>0){c.push("date")}if(jQuery("#post_list .airport.timestamp").length>0){c.push("timestamp")}}else{c.push(d)}jQuery("#post_list .airport").hide();jQuery("#post_list .airport."+c[(this.airiterator%c.length)]).show();this.airiterator++;if(this.mode!=="popular"&&this.mode!=="commented"){this.tid=setTimeout(jQuery.proxy(this.airportDisplayChange,this),5000)}else{clearTimeout(this.tid)}},refreshPostlist:function(){this.de.posts=jQuery("#post_list").children("li");this.loadSpongeStats()},getStatlessPostUrls:function(){var e=[],d;for(var c=0,b=this.de.posts.length;c<b;c++){d=jQuery(this.de.posts[c]);postid=this.getParam("postid",d);if(postid>0&&d.data("statready")!=true&&(d.data("spongetries")===undefined||d.data("spongetries")<this.spongesettings.retries)){if(typeof d.find("a.headline").data("canonical-href")!="undefined"){e.push(d.find("a.headline").data("canonical-href"))}else{e.push(d.find("a.headline").attr("href"))}}}return e},loadSpongeStats:function(){var b=this.getStatlessPostUrls();if(typeof sponge_client!=="undefined"){if(!this.spongestats){this.spongestats=GawkerClientside.widgets.spongestatsclient[0]}this.spongestats.getStats(b,this,this.insertSpongeStatsResults)}},insertSpongeStatsResults:function(c){this.spongestats.requests_running--;var e,b,g,d,f,j,h;if(c.data===undefined){return false}for(e=0,b=this.de.posts.length;e<b;e++){d=jQuery(this.de.posts[e]);g=c.data[d.find("a.headline").attr("href")];if(typeof g=="undefined"){g=c.data[d.find("a.headline").data("canonical-href")]}if(g!==undefined){f=true;h=[];j=d.data("spongetries")>0?d.data("spongetries")+1:1;if(g.views!==undefined&&g.views.ready==true){d.find(".views").html(gawker_add_commas(g.views.totalViews));d.find(".uniques").html(gawker_add_commas(g.views.totalUniqueViews));if(g.views.totalViews>this.spongestats.options.views_limit){d.find(".views").addClass("highlight")
}h.push(g.views.totalViews+" pageviews, "+g.views.totalUniqueViews+" visitors");d.data("views",g.views.totalViews)}else{d.find(".views").html("");d.find(".uniques").html("");f=false}if(g.comments!==undefined&&g.comments.ready==true){d.find(".comments").html(gawker_add_commas(g.comments.numComments));if(g.comments.numComments>this.spongestats.options.comments_limit){d.find(".comments").addClass("highlight")}h.push(g.comments.numComments+" comments");d.data("comments",g.comments.numComments)}else{d.find(".comments").html("");f=false}d.find(".airport").css({opacity:1});d.find(".airport:empty").css({opacity:0});d.data("statready",f);d.find(".views, .uniques, .comments").attr("title",h.join(", "));d.find(".views, .uniques, .comments").attr("alt",h.join(", "));if(f===false){d.data("spongetries",(d.data("spongetries")===undefined?1:Math.floor(d.data("spongetries"))+1))}}}if((this.spongestats.requests_running==0)&&(this.getStatlessPostUrls().length>0)){setTimeout(jQuery.proxy(this.loadSpongeStats,this),(this.spongesettings.interval*1000))}else{if(this.getStatlessPostUrls().length===0&&this.mode==="commented"){this.sortPostsBy("comments")}}},sortPostsBy:function(c){var b=jQuery(this.de.posts).sort(function(e,d){return jQuery(d).data(c)-jQuery(e).data(c)});jQuery("#post_list").empty().append(b)}});a.extend(a.ui.MiniRightbarWidget,{version:"2.0b",defaults:{controlClass:"rbc",externalElement:".rightbar_external"}})})(jQuery);(function(a){a.widget("ui.NotificationWidget",{initialize:function(){if(this.feature.isOn(this.feature.POWWOW)){this.subscribeForEvent("user.auth.",this.powwow_authEventHandler.bind(this));this.subscribeForEvent("notification.",this.powwow_notificationEventHandler.bind(this));this.subscribeForEvent("powwow.",this.powwow_powwowEventHandler.bind(this));this.notificationLimit=4;this.notifications=[];this.hasMoreNotifications=false;this.unseenNotificationCount=0;this.notificationsVisible=false;this.lastSeenTimestamp=0;this.userId=null}else{this.xhr=new XHR({klass:"notification",success:this.handleAjaxSuccess.bind(this)});this.notificationType="latest";this.registerEventHandler(this.element,"click",this.handleClick.bind(this));var c=this;jQuery("#clearNotifications").click(function(d){c.handleClick(d)});var b=jQuery("#userMenu");this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("notification.",this.notificationHandler.bind(this));this.newpost_num=0;this.postIds={top:[],top10:[],latest:[]};this.newposts=[];this.postElement=jQuery("#post_notification");this.userElement=jQuery("#user_notification");this.notifications=[];this.notificationsVisible=false;this.loadUserTemplates()}},powwow_authEventHandler:function(b){switch(b.name){case"user.auth.ssoSuccess":this.isBurner=b.source.data.loggedIn&&b.source.data.user.authType==="burner";if(b.source.data.loggedIn){this.userId=b.source.data.user.id;this.powwow_hideNotificationList();this.powwow_clearNotificationList();this.powwow_getNotifications()}break;case"user.auth.ssoFailure":this.isBurner=false;this.powwow_hideNotificationList();this.powwow_clearNotificationList();break}},powwow_notificationEventHandler:function(c){switch(c.name){case"notification.togglelist":if(this.notificationsVisible===true){this.powwow_hideNotificationList()}else{var b=this;jQuery("#userMenu").bind("clickoutside",function(){b.powwow_hideNotificationList()});this.powwow_showNotificationList()}break}},powwow_powwowEventHandler:function(b){switch(b.name){case"powwow.commentsLoaded":window.setTimeout(function(){var c=window.location.search.match(/[\?&]comment=([0-9]+)/);if(c){Powwow.getCommentOffset(c[1],function(e){if(e){var d=Powwow.getIframeOffset().top+e.top-10;jQuery(document).stop().scrollTo(d,125)}})}},1000);break;case"powwow.notificationsCleared":this.unseenNotificationCount=0;this.powwow_notificationsChanged();break}},powwow_ajax:function(b){jQuery.ajax({url:siteConfig.powwowBasePath+"api/v1/notification/",data:b,dataType:"jsonp",jsonp:"jsonP",success:this.powwow_handleAjaxSuccess.bind(this),error:this.powwow_handleAjaxFailure.bind(this)})},powwow_getNotifications:function(){if(!this.userId){return}this.powwow_ajax({method:"notification.get",username:this.userId})},powwow_flushNotifications:function(){if(!this.userId){return}if(this.notifications.length>0&&this.notifications[0].timestamp>0){this.powwow_ajax({method:"notification.flush",lastSeenTimestamp:this.notifications[0].timestamp,username:this.userId})}},powwow_handleAjaxSuccess:function(c){var d=this;var b=(function(k,h,e){var j='<a href="/me/inbox" class="inboxLink">View your Inbox</a>';if(typeof e!=="undefined"&&jQuery.isArray(e)&&e.length>0){jQuery.each(e,function(m,n){var o=n.link?'<a href="'+n.link+'">'+n.text+"</a>":n.text;d.powwow_addNotification(o,n.ts||0)})}if(k.length===0||h===0){this.powwow_addNotification(j,0);return}var l=[];for(var f=0;f<k.length;f++){if(l.length>=4){break}if(k[f].issued<=this.lastSeenTimestamp){continue}if(jQuery.inArray(k[f].author.displayName,l)===-1){l.push(k[f].author.displayName)
}}switch(l.length){case 0:this.powwow_addNotification(j,0);return;case 1:l=l[0];break;case 2:l=l[0]+" and "+l[1];break;case 3:l=l[0]+", "+l[1]+" and "+l[2];break;default:l=l[0]+", "+l[1]+", "+l[2]+" and more";break}var g=(h===1)?"a new reply":h+" new replies";this.powwow_addNotification("You have "+g+" from "+l+". "+j,k[0].issued)}).bind(this);if(c.meta!==undefined&&c.meta.success===true){switch(c.meta.method.toLowerCase()){case"notification.get":this.hasMoreNotifications=(c.data.paging.hasMore||false)===true;this.lastSeenTimestamp=parseInt(c.data.lastSeenTimestamp||0);this.unseenNotificationCount=parseInt(c.data.newEntries||0);b(c.data.comment||[],this.unseenNotificationCount,c.data.notifications);break;case"notification.flush":this.lastSeenTimestamp=parseInt(c.data.lastSeenTimestamp||0);this.unseenNotificationCount=0;break}this.powwow_notificationsChanged()}},powwow_handleAjaxFailure:function(){this.powwow_hideNotificationList();this.powwow_clearNotificationList()},powwow_addNotification:function(c,b){this.notifications.push({text:c,timestamp:b});jQuery("#userMenu").addClass("notifications")},powwow_notificationsChanged:function(){this.notifications.sort(function(e,d){return d.timestamp-e.timestamp});var c="";for(var b=0;b<Math.min(this.notifications.length,this.notificationLimit);b++){c+='<div class="notice">'+this.notifications[b].text+"</div>"}jQuery("#userNotificationContainer").html(c);jQuery("#profileNotificationCounter").html(this.unseenNotificationCount).toggle(this.unseenNotificationCount>0);jQuery("#userNotificationContainer").click((function(d){window.location.href="/me/inbox"}).bind(this));jQuery("#userNotificationContainer a").click((function(d){this.powwow_hideNotificationList()}).bind(this))},powwow_showNotificationList:function(){jQuery("#userMenu").show();this.notificationsVisible=true;this.powwow_flushNotifications()},powwow_hideNotificationList:function(){jQuery("#userMenu").hide();jQuery("#userMenu").removeClass("notifications");this.notificationsVisible=false},powwow_clearNotificationList:function(){jQuery("#userNotificationContainer").html("");jQuery("#profileNotificationCounter").hide().html("");this.notifications=[];this.unseenNotificationCount=0},notificationHandler:function(b){switch(b.name){case"notification.togglelist":if(this.notificationsVisible===true){this.hideNotificationList()}else{this.showNotificationList()}break}},handleClick:function(h){var g=jQuery(h.target);if(g.attr("id")=="clearNotifications"){this.clearNotifications();h.preventDefault();h.stopPropagation()}else{if(g.hasClass("cn_wrap")){var f=this;var c=jQuery("#post_notification");var d={width:c.outerWidth(),height:c.outerHeight(),"margin-top":-1*c.outerHeight(true)};var b=jQuery("#post_notification_overlay").css(d).html('<img src="/assets/base.v10/img/indicator/progressIndicator_roller.gif" />');b.fadeTo(500,0.8,function(){f.showNewPosts()});h.preventDefault();h.stopPropagation()}}},handleAjaxSuccess:function(b){if(b.action=="newposts"){if(b.success){this.updateNotification(b);this.raiseEvent("notification.newpost",{data:b})}}else{if(b.action=="inflownotifications"){if(b.success){if(b.newPointer!==undefined){this.notificationsCleared()}else{if(b.items!==undefined){this.userNotificationLoaded(b)}}}}}},authEventHandler:function(b){if(this.auth.now!==undefined&&!isNaN(this.auth.now)){this.updateBase=this.auth.now;this.now=Math.round(new Date().getTime()/1000);this.setLastUpdate()}var c=this;switch(b.name){case"user.auth.success":this.getUserNotifications();break;case"user.auth.failure":this.hideNotificationList();this.clearNotificationList();break}},getUserNotifications:function(){var b={op:"commentinflow",countOnly:0,updatePointer:0,startIndex:0,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},userNotificationLoaded:function(b){this.parseUserNotifications(b)},loadUserTemplates:function(){this.userTemplates={};var b=this;jQuery("#notif_templates span").each(function(){var c=jQuery(this);b.userTemplates[this.className]=c.html()})},createNotices:function(k,c,b){var g="";var h=["youAre","userName","you","time","youHave","postLink","postName","your","commentLink","messageLink"];if(!b){b=0}var d=b+c;if(d>k.length){d=k.length}for(var f=b;f<d;f++){var n=k[f];var m=this.userTemplates[n.type];for(var e=0;e<h.length;e++){var l=h[e];if(n[l]!==undefined){m=m.replace("%"+l+"%",n[l]);m=m.replace("|"+l+"|",n[l]);m=m.replace("%7C"+l+"%7C",n[l]);m=m.replace("#"+l+"#",n[l])}}g+='<div class="notice">'+m+"</div>";if(f==b+c-1&&k.length>b+c){g+='<div class="notice morelink pointer_'+f+'"><a href="#">more</a></div>';g+='<div class="notices_'+f+'" style="display: none;">';g+=this.createNotices(k,c,f+1);g+="</div>"}}return g},moreClickHandler:function(c){var b=jQuery(c.target);if(!b.hasClass("morelink")){b=b.closest(".morelink")}var d=this.getParam("pointer",b);jQuery("#userMenu div.morelink.pointer_"+d).hide();jQuery("#userMenu div.notices_"+d).show();c.stopPropagation=true;c.preventDefault=true},parseUserNotifications:function(c){var e=false;
if(c.items===undefined){c.items=[]}this.notifications=c.items;if(c.items.length>0){var b=jQuery("#userNotificationContainer");b.html(this.createNotices(c.items,5));var d=this;jQuery("#userMenu div.morelink, #userMenu div.morelink a").click(function(f){d.moreClickHandler(f)});this.clearOnHide=false;jQuery("#profileNotificationCounter").html(c.items.length).show();jQuery("#clearNotifications").show()}else{jQuery("#clearNotifications").hide()}},showNotificationList:function(){var b=jQuery("#userMenu");b.show();this.notificationsVisible=true},hideNotificationList:function(){var b=jQuery("#userMenu");b.hide();this.notificationsVisible=false},clearNotifications:function(){if(true){jQuery.cookie("ssomigrate_notify",1,{path:"/",expires:3})}var b={op:"commentinflow",countOnly:1,updatePointer:1,r:this.auth.getRevision()};this.xhr.send("/index.php",b)},clearNotificationList:function(){jQuery("#userNotificationContainer").html("");jQuery("#profileNotificationCounter").hide().html("");jQuery("#clearNotifications").hide();this.notifications=[]},notificationsCleared:function(){this.hideNotificationList();this.clearNotificationList()},resetControls:function(){this.setControls()},checkNotifications:function(){if(this.notificationType=="latest"){var b={op:"ajax_remoteservice",type:"newpostd",siteId:this.options.siteId,lastUpdate:this.last_update}}},filterNotifications:function(h){var b=["top","top10","latest"];for(var d=0;d<b.length;d++){var f=b[d];var e=[];for(var c=0;c<h[f].length;c++){var g=h[f][c];if(jQuery.inArray(g,this.postIds[f])==-1){e.push(g);this.postIds[f].push(g)}}h[f]=e}return h},updateNotification:function(b){b=this.filterNotifications(b);if(b.latest.length>0){jQuery.merge(this.newposts,b.latest);this.showNewStoriesBadge(b.latest.length)}this.setLastUpdate()},showNewStoriesBadge:function(b){var c=this.controls.wrap;this.newpost_num+=b;c.html("<strong>"+this.newpost_num+" new stor"+(this.newpost_num>1?"ies":"y")+" published</strong>, click to view.");this.postElement.css("opacity",1).show()},showBreakingList:function(e){var d="";for(var c=0;c<e.posts.length;c++){var b=e.posts[c];d+='<div class="notifbadge breakingbadge"><a class="notificationControl cn_breakinglink postid_'+b.id+'" href="'+b.permalink+'"><b>Breaking</b>: '+b.title+"</a></div>"}jQuery("#breaking_notification").html(jQuery("#breaking_notification").html()+d);jQuery("#breaking_notification").show();jQuery("#breaking_notification a").bind("click",this.handleClick.bind(this))},showBreakingPost:function(d){var c=jQuery("#breaking_notification a.postid_"+d);var b=c.parents("div.breakingbadge");this.raiseEvent("navigation.setHash",{href:c.attr("href")});b.hide()},setLastUpdate:function(){this.last_update=this.updateBase+(Math.round(new Date().getTime()/1000)-this.now)},showNewPosts:function(){params={op:"newposts",ids:this.newposts};var b=this;jQuery.get("index.php",params,function(d){jQuery("#post_notification_overlay").fadeOut(500);jQuery("#post_notification").fadeOut(500);var c={data:d.content.replace("post siteid","post notificationpost siteid")};b.raiseEvent("notification.loaded",c)});this.newpost_num=0;this.newposts=[]},showMoreUserNotifications:function(){this.controls.user_header.hide();this.getUserNotifications(false)}});a.extend(a.ui.NotificationWidget,{version:"1.0",defaults:{controlClass:"notificationControl"}})})(jQuery);(function(a){a.widget("ui.PostWidget",{initialize:function(){this.processImages();this.showOverlay();this.spongesettings={retries:10,interval:1};this.loadSpongeStats();SocialButtons.update(a("#socialbuttons"));SocialButtons.googleplusScript().then(function(){window.gapi.plusone.go(a("#gplus")[0])});this.fixImagesNextToLongAds();jQuery(".content").delegate(".scrolltonewcomment","click",jQuery.proxy(function(b){b.stopPropagation();b.preventDefault();jQuery(window).scrollTo("#thread_navigation",300);if(this.feature.isOn(this.feature.POWWOW)&&typeof Powwow!=="undefined"){Powwow.openCommentForm()}else{jQuery("#thread_new").click()}return false},this))},showOverlay:function(){var b=jQuery(".post-body #illustration_overlay");if(b.length>0){var c=b.attr("data-src");overlaydiv=jQuery(document.createElement("div"));overlaydiv.attr("id","illustration_overlay");overlayimg=jQuery(document.createElement("img"));overlayimg.attr("src",c);b.remove();jQuery(".illustration.top").before(overlaydiv);overlaydiv.html(overlayimg);overlayimg.load(function(){overlaydiv.css("width",overlayimg.width());overlaydiv.css("height",overlayimg.height())})}},fixImagesNextToLongAds:function(){if(jQuery(".post-supp").length===0){return}var e=jQuery(".post-supp"),d=e.height(),b=e.offset().top,c=d+b;this.element.find(".post-body img").each(function(j,g){var h=jQuery(g);var m=h.offset().top<=c+10;var k=h.closest("p");if(k.length>0&&k.prev().length>0){var f=k.prev();var l=f[0].tagName=="DIV"&&f.css("clear")=="both";if(l){var m=h.offset().top<c;h.css("marginTop","13px")}}if(m&&(!h.hasClass("thumb"))){h.css("marginRight","0")}else{return false}})},processImages:function(){var t=function(B,z,v,A,G){if(jQuery.data(B,"replaced")===undefined){jQuery.data(B,"replaced",true)
}var D=B.width();var w=B.height();var y=B.hasClass("wide")?"":"left";if(B.hasClass("right")){y="right"}var F=B.attr("style");var E="";if(F!==undefined){var C=F.match(/top:\s*([\-0-9]+)/);if(C!==null){E+="top: "+C[1]+"px;"}C=F.match(/left\:\s*([\-0-9]+)/);if(C!==null){E+="left: "+C[1]+"px;"}C=F.match(/display\:\s*([^ ]+)/);if(C!==null){E+="display: "+C[1]+"px;"}}y+=B.hasClass("wide")?"":" editorial";if(B.css("display").toLowerCase()!=="none"&&!B.hasClass("splashimg")&&!B.parents("a").size()){var l='<div class="lyteboxContainer '+y+'" style="'+E+"width: "+D+"px; height: "+w+'px;">';if(G&&D==640){l+='<a href="'+G+'" target="_blank"><img src="'+z+'" width="'+D+'" height="'+w+'" /></a>'}else{l+='<div class="lyteboxLink"><a href="'+v+'" class="noHrefOverride" rel="lytebox">Full size</a></div>';l+='<img src="'+z+'" width="'+D+'" height="'+w+'" />'}l+="</div>";B.replaceWith(l)}return this};var c=function(l){var y=l.width();var v=l.height();var w=!l.hasClass("v10_wide")?300:640;if(!y||y>w){l.attr("width",w);if(y&&v){l.attr("height",null)}}return this};var h=this;var e=jQuery("div.post-body img, div.imgwrap.abovewrap img, img.editorial.above, div.post > .illustration img");var r={};var j;for(var n=0,k=e.length;n<k;n++){var u=jQuery(e[n]);var s=null;try{if(e[n].src){s=e[n].src}else{s=u.css("background-image").replace(/^url\((.*)\)$/,"$1")}}catch(o){}var f=null;if(s!==null){f=s.replace(/http:\/\/[^\/]+/,"")}if(s.match(/^http:\/\/img.gawkerassets.com\/img\//)){j=s.match(/([^\/]+)\/(?:xlarge|medium|original)[^\/]+$/)}else{j=s.match(/\/(?:xlarge_|medium_)?([a-zA-Z0-9\.\_\-\%]+)$/)}if(j!==null){if(r[j[1]]!==undefined){u.hide();continue}r[j[1]]=true}if(!u.hasClass("avatar")&&u.closest("div.post-body").length>0&&u.closest("div.illustration, div#gallery_container, div#thumbList, div.iconmeta").length===0){var b=!u.hasClass("v10_wide")?300:640;u.css("max-width",b+"px");u.one("load",function(v){var l=jQuery(v.target);c(l)});if(u[0].readyState&&u[0].readyState==="complete"){u.trigger("load")}}if(u.closest("div#thumbList").length>0||jQuery(e[n]).hasClass("noLytebox")){continue}if(h.options.img_data===null||typeof h.options.img_data.lookup=="undefined"||typeof h.options.img_data.lookup[f]=="undefined"){continue}var p=h.options.img_data.lookup[f];if(h.options.img_data.data[p.pos].original.width*0.9>jQuery(e[n]).width()){var d=h.options.img_data.data[p.pos].original.url;var m=h.options.img_data.splashlink||false;var q=u.get(0).tagName.toLowerCase();if(q=="div"){t(u,s,d,h.options.img_data.data[p.pos][p.transform],m)}else{if(q=="img"){var g=function(l){var y=h.options.img_data.data[p.pos][p.transform];var v=s;var w=d;return function(z){t(l,v,w,y,m)}};u.one("load",g(u));if(u[0].readyState&&u[0].readyState==="complete"){u.trigger("load")}}}}}},loadSpongeStats:function(){var b=jQuery(".post-supp .post-meta").data("permalink");var c=[];if(b){c=[b]}if(typeof sponge_client!=="undefined"){if(!this.spongestats){this.spongestats=GawkerClientside.widgets.spongestatsclient[0]}this.spongestats.getStats(c,this,this.insertSpongeStatsResults)}},insertSpongeStatsResults:function(c){this.spongestats.requests_running--;var e,b,g,d,f,j,h;if(c.data===undefined){return false}d=jQuery(".post-meta");g=c.data[jQuery(".post-supp .post-meta").data("permalink")];if(g!==undefined){f=true;h=[];j=d.data("spongetries")>0?d.data("spongetries")+1:1;if(g.views!==undefined&&g.views.ready==true){d.find(".total_views").html(gawker_add_commas(g.views.totalViews));h.push(g.views.totalUniqueViews+" New Visitors")}else{f=false}if(g.comments!==undefined&&g.comments.ready==true){d.find(".comments").html(gawker_add_commas(g.comments.numComments))}else{f=false}d.data("statready",f);d.find(".data").attr("title",h.join(", "));d.find(".data").attr("alt",h.join(", "));if(f===false){d.data("spongetries",(d.data("spongetries")===undefined?1:Math.floor(d.data("spongetries"))+1))}}if((this.spongestats.requests_running==0)&&(d.data("statready")!==true)&&(d.data("spongetries")<this.spongesettings.retries)){setTimeout(jQuery.proxy(this.loadSpongeStats,this),(this.spongesettings.interval*1000))}}});a.extend(a.ui.PostWidget,{version:"1.0",defaults:{controlClass:"pic"}})})(jQuery);(function(a){a.widget("ui.PostClipWidget",{xhr:null,initialize:function(){this.xhr=new XHR({klass:"postclip",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this))},authEventHandler:function(b){switch(b.name){case"user.auth.success":this.showWidget();break;case"user.auth.failure":this.hideWidget();break}},handleClick:function(b){this.togglePostClip(jQuery(b.target));b.stopPropagation();b.preventDefault()},handleAjaxRequest:function(){},handleAjaxSuccess:function(b){jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-progress");if(b.command=="tag"){jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-off").addClass("clip-toggle-on").attr({title:"Un-clip this article"})
}else{jQuery(".clipid_"+b.objectId).removeClass("clip-toggle-on").addClass("clip-toggle-off").attr({title:"Clip this article"});jQuery("#event_"+b.objectId).fadeOut()}},handleAjaxFail:function(){jQuery(".clip-toggle-progress").removeClass("clip-toggle-progress")},togglePostClip:function(b){var c={op:"saveusertag",objectType:"POST",objectId:this.getParam("clipid",b)};if(b.hasClass("clip-toggle-on")){c.unTagName="favorite"}else{c.tagName="favorite"}if(this.controls.postcliptoggle){this.controls.postcliptoggle.addClass("clip-toggle-progress")}this.xhr.send("/",c)},hideWidget:function(){if(this.controls.postcliptoggle){this.controls.postcliptoggle.hide()}},showWidget:function(){if(this.auth.authenticated&&this.auth.user.clipped&&this.controls.postcliptoggle){this.controls.postcliptoggle.removeClass("clip-toggle-on").addClass("clip-toggle-off").attr({title:"Clip this article"});for(var c=0,b=this.auth.user.clipped.length;c<b;c++){jQuery(".clipid_"+this.auth.user.clipped[c]).removeClass("clip-toggle-off").addClass("clip-toggle-on").attr({title:"Un-clip this article"})}this.controls.postcliptoggle.show()}},resetWidget:function(){}});a.extend(a.ui.PostClipWidget,{version:"1.0",defaults:{action_url:"/index.php",controlClass:"postclipcontrol"}})})(jQuery);(function($){$.widget("ui.PresenceWidget",{validator:null,xhr:null,initialize:function(){this.jwindow=jQuery(window);this.xhr=new XHR({klass:"presence",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.registerEventHandler(this.element,"click",this.handleClicks.bind(this));var panels={};if(this.controls.login_form){panels.login={el:this.controls.login_dialog,focus:this.controls.username};this.login_validator=new Validator(jQuery.extend({},{scope:this.controls.login_form}));this.registerEventHandler(this.controls.login_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.login_form,"submit",this.handleLoginSubmit.bind(this))}if(this.controls.resetpw_form){panels.resetpw={el:this.controls.resetpw_dialog,focus:this.controls.resetpwemail};this.resetpw_validator=new Validator(jQuery.extend({},{scope:this.controls.resetpw_form}));this.registerEventHandler(this.controls.resetpw_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.resetpw_form,"submit",this.handleResetPasswordSubmit.bind(this))}if(this.controls.register_form){panels.register={el:this.controls.register_dialog};this.register_validator=new Validator(jQuery.extend({},{scope:this.controls.register_form}));this.registerEventHandler(this.controls.register_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.register_form,"submit",this.handleRegisterSubmit.bind(this))}if(this.controls.emailreminder_form){panels.emailreminder={el:this.controls.emailreminder_dialog,focus:this.controls.emailreminder_email};this.emailreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.emailreminder_form}));this.registerEventHandler(this.controls.emailreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.emailreminder_form,"submit",this.handleEmailReminderSubmit.bind(this))}if(this.controls.subscribe_form){panels.subscribe={el:this.controls.subscribe_dialog,focus:this.controls.subscribe_email};this.subscribe_validator=new Validator(jQuery.extend({},{scope:this.controls.subscribe_form}));this.registerEventHandler(this.controls.subscribe_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.subscribe_form,"submit",this.handleSubscribeSubmit.bind(this))}if(this.controls.commentsettings_form){panels.commentsettings={el:this.controls.commentsettings_dialog};this.registerEventHandler(this.controls.commentsettings_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.commentsettings_form,"submit",this.handleCommentSettingsSubmit.bind(this))}if(this.controls.avatarupload_form){panels.avatarupload={el:this.controls.avatarupload_dialog,focus:this.controls.avatarupload_file};this.avatarupload_validator=new Validator(jQuery.extend({},{scope:this.controls.avatarupload_form}));this.registerEventHandler(this.controls.avatarupload_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.avatarupload_form,"submit",this.handleAvataruploadSubmit.bind(this));GawkerClientside.callbacks=jQuery.extend((GawkerClientside.callbacks?GawkerClientside.callbacks:{}),{avatarUploadResponse:this.handleAjaxSuccess.bind(this)})}if(this.controls.profileedit_form){panels.profileedit={el:this.controls.profileedit_dialog,focus:this.controls.profileedit_displayname};this.profileedit_validator=new Validator(jQuery.extend({},{scope:this.controls.profileedit_form}));this.registerEventHandler(this.controls.profileedit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.profileedit_form,"submit",this.handleProfileeditSubmit.bind(this))}if(this.controls.editreminder_form){panels.editreminder={el:this.controls.editreminder_dialog,focus:this.controls.editreminder_email};
this.editreminder_validator=new Validator(jQuery.extend({},{scope:this.controls.editreminder_form}));this.registerEventHandler(this.controls.editreminder_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.editreminder_form,"submit",this.handleEditReminderSubmit.bind(this))}if(this.controls.changepassword_form){panels.changepassword={el:this.controls.changepassword_dialog,focus:this.controls.changepassword_password};this.changepassword_validator=new Validator(jQuery.extend({},{scope:this.controls.changepassword_form}));this.registerEventHandler(this.controls.changepassword_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.changepassword_form,"submit",this.handleChangepasswordSubmit.bind(this))}if(this.feature.isOn(this.feature.POWWOW)){if(this.controls.burnerpanel_form){panels.burnerpanel={el:this.controls.burnerpanel_dialog,focus:this.controls.burnerpanel_name};this.burnerpanel_validator=new Validator(jQuery.extend({},{scope:this.controls.burnerpanel_form}));this.registerEventHandler(this.controls.burnerpanel_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.burnerpanel_form,"submit",this.handleBurnerPanelSubmit.bind(this));var obj=this;(function(){var timer=null;jQuery("#burnerpanel_name").keyup(function(a){if(timer!==null){clearTimeout(timer)}if(this.value.length==0){obj.burnerpanel_validator.hideErrors()}else{timer=setTimeout(function(){jQuery(".burnerNameCheck").hide();jQuery("#burnerCheckingName").show();obj.xhr.send("/sso/checkLogin?username="+encodeURIComponent(jQuery("#burnerpanel_name").val()))},1000)}})})()}if(this.controls.burnersuccesspanel_dialog){panels.burnersuccess={el:this.controls.burnersuccesspanel_dialog}}}if(this.controls.guestpanel_form){panels.guestpanel={el:this.controls.guestpanel_dialog,focus:this.controls.guestpanelemail};this.guestpanel_validator=new Validator(jQuery.extend({},{scope:this.controls.guestpanel_form}));this.registerEventHandler(this.controls.guestpanel_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.guestpanel_form,"submit",this.handleGuestPanelSubmit.bind(this))}if(this.controls.deleteuser_form){panels.deleteuser={el:this.controls.deleteuser_dialog};this.registerEventHandler(this.controls.deleteuser_form,"submit",this.handleDeleteUserSubmit.bind(this))}if(this.controls.html5_dialog){panels.html5={el:this.controls.html5_dialog}}if(this.feature.isOn(this.feature.SSOLOGIN)){if(this.controls.ssousermigrate_dialog){panels.ssousermigrate={el:this.controls.ssousermigrate_dialog}}if(this.controls.ssousermigratesuccess_dialog){panels.ssousermigratesuccess={el:this.controls.ssousermigratesuccess_dialog}}if(this.controls.ssologin_dialog){panels.ssologin={el:this.controls.ssologin_dialog}}}this.commondialogs.initDialogs({overlay:this.controls.overlay,panels:panels,group:this.options.dialoggroup?this.options.dialoggroup:false});this.resetWidget();this.openAfterLogin=null;this.dialogHandler=0;this.subscribeForEvent("presence.requiredialog",this.dialogEventHandler.bind(this));this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("presence.requiresequence.",this.sequenceHandler.bind(this));this.subscribeForEvent("dialog.beforeOpen.login",this.resetResetLoginDialog.bind(this));this.subscribeForEvent("dialog.beforeOpen.resetpw",this.resetResetPwDialog.bind(this));this.subscribeForEvent("dialog.beforeOpen.changepassword",this.resetChangePasswordDialog.bind(this))},dialogEventHandler:function(ev){var obj=this;var currentDialogHandler=this.dialogHandler;switch(ev.params.mode){case"register":this.dialogHandler=function(){var hashparts=ev.params.hash.split("|");if(hashparts.length>1&&obj.controls.register_invitecode){obj.controls.register_invitecode.val(hashparts[1]);if(hashparts.length>2){if(hashparts[2]=="a"){obj.controls.register_copy.html("Registering will give you a star user profile with the ability to comment immediately. You will also be able to add other users as friends.")}else{if(hashparts[2]=="s"){obj.controls.register_copy.html("Registering will give you a user profile with the ability to comment immediately. You will also be able to add other users as friends.")}}}}obj.commondialogs.toggleDialog({which:"register"})};break;case"login":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"login"})};break;case"resetpassword":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"resetpw"})};break;case"logout":this.dialogHandler=function(){obj.mystate="loggedin:logging_out:clicked";obj.xhr.send(obj.options.logout_action_url,{})};break;case"profileedit":this.dialogHandler=function(){obj.commondialogs.toggleDialog({which:"profileedit"})};break;case"deleteuser":this.dialogHandler=function(){if(obj.auth.authenticated){obj.commondialogs.toggleDialog({which:"deleteuser",cancel:function(){location.hash=""}})}};break}if(typeof(this.dialogHandler)=="function"&&currentDialogHandler==-1){this.dialogHandler();
this.dialogHandler=-1}},showSsoMigratedDialog:function(provider){jQuery("#sso-provider-name").html(provider);this.commondialogs.toggleDialog({which:"ssousermigratesuccess"})},authEventHandler:function(ev){var is_init=this.inState("init");var max_name_length=22;var main_profile_controls=jQuery(".mainProfileControls");main_profile_controls.hide();switch(ev.name){case"user.auth.success":if(this.controls.profile_link){var profileLabel=this.auth.user.smartName;if(this.auth.user.smartName.length>max_name_length){profileLabel=this.auth.user.smartName.substr(0,max_name_length)+"..."}profileLabel+='<span id="profileNotificationCounter" class="site-bg-color" style="display:none"></span>';this.controls.profile_link.attr("href","/me").html(profileLabel)}if(!is_init){this.fireEvent("onLoginPanelHide",this);this.syncEffect({el:this.controls.login_panel,fn:"hide"})}if(this.controls.profile_panel){this.controls.profile_panel.show()}if(this.controls.avatarupload_form){if(this.controls.profileedit_avatarimage){if(this.auth.user.avatarPath.indexOf("http")===0){this.controls.profileedit_avatarimage.attr({src:this.auth.user.avatarPath+"avt-large."+this.auth.user.avatarPath.substr(-4,3)})}else{this.controls.profileedit_avatarimage.attr({src:"http://img.gawkerassets.com/img/17ijhia1vsyqtpng/avt-small.png"})}}this.controls.avatarupload_authtoken.val(this.auth.user.authToken?this.auth.user.authToken:"")}this.mystate="loggedin";if(this.controls.profilepagecontrols){var profile_id=this.getParam("uid",this.controls.profilepagecontrols);if(this.auth.user.id===profile_id){this.xhr.send(this.options.isburner_action_url,{});main_profile_controls.show();if(!this.auth.user.fb_uid&&this.controls.main_changepassword_link){this.controls.main_changepassword_link.show()}if(!this.auth.user.fb_uid&&this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.show()}this.controls.profilepagecontrols.show();this.setupProfileForms()}else{this.controls.profilepagecontrols.hide();this.controls.main_changepassword_link.hide()}}if(this.auth.hasLevel("authors")){Debug.enable()}if(typeof(this.openAfterLogin)=="function"){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:this.openAfterLogin(this.auth.user),sync_this:this.syncEffect.bind(this)}});this.openAfterLogin=null}else{if(this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){if(this.auth.user.emailuser){this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"resetpw",sync_this:this.syncEffect.bind(this)}})}else{this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:"changepassword",sync_this:this.syncEffect.bind(this)}})}}}if(this.auth.sso_migrated&&this.auth.user.authApps.indexOf("ZAP")!=-1){this.showSsoMigratedDialog(this.auth.sso_migrated);GawkerClientside.widgets.notificationControl[0].clearNotificationList();GawkerClientside.widgets.notificationControl[0].getUserNotifications();this.auth.sso_migrated=null;this.auth.resetRevision()}break;case"user.auth.failure":jQuery("#mustaddemail").remove();jQuery("#profileClickMode").html("presence");this.fireEvent("onLoginPanelShow",this,true);this.syncEffect({el:this.controls.login_panel,fn:"show"});this.mystate="loggedout:no_dialog";if(this.controls.profilepagecontrols){if(this.controls.main_changepassword_link){this.controls.main_changepassword_link.hide()}if(this.controls.main_deleteuser_link){this.controls.main_deleteuser_link.hide()}this.controls.profilepagecontrols.hide();this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}if(this.options.loginNeeded==true){this.commondialogs.toggleDialog({which:"login"})}break}if(typeof(this.dialogHandler)=="function"){this.dialogHandler()}this.dialogHandler=-1;if(is_init&&window.location.hash.length>0){var hashparts=window.location.hash.split("|");if(hashparts.length>1){this.raiseEvent("presence.requiredialog",{mode:hashparts[1],hash:window.location.pathname})}}if(initiateLogin==true){this.commondialogs.toggleDialog({which:"login"})}if(pageType=="frontpage"){jQuery.cookie("ad_url_visited_"+this.auth.site.canonicalHost.replace(/\./,"_"),"true",{expires:2592000,path:"/"})}},sequenceHandler:function(ev){switch(ev.name){case"presence.requiresequence.fblogin":this.triggerFBLogin();break;case"presence.requiresequence.login":this.commondialogs.toggleDialog({which:"login"});break;case"presence.requiresequence.register":this.commondialogs.toggleDialog({which:"register"});break;case"presence.requiresequence.resetpw":this.commondialogs.toggleDialog({which:"resetpw"});break;case"presence.requiresequence.guest":if(!this.feature.isOn(this.feature.POWWOW)){this.commondialogs.toggleDialog({which:"guestpanel"})}break}},resetChangePasswordDialog:function(e){this.controls.changepassword_password.val("");this.controls.changepassword_new_password.val("");this.controls.changepassword_confirm_password.val("");
jQuery(".validationmessage",this.controls.changepassword_dialog).hide();this.handleNoAsciiMessage("#noAsciiNotifyChangePassword")},resetResetLoginDialog:function(e){this.controls.username.val("");this.controls.password.val("");this.controls.loginmessage.html("")},resetResetPwDialog:function(e){},handleNoAsciiMessage:function(id){if(this.auth!==undefined&&this.auth.showNonAsciiNotification!==undefined&&this.auth.showNonAsciiNotification===true){jQuery(id).show();this.xhr.send("/index.php?op=ajax_nonasciinotified");this.auth.showNonAsciiNotification=false}else{jQuery(id).hide()}},handleClicks:function(e){var t=this.getParam("cn",e.target);var shouldstop=false;switch(t){case"register_or_login":shouldstop=true;jQuery("div.modal.modalpopup.ssologin.presence_control.cn_ssologin_dialog").find("div.account_linked").hide();this.commondialogs.toggleDialog({which:"ssologin"});break;case"ssousermigrate_link":shouldstop=true;if(!jQuery.cookie("ssomigrate_notify")){jQuery.cookie("ssomigrate_notify",1,{path:"/",expires:3});GawkerClientside.widgets.notificationControl[0].clearNotificationList();GawkerClientside.widgets.notificationControl[0].getUserNotifications()}this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"ssousermigratesuccess_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"ssousermigratesuccess_ok":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"ssousermigrate_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"ssousermigrate_ok":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigratesuccess"});break;case"fullsitelist":shouldstop=true;var siteliststring='(<a href="http://gizmodo.com">Gizmodo</a>, <a href="http://gawker.com">Gawker</a>, <a href="http://lifehacker.com">Lifehacker</a>, <a href="http://deadspin.com">Deadspin</a>, <a href="http://kotaku.com">Kotaku</a>, <a href="http://jezebel.com">Jezebel</a>, <a href="http://io9.com">io9</a> and <a href="http://jalopnik.com">Jalopnik</a>)';jQuery(e.target).replaceWith(siteliststring);break;case"login_oauth":shouldstop=true;var loginType=this.getParam("type",e.target);var migrate=jQuery(e.target).hasClass("migrate");if(window.location.pathname.indexOf("/ccs")==0){migrate=false}this.oauthLogin(loginType,migrate);break;case"fb_login":shouldstop=true;this.triggerFBLogin();break;case"login_cancel":this.xhr.abort();case"togglelogindialog":shouldstop=true;if(this.inState("loggedout:no_dialog")){this.resetWidget()}jQuery("div.modal.modalpopup.login.presence_control.cn_login_dialog").find("div.convert").show();jQuery("div.modal.modalpopup.login.presence_control.cn_login_dialog").find("div.non-convert").hide();this.commondialogs.toggleDialog({which:"login"});break;case"logout_link":shouldstop=true;this.mystate="loggedin:logging_out:clicked";this.controls.user_menu.hide();this.controls.loginmessage.html("");if(this.auth.user.authApps.indexOf("ZAP")!=-1){var s=document.createElement("script");s.type="text/javascript";s.src="/sso/logout_request";s.async=true;var obj=this;globalLogoutFunc=function(){obj.xhr.send(obj.options.logout_action_url,{})};jQuery("body").append(s);var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(s,r)}else{this.xhr.send(this.options.logout_action_url,{})}break;case"resetpw_submit":this.controls.resetpw_form.submit();break;case"toggleresetpwdialog":case"resetpw_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"resetpw"});break;case"ssousermigrate_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"ssousermigrate"});break;case"html5_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"html5"});break;case"register_submit":this.controls.register_form.submit();break;case"toggleregisterdialog":case"register_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"register"});break;case"emailreminder_cancel":shouldstop=true;this.controls.emailreminder_noemail.val(1);this.controls.emailreminder_form.submit();break;case"togglesubscribedialog":case"subscribe_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"subscribe"});break;case"togglecommentsettingsdialog":case"commentsettings_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"commentsettings"});break;case"profileedit_newUsername_change":if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.profileedit_dialog.find(".feature_newcomments_newuser").show();this.controls.profileedit_dialog.find(".feature_newcomments_olduser").hide()}else{this.controls.profileedit_newUsername_text.hide();this.controls.profileedit_newUsername_change.hide();this.controls.profileedit_newUsername_change_warn.show();this.controls.profileedit_newUsername.show();this.controls.profileedit_newUsername.focus().select();this.controls.profileedit_dialog.find(".feature_newcomments_newuser").hide()}break;case"toggleprofileeditdialog":case"profileedit_cancel":if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.profileedit_dialog.find(".feature_newcomments_newuser").show();
this.controls.profileedit_dialog.find(".feature_newcomments_olduser").hide()}else{if(this.auth.authenticated&&(typeof(this.auth.user.oldUsername)=="undefined"||this.auth.user.oldUsername==null)){this.controls.profileedit_newUsername[0].disabled=false;this.controls.profileedit_newUsername.parent().show();this.controls.profileedit_newUsername.val(this.auth.user.username);this.controls.profileedit_newUsername_change_warn.hide();this.controls.profileedit_newUsername.hide();this.controls.profileedit_newUsername_text.show();this.controls.profileedit_newUsername_change.show()}else{this.controls.profileedit_newUsername[0].disabled=true;this.controls.profileedit_newUsername.parent().hide()}this.controls.profileedit_dialog.find(".feature_newcomments_newuser").hide();this.controls.profileedit_dialog.find(".feature_newcomments_olduser").show()}shouldstop=true;this.commondialogs.toggleDialog({which:"profileedit"});break;case"profileedit_submit":if(this.controls.profileedit_newUsername.val()!=this.auth.user.username){if(!confirm("Warning! You are only able to change your username once. Once you save your new username, you will not be able to change it again. Are you sure you want to save?")){shouldstop=true}}break;case"editreminder_cancel":shouldstop=true;this.controls.editreminder_noemail.val(1);this.controls.editreminder_form.submit();break;case"togglechangepassworddialog":case"changepassword_cancel":shouldstop=true;if(this.auth.user){if(this.auth.user.emailuser){this.commondialogs.toggleDialog({which:"resetpw"})}else{this.commondialogs.toggleDialog({which:"changepassword"})}}else{this.openAfterLogin=function(user){if(user.emailuser){return"resetpw"}return"changepassword"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggledeleteuserdialog":case"deleteuser_cancel":shouldstop=true;if(this.auth.user){this.commondialogs.toggleDialog({which:"deleteuser"})}else{this.openAfterLogin=function(user){return"deleteuser"};this.commondialogs.toggleDialog({which:"login"})}break;case"toggleavataruploaddialog":case"avatarupload_cancel":shouldstop=true;this.commondialogs.toggleDialog({which:"avatarupload"});break;case"guestpanel_cancel":this.commondialogs.toggleDialog({which:"guestpanel"});break;case"burnerpanel_cancel":this.commondialogs.toggleDialog({which:"burnerpanel"});break;case"burnersuccesspanel_cancel":this.commondialogs.toggleDialog({which:"burnersuccess"});break;case"profile_link":shouldstop=true;this.raiseEvent("notification.togglelist");break;case"dialog":var mode=this.getParam("dialog",e.target);window.location.hash=window.location.hash+"|"+mode;this.raiseEvent("presence.requiredialog",{mode:mode,hash:window.location.pathname+window.location.search});break;case"overlay":if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){shouldstop=true;this.commondialogs.toggleDialog()}break}if(shouldstop){e.stopPropagation();e.preventDefault()}},triggerFBLogin:function(){FB.Bootstrap.requireFeatures(["Connect"],function(){FB.Connect.requireSession(function(){this.mystate="loggedout:login_dialog_active:request_sent";this.auth.fbWhenReady(function(){this.xhr.send(this.options.facebook_action_url,{action:"loginOrRegister"})}.bind(this))}.bind(this),true)}.bind(this));this.disableInputs("login")},oauthLogin:function(type,migrate){var url="";url="/sso/login_request?&provider="+type.replace(/[^a-z]/,"")+(migrate?"&migrate=1":"");var d=new Date();var needle="fetchUserState2=1";document.cookie=needle+";expires="+d.toGMTString()+";;";window.open(url,"","width=900,height=500");var obj=this;var checkCookies=function(){if(document.cookie.indexOf(needle)!=-1){obj.commondialogs.toggleDialog({which:obj.commondialogs.groups["default"].state.replace("active:","")});var d=new Date();jQuery.cookie("fetchUserState2",null,{path:"/",domain:"."+location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2")});var regNeedle="redirectToProfilePage=1";if(document.cookie.indexOf(regNeedle)!=-1){jQuery.cookie("redirectToProfilePage",null,{path:"/",domain:"."+location.host.replace(/^(.+\.)?([a-zA-Z0-9]+\.[a-zA-Z0-9]+)$/,"$2")});window.location="/me#|profileedit"}else{if(typeof Powwow!=="undefined"){Powwow.loadUser()}obj.auth.getUserState()}}else{setTimeout(checkCookies,200)}};this.auth.resetRevision();checkCookies()},handleKeyUp:function(e){switch(e.keyCode){case jQuery.ui.keyCode.ESCAPE:if(jQuery(".cn_ssousermigrate_dialog:visible").length==0&&jQuery(".cn_burnercreatesuccess_dialog:visible").length==0){this.commondialogs.toggleDialog()}break}},handleLoginSubmit:function(e){e.stopPropagation();e.preventDefault();this.login_validator.hideErrors();if(this.login_validator.validate()){this.mystate="loggedout:login_dialog_active:request_sent";this.xhr.send(this.options.login_action_url,this.controls.login_form.serialize());this.disableInputs("login");this.controls.loginmessage.html("");jQuery(".spinner",this.controls.login_indicator).spin("small")}else{if(this.options.show_validation_errors){this.login_validator.showErrors()
}}},handleResetPasswordSubmit:function(e){e.stopPropagation();e.preventDefault();this.resetpw_validator.hideErrors();if(this.resetpw_validator.validate()){this.mystate="loggedout:resetpw_dialog_active:request_sent";this.xhr.send(this.options.resetpw_action_url,this.controls.resetpw_form.serialize());this.disableInputs("resetpw");jQuery(this.controls.resetpw_indicator).spin("small")}else{if(this.options.show_validation_errors){this.resetpw_validator.showErrors()}}},handleRegisterSubmit:function(e){e.stopPropagation();e.preventDefault();this.register_validator.hideErrors();if(this.register_validator.validate()){if(this.controls.register_email[0].value==""){this.commondialogs.toggleDialog({which:"emailreminder"})}else{this.mystate="loggedout:register_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.register_form.serialize());this.disableInputs("register")}}else{if(this.options.show_validation_errors){this.register_validator.showErrors()}}},handleEmailReminderSubmit:function(e){e.stopPropagation();e.preventDefault();this.emailreminder_validator.hideErrors();if(this.emailreminder_validator.validate()||this.controls.emailreminder_noemail.val()==1){this.mystate="loggedout:emailreminder_dialog_active:request_sent";this.xhr.send(this.options.register_action_url,this.controls.emailreminder_form.serialize());this.disableInputs("emailreminder")}else{if(this.options.show_validation_errors){this.emailreminder_validator.showErrors()}}},handleSubscribeSubmit:function(e){this.subscribe_validator.hideErrors();if(!this.subscribe_validator.validate()){e.stopPropagation();e.preventDefault();if(this.options.show_validation_errors){this.subscribe_validator.showErrors()}}else{this.fireEvent("onSubscribeRequestSent",this);var _this=this;window.setTimeout(function(){_this.disableInputs("subscribe")},300)}},handleCommentSettingsSubmit:function(e){e.stopPropagation();e.preventDefault();this.mystate="loggedin:commentsettings_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.commentsettings_form.serialize());this.disableInputs("commentsettings")},handleAvataruploadSubmit:function(e){this.avatarupload_validator.hideErrors();if(!this.avatarupload_validator.validate()){e.stopPropagation();e.preventDefault();if(this.options.show_validation_errors){this.avatarupload_validator.showErrors()}}else{this.mystate="loggedin:avatarupload_dialog_active:avatar_request_sent";if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.show()}jQuery(this.controls.avatarupload_indicator).spin("small");this.fireEvent("onAvataruploadRequestSent",this);var _this=this;window.setTimeout(function(){_this.disableInputs("avatarupload")},300)}},handleProfileeditSubmit:function(e){e.stopPropagation();e.preventDefault();this.profileedit_validator.hideErrors();if(this.profileedit_validator.validate()){if(this.controls.profileedit_email[0].value==""){this.controls.editreminder_newUsername[0].value=this.controls.profileedit_newUsername[0].value;this.controls.editreminder_displayName[0].value=this.controls.profileedit_displayname[0].value;this.controls.editreminder_url[0].value=this.controls.profileedit_url[0].value;this.controls.editreminder_aimname[0].value=this.controls.profileedit_aimname[0].value;if(this.controls.profileedit_contactname[0]!==undefined){this.controls.editreminder_contactname.val(this.controls.profileedit_contactname.val())}if(this.controls.profileedit_contactemail[0]!==undefined){this.controls.editreminder_contactemail.val(this.controls.profileedit_contactemail.val())}if(this.controls.profileedit_twitterusername[0]!==undefined){this.controls.editreminder_twitterusername.val(this.controls.profileedit_twitterusername.val())}if(this.controls.profileedit_facebookurl[0]!==undefined){this.controls.editreminder_facebookurl.val(this.controls.profileedit_facebookurl.val())}if(this.controls.profileedit_isFacebookFanPage[0]!==undefined){this.controls.editreminder_isFacebookFanPage.val(this.controls.profileedit_isFacebookFanPage.is(":checked")?"true":"false")}if(this.controls.profileedit_googleplusurl[0]!==undefined){this.controls.editreminder_googleplusurl.val(this.controls.profileedit_googleplusurl.val())}this.commondialogs.toggleDialog({which:"editreminder"})}else{this.mystate="loggedin:profileedit_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.profileedit_form.serialize());this.disableInputs("profileedit");jQuery(".cn_profileedit_indicator",this.controls.profileedit_form).spin("small")}}else{if(this.options.show_validation_errors){this.profileedit_validator.showErrors()}}},handleEditReminderSubmit:function(e){e.stopPropagation();e.preventDefault();this.editreminder_validator.hideErrors();if(this.editreminder_validator.validate()||this.controls.editreminder_noemail.val()==1){this.mystate="loggedin:editreminder_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.editreminder_form.serialize());
this.disableInputs("editreminder")}else{if(this.options.show_validation_errors){this.editreminder_validator.showErrors()}}},handleChangepasswordSubmit:function(e){e.stopPropagation();e.preventDefault();this.changepassword_validator.hideErrors();if(this.changepassword_validator.validate()){this.mystate="loggedin:changepassword_dialog_active:request_sent";this.xhr.send(this.options.setprofile_action_url,this.controls.changepassword_form.serialize());this.disableInputs("changepassword")}else{if(this.options.show_validation_errors){this.changepassword_validator.showErrors()}}},handleDeleteUserSubmit:function(e){e.stopPropagation();e.preventDefault();if(confirm("Are you sure you want to delete your account?")){this.mystate="loggedin:deleteuser_dialog_active:request_sent";this.xhr.send(this.options.deleteuser_action_url,this.controls.deleteuser_form.serialize());this.disableInputs("deleteuser")}},handleBurnerPanelSubmit:function(e){e.stopPropagation();e.preventDefault();this.burnerpanel_validator.hideErrors();if(this.burnerpanel_validator.validate()){var s=document.createElement("script");s.async="async";var funcName="getBurner"+Math.round(Math.random()*1000000);var obj=this;eval(funcName+" = function(data) {obj.handleAjaxSuccess(data)};");s.src="/sso/burner_request?username="+encodeURIComponent(jQuery("#burnerpanel_name").val())+"&jsonP="+funcName;var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;head.insertBefore(s,head.firstChild);this.handleAjaxRequest();jQuery(".burnerNameCheck").hide();jQuery("#burnerCreate").show()}else{if(this.options.show_validation_errors){this.burnerpanel_validator.showErrors();this.controls.burnerpanel_name.focus()}}},handleGuestPanelSubmit:function(e){e.stopPropagation();e.preventDefault();this.guestpanel_validator.hideErrors();if(this.guestpanel_validator.validate()){this.commondialogs.toggleDialog({});var newsletter_check=false;if(this.controls.guestpanel_newsletter[0].checked){newsletter_check=true}this.raiseEvent("commentform.guestsubmit",{email:this.controls.guestpanelemail.val(),newsletter:newsletter_check})}else{if(this.options.show_validation_errors){this.guestpanel_validator.showErrors();this.controls.guestpanelemail.focus()}}},handleAjaxRequest:function(){if(this.inState("loggedin:logging_out:clicked")){if(this.controls.logout_indicator){this.controls.logout_indicator.css("display","inline-block");jQuery(this.controls.logout_indicator).spin("small")}this.fireEvent("onLogoutRequestSent",this);this.mystate="loggedin:logging_out"}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.show()}this.fireEvent("onLoginRequestSent",this)}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.show()}this.fireEvent("onResetPWRequestSent",this)}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.show()}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.show()}this.fireEvent("onRegisterRequestSent",this)}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","inline")}this.fireEvent("onCommentSettingsRequestSent",this)}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.show()}this.fireEvent("onProfileEditRequestSent",this)}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.show()}this.fireEvent("onChangePasswordRequestSent",this)}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.show()}this.fireEvent("onDeleteUserRequestSent",this)}}}}}}}}}}},handleAjaxSuccess:function(data){switch(data.action){case"login":jQuery(".spinner",this.controls.login_indicator).spin(false);case"fblogin":if(data.redirect!==undefined){location.href=data.redirect}Message.showMessage(data.message,this.controls.loginmessage[0],{stable:true});this.enableInputs("login");if(data.success){this.auth.user=data.user;this.auth.authenticated=true;this.auth.showNonAsciiNotification=data.showNonAsciiNotification?data.showNonAsciiNotification:false;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onLoginSuccess",this,true);var dialogName="ssousermigrate";this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:dialogName,sync_this:this.syncEffect.bind(this)}});
this.resetWidget({except:"login_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"login_form"}});this.raiseEvent("user.auth.success",data);this.auth.resetRevision()}else{if(this.controls.login_indicator){this.controls.login_indicator.hide()}if(data.code&&data.code=="ACCOUNT_LINKED"){this.feature.on(this.feature.SSOLOGIN);this.commondialogs.toggleDialog({which:"ssologin"});jQuery("div.modal.modalpopup.ssologin.presence_control.cn_ssologin_dialog").find("div.account_linked").show()}this.fireEvent("onLoginFailure",this)}break;case"logout":if(data.success){this.auth.user=false;this.auth.authenticated=false;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onLogoutSuccess",this);this.raiseEvent("user.auth.failure",data);this.auth.resetRevision();if(typeof Powwow!=="undefined"){Powwow.loadUser()}}else{this.fireEvent("onLogoutFailure",this)}if(this.controls.logout_indicator){jQuery(this.controls.logout_indicator).spin(false);this.controls.logout_indicator.hide()}break;case"register":Message.showMessage(data.message,this.controls.registermessage[0]);Message.showMessage(data.message,this.controls.emailremindermessage[0]);if(this.controls.register_indicator){this.controls.register_indicator.hide()}if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.enableInputs("register");this.enableInputs("emailreminder");if(data.success){this.auth.user=data.user;this.auth.authenticated=true;if(data.formToken){this.auth.formToken=data.formToken}this.fireEvent("onRegisterSuccess",this,true);this.syncEffect({el:this.commondialogs,fn:"toggleDialog",params:{which:(this.inState("loggedout:register_dialog_active:request_sent")?"register":"emailreminder"),sync_this:this.syncEffect.bind(this)}});this.resetWidget({except:"register_form"});this.resetWidget({except:"emailreminder_form"});this.syncEffect({el:this,fn:"resetWidget",params:{only:"register_form"}});this.syncEffect({el:this,fn:"resetWidget",params:{only:"emailreminder_form"}});this.raiseEvent("user.auth.success",data);this.auth.resetRevision()}else{this.fireEvent("onRegisterFailure",this)}break;case"resetpassword":if(data.success){jQuery("#resetPassword1").hide();jQuery("#resetPassword2").show();this.fireEvent("onResetPWSuccess",this)}else{this.fireEvent("onResetPWFailure",this)}jQuery(this.controls.resetpw_indicator).spin(false);Message.showMessage(data.message,this.controls.resetpwmessage[0]);if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.enableInputs("resetpw");break;case"setprofile":if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(data.success){Message.showMessage("Password saved.",this.controls.changepassword_message[0],{stable:false});this.commondialogs.toggleDialog({which:"changepassword"})}else{Message.showMessage('<p>Old password is not correct.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',this.controls.changepassword_messagebig[0],{stable:true})}if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.enableInputs("changepassword")}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(data.success){Message.showMessage("Account deleted.",this.controls.deleteuser_message[0],{stable:false});this.commondialogs.toggleDialog({which:"deleteuser"})}else{Message.showMessage('Account deletion failed. Please contact <a href="help@gawker.com">help@gawker.com</a>',this.controls.deleteuser_messagebig[0],{stable:true})}if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.enableInputs("deleteuser");if(data.success){location.href="/people/"+data.username+"#logout"}}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")||this.inState("loggedin:editreminder_dialog_active:request_sent")){if(data.success){Message.showMessage("Profile saved.",this.controls.profileedit_message[0],{stable:false});Message.showMessage("Profile saved.",this.controls.editreminder_message[0],{stable:false});if(data.usernamechanged===true){location.href=data.redirectUrl}this.auth.user.username=this.controls.profileedit_newUsername.val();this.auth.user.smartName=((data.user.smartName!==undefined)?data.user.smartName:"");this.auth.user.url=((data.user.url!==undefined)?data.user.url:"");this.auth.user.email=((data.user.email!==undefined)?data.user.email:"");this.auth.user.aimname=((data.user.aimname!==undefined)?data.user.aimname:"");if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.auth.user[extname]=this.controls.profileedit_extended.eq(i).val()}}this.auth.user.twitterusername=((data.user.twitterusername!==undefined)?data.user.twitterusername:"");
this.auth.user.facebookurl=((data.user.facebookurl!==undefined)?data.user.facebookurl:"");this.auth.user.isFacebookFanPage=((data.user.isFacebookFanPage!==undefined)?data.user.isFacebookFanPage:"");this.auth.user.googleplusurl=((data.user.googleplusurl!==undefined)?data.user.googleplusurl:"");this.commondialogs.toggleDialog({which:(this.inState("loggedin:profileedit_dialog_active:request_sent")?"profileedit":"editreminder")});this.auth.resetRevision()}else{Message.showMessage(data.message,this.controls.profileedit_message[0],{stable:false})}if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.enableInputs("profileedit")}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(data.success){this.commondialogs.toggleDialog({which:"commentsettings"});this.auth.user.commentViewMode=data.user.commentViewMode;this.auth.user.commentRepliesMode=data.user.commentRepliesMode;this.auth.user.commentOrder=data.user.commentOrder;this.auth.resetRevision()}else{Message.showMessage("Save failed.",this.controls.commentsettings_message[0],{stable:false})}if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.hide()}this.enableInputs("commentsettings")}}}}break;case"avatarupload":if(data.success){this.controls.profileedit_avatarimage.attr({src:data.big});this.auth.user.avatarPath=data.big;Message.showMessage(data.message,this.controls.avatarupload_message[0],{stable:false});this.mystate="loggedin:avatarupload_dialog_active";var obj=this;window.setTimeout(function(){obj.commondialogs.toggleDialog({which:"avatarupload"})},2000);this.auth.resetRevision();this.fireEvent("onAvataruploadSuccess",this)}else{this.fireEvent("onAvataruploadFailure",this);Message.showMessage(data.message,this.controls.avatarupload_message[0],{stable:false})}jQuery(this.controls.avatarupload_indicator).spin(false);if(this.controls.avatarupload_indicator){this.controls.avatarupload_indicator.hide()}this.enableInputs("avatarupload");break;case"saveLink":case"link":if(data.success&&data.redirectUrl){location.href=data.redirectUrl}break;case"burner":if(data.success){jQuery("#burnerLoginName").html(data.username);jQuery("#burnerToken").html(data.token);this.auth.getUserState();this.commondialogs.toggleDialog({which:"burnersuccess"})}else{jQuery(".burnerNameCheck").hide();jQuery("#burnerNameTaken").show()}break;case"checkLogin":jQuery(".burnerNameCheck").hide();if(data.success&&data.available){jQuery("#burnerNameAvailable").show()}else{jQuery("#burnerNameTaken").show()}break;case"isBurner":if(data.success){this.auth.user.isBurner=data.isBurner;if(this.auth.user.isBurner===true&&this.controls.profileedit_form){this.controls.profileedit_form.hide();this.controls.profileedit_burnermessage.show()}}break}},handleAjaxFail:function(){if(this.inState("loggedin")){if(this.inState("loggedin:logging_out")){if(this.controls.logout_indicator){this.controls.logout_indicator.hide()}this.fireEvent("onLogoutFailure",this);this.mystate="loggedin"}else{if(this.inState("loggedin:commentsettings_dialog_active:request_sent")){if(this.controls.commentsettings_indicator){this.controls.commentsettings_indicator.css("display","none")}this.fireEvent("onCommentSettingsRequestFail",this);this.mystate="loggedin:commentsettings_dialog_active"}else{if(this.inState("loggedin:profileedit_dialog_active:request_sent")){if(this.controls.profileedit_indicator){this.controls.profileedit_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedin:profileedit_dialog_active"}else{if(this.inState("loggedout:editreminder_dialog_active:request_sent")){if(this.controls.editreminder_indicator){this.controls.editreminder_indicator.hide()}this.fireEvent("onProfileEditRequestFail",this);this.mystate="loggedout:editreminder_dialog_active"}else{if(this.inState("loggedin:changepassword_dialog_active:request_sent")){if(this.controls.changepassword_indicator){this.controls.changepassword_indicator.hide()}this.fireEvent("onChangePasswordRequestFail",this);this.mystate="loggedin:changepassword_dialog_active"}else{if(this.inState("loggedin:deleteuser_dialog_active:request_sent")){if(this.controls.deleteuser_indicator){this.controls.deleteuser_indicator.hide()}this.fireEvent("onDeleteUserRequestFail",this);this.mystate="loggedin:deleteuser_dialog_active"}}}}}}}else{if(this.inState("loggedout:login_dialog_active:request_sent")){if(this.controls.login_indicator){this.controls.login_indicator.hide()}this.fireEvent("onLoginRequestFail",this);this.mystate="loggedout:login_dialog_active";this.enableInputs("login")}else{if(this.inState("loggedout:resetpw_dialog_active:request_sent")){if(this.controls.resetpw_indicator){this.controls.resetpw_indicator.hide()}this.fireEvent("onResetPWRequestFail",this);this.mystate="loggedout:resetpw_dialog_active";this.enableInputs("resetpw")}else{if(this.inState("loggedout:register_dialog_active:request_sent")){if(this.controls.register_indicator){this.controls.register_indicator.hide()
}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:register_dialog_active";this.enableInputs("register")}else{if(this.inState("loggedout:emailreminder_dialog_active:request_sent")){if(this.controls.emailreminder_indicator){this.controls.emailreminder_indicator.hide()}this.fireEvent("onRegisterRequestFail",this);this.mystate="loggedout:emailreminder_dialog_active";this.enableInputs("emailreminder")}}}}}},disableInputs:function(which){switch(which){case"login":this.controls.username[0].disabled=true;this.controls.password[0].disabled=true;this.controls.login_button[0].disabled=true;break;case"resetpw":this.controls.resetpwemail[0].disabled=true;this.controls.resetpw_submit[0].disabled=true;this.controls.resetpw_cancel[0].disabled=true;break;case"register":this.controls.register_cancel[0].disabled=true;break;case"subscribe":this.controls.subscribe_email[0].disabled=true;this.controls.subscribe_submit[0].disabled=true;this.controls.subscribe_cancel[0].disabled=true;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=true;this.controls.commentsettings_cancel[0].disabled=true;this.controls.cvm_featured[0].disabled=true;this.controls.cvm_hidden[0].disabled=true;this.controls.crm_expanded[0].disabled=true;this.controls.crm_collapsed[0].disabled=true;break;case"profileedit":this.controls.profileedit_newUsername[0].disabled=true;this.controls.profileedit_displayname[0].disabled=true;this.controls.profileedit_url[0].disabled=true;this.controls.profileedit_email[0].disabled=true;this.controls.profileedit_aimname[0].disabled=true;if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended[i].disabled=true}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactemail[0].disabled=true}this.controls.profileedit_twitterusername[0].disabled=true;this.controls.profileedit_facebookurl[0].disabled=true;this.controls.profileedit_isFacebookFanPage[0].disabled=true;this.controls.profileedit_googleplusurl[0].disabled=true;this.controls.profileedit_submit[0].disabled=true;this.controls.profileedit_cancel[0].disabled=true;break;case"changepassword":this.controls.changepassword_password[0].disabled=true;this.controls.changepassword_new_password[0].disabled=true;this.controls.changepassword_confirm_password[0].disabled=true;this.controls.changepassword_submit[0].disabled=true;this.controls.changepassword_cancel[0].disabled=true;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=true;this.controls.deleteuser_cancel[0].disabled=true;break;case"avatarupload":this.controls.avatarupload_file[0].disabled=true;this.controls.avatarupload_submit[0].disabled=true;this.controls.avatarupload_cancel[0].disabled=true;break}},enableInputs:function(which){switch(which){case"login":this.controls.username[0].disabled=false;this.controls.password[0].disabled=false;this.controls.login_button[0].disabled=false;break;case"resetpw":this.controls.resetpwemail[0].disabled=false;this.controls.resetpw_submit[0].disabled=false;this.controls.resetpw_cancel[0].disabled=false;break;case"register":break;case"subscribe":this.controls.subscribe_email[0].disabled=false;this.controls.subscribe_submit[0].disabled=false;this.controls.subscribe_cancel[0].disabled=false;break;case"commentsettings":this.controls.commentsettings_submit[0].disabled=false;this.controls.commentsettings_cancel[0].disabled=false;if(this.controls.togglecommentsettingsdialog&&this.controls.togglecommentsettingsdialog[1]){this.controls.togglecommentsettingsdialog[1].disabled=false}this.controls.cvm_featured[0].disabled=false;this.controls.cvm_hidden[0].disabled=false;this.controls.crm_expanded[0].disabled=false;this.controls.crm_collapsed[0].disabled=false;break;case"profileedit":if(this.controls.profileedit_newUsername[0]){this.controls.profileedit_newUsername[0].disabled=false}if(this.controls.profileedit_displayname[0]){this.controls.profileedit_displayname[0].disabled=false}if(this.controls.profileedit_url[0]){this.controls.profileedit_url[0].disabled=false}if(this.controls.profileedit_email[0]){this.controls.profileedit_email[0].disabled=false}if(this.controls.profileedit_aimname[0]){this.controls.profileedit_aimname[0].disabled=false}if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended[i].disabled=false}}if(this.auth.authenticated&&this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactemail[0].disabled=false}if(this.controls.profileedit_twitterusername[0]){this.controls.profileedit_twitterusername[0].disabled=false}if(this.controls.profileedit_facebookurl[0]){this.controls.profileedit_facebookurl[0].disabled=false
}if(this.controls.profileedit_isFacebookFanPage&&this.controls.profileedit_isFacebookFanPage[0]){this.controls.profileedit_isFacebookFanPage[0].disabled=false}if(this.controls.profileedit_googleplusurl[0]){this.controls.profileedit_googleplusurl[0].disabled=false}if(this.controls.profileedit_submit[0]){this.controls.profileedit_submit[0].disabled=false}if(this.controls.profileedit_cancel[0]){this.controls.profileedit_cancel[0].disabled=false}break;case"changepassword":this.controls.changepassword_password[0].disabled=false;this.controls.changepassword_new_password[0].disabled=false;this.controls.changepassword_confirm_password[0].disabled=false;this.controls.changepassword_submit[0].disabled=false;this.controls.changepassword_cancel[0].disabled=false;break;case"deleteuser":this.controls.deleteuser_submit[0].disabled=false;this.controls.deleteuser_cancel[0].disabled=false;break;case"avatarupload":this.controls.avatarupload_file[0].disabled=false;this.controls.avatarupload_submit[0].disabled=false;this.controls.avatarupload_cancel[0].disabled=false;break}},resetWidget:function(params){if(!params){params={except:false,only:false}}else{if(!params.except){params.except=false}if(!params.only){params.only=false}}var mustbreak=params.only?true:false;switch(params.only){default:case"login_form":if(this.controls.login_form&&params.except!=="login_form"){this.controls.login_form[0].reset();this.login_validator.hideErrors();this.controls.login_indicator.hide();this.enableInputs("login")}if(mustbreak){break}case"resetpw_form":if(this.controls.resetpw_form&&params.except!=="resetpw_form"){this.controls.resetpw_form[0].reset();this.resetpw_validator.hideErrors();this.enableInputs("resetpw")}if(mustbreak){break}case"register_form":if(this.controls.register_form&&params.except!=="register_form"){this.controls.register_form[0].reset();this.register_validator.hideErrors();this.enableInputs("register")}if(mustbreak){break}case"subscribe_form":if(this.controls.subscribe_form&&params.except!=="subscribe_form"){this.controls.subscribe_form[0].reset();this.subscribe_validator.hideErrors();this.enableInputs("subscribe")}if(mustbreak){break}case"commentsettings_form":if(this.controls.commentsettings_form&&params.except!=="commentsettings_form"){this.controls.commentsettings_form[0].reset();this.enableInputs("commentsettings")}if(mustbreak){break}case"profileedit_form":if(this.controls.profileedit_form&&params.except!=="profileedit_form"){this.controls.profileedit_form[0].reset();this.enableInputs("profileedit")}if(mustbreak){break}case"avatarupload_form":if(this.controls.avatarupload_form&&params.except!=="avatarupload_form"){this.controls.avatarupload_form[0].reset();this.enableInputs("avatarupload")}if(mustbreak){break}case"changepassword_form":if(this.controls.changepassword_form&&params.except!=="changepassword_form"){this.controls.changepassword_form[0].reset();this.enableInputs("changepassword")}if(mustbreak){break}case"deleteuser_form":if(this.controls.deleteuser_form&&params.except!=="deleteuser_form"){this.controls.deleteuser_form[0].reset();this.enableInputs("deleteuser")}if(mustbreak){break}}},setupProfileForms:function(){if(this.auth.authenticated){if(this.controls.profileedit_form){if(this.feature.isOn(this.feature.POWWOW)&&(this.auth.user.converted===1)){jQuery("#label_profileedit_newUsername").html("Screen name:");jQuery("#profileedit_newUsername_change").find("a").html("(change screen name)");jQuery("#profileedit_newUsername_change_warn").html("(You are only able to change your screen name once.)");jQuery(".validationmessage username_validmsg").html("That screen name is invalid and/or taken.");jQuery("#label_profileedit_displayName").html("Display name:")}this.controls.profileedit_newUsername_text.html(this.auth.user.username);this.controls.profileedit_screenName.html(this.auth.user.smartName);this.controls.profileedit_newUsername.val(this.auth.user.username);this.controls.profileedit_displayname.val(this.auth.user.smartName);this.controls.profileedit_url.val(this.auth.user.url?this.auth.user.url:"");this.controls.profileedit_email.val(this.auth.user.email?this.auth.user.email:"");this.controls.profileedit_aimname.val(this.auth.user.aimname?this.auth.user.aimname:"");if(this.controls.profileedit_extended){for(var i=0,l=this.controls.profileedit_extended.length;i<l;i++){var extname=this.getParam("ext",this.controls.profileedit_extended[i]);this.controls.profileedit_extended.eq(i).val(this.auth.user[extname]?this.auth.user[extname]:"")}}if(this.auth.hasLevel("authors")){this.controls.profileedit_contactname[0].disabled=false;this.controls.profileedit_contactname_panel.show();this.controls.profileedit_contactemail[0].disabled=false;this.controls.profileedit_contactemail_panel.show();this.controls.profileedit_contactname.val(this.auth.user.contactName?this.auth.user.contactName:"");this.controls.profileedit_contactemail.val(this.auth.user.contactEmail?this.auth.user.contactEmail:"")}else{this.controls.profileedit_contactname.val("");
this.controls.profileedit_contactemail.val("");this.controls.profileedit_contactname[0].disabled=true;this.controls.profileedit_contactname_panel.hide();this.controls.profileedit_contactemail[0].disabled=true;this.controls.profileedit_contactemail_panel.hide()}this.controls.profileedit_twitterusername.val(this.auth.user.twitterUsername?this.auth.user.twitterUsername:"");this.controls.profileedit_facebookurl.val(this.auth.user.facebookUrl?this.auth.user.facebookUrl:"");this.controls.profileedit_isFacebookFanPage.attr("checked",this.auth.user.isFacebookFanPage==="true"?true:false);this.controls.profileedit_googleplusurl.val(this.auth.user.googleplusUrl?this.auth.user.googleplusUrl:"");if(this.feature.isOn(this.feature.POWWOW)&&!(this.auth.user.converted===1)){this.controls.filter(".feature_newcomments_newuser").show();this.controls.filter(".feature_newcomments_olduser").hide()}else{this.controls.filter(".feature_newcomments_newuser").hide();this.controls.filter(".feature_newcomments_olduser").show()}}if(this.controls.changepassword_form){this.controls.changepassword_username.val(this.auth.user.username);this.controls.changepassword_id.val(this.auth.user.id);this.controls.changepassword_password.val("");this.controls.changepassword_new_password.val("");this.controls.changepassword_confirm_password.val("")}if(this.controls.deleteuser_form){this.controls.deleteuser_username.val(this.auth.user.username);this.controls.deleteuser_id.val(this.auth.user.id)}if(this.controls.commentsettings_form){if(this.auth.user.commentViewMode&&this.auth.user.commentViewMode=="featured"){this.controls.cvm_hidden[0].checked="false";this.controls.cvm_featured[0].checked="true"}else{this.controls.cvm_featured[0].checked="false";this.controls.cvm_hidden[0].checked="true"}if(this.auth.user.commentRepliesMode&&this.auth.user.commentRepliesMode=="expanded"){this.controls.crm_collapsed[0].checked="false";this.controls.crm_expanded[0].checked="true"}else{this.controls.crm_expanded[0].checked="false";this.controls.crm_collapsed[0].checked="true"}if(this.auth.user.commentOrder&&this.auth.user.commentOrder=="asc"){}else{}}}}});$.extend($.ui.PresenceWidget,{version:"1.0",defaults:{controlClass:"presence_control",selectors:{},show_validation_errors:true,isReloading:true,loginNeeded:false,facebook_action_url:"/index.php?op=fb",login_action_url:"/index.php?op=ajax_login",logout_action_url:"/index.php?op=ajax_logout",register_action_url:"/index.php?op=register",resetpw_action_url:"/index.php?op=emailpassword",setprofile_action_url:"/index.php?op=setprofile",deleteuser_action_url:"/index.php?op=deleteuser",burner_action_url:"/sso/burner_request",isburner_action_url:"/sso/isBurner",externalElement:"#presence_external_templates, .presence_control_external",commenterimage_host_prefix:"http://cache.gawkerassets.com/assets/images/commenter/",commenterimage_host_postfix:"_160.jpg",onLoginRequestSent:function(wg){},onLoginRequestFail:function(wg){},onLoginSuccess:function(wg){if(wg.options.isReloading==true){window.location.reload()}return"will_sync"},onLoginFailure:function(wg){Message.showMessage("Login failed",wg.controls.login_button[0],{nextMessage:"Login"})},onLoginPanelShow:function(wg){wg.controls.login_panel.fadeIn(500,function(){wg.syncEffect()});return"will_sync"},onLoginPanelHide:function(wg){wg.controls.login_panel.fadeOut(500,function(){wg.syncEffect()});return"will_sync"},onLogoutRequestSent:function(wg){wg.controls.profile_link.html("Logging out...")},onLogoutRequestFail:function(wg){wg.controls.profile_link.html("Logging out...")},onLogoutSuccess:function(wg){if(wg.options.isReloading==true){window.location.reload()}else{wg.controls.profile_panel.hide();wg.controls.login_panel.show()}},onLogoutFailure:function(wg){Message.showMessage("Logout failed",wg.controls.logout_link[0],{nextMessage:"logout"})},onResetPWRequestSent:function(wg){wg.controls.resetpw_submit[0].value="Resetting..."},onResetPWRequestFail:function(wg){Message.showMessage("Reset failed",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWSuccess:function(wg){Message.showMessage("Password sent",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onResetPWFailure:function(wg){Message.showMessage("Reset failed",wg.controls.resetpw_submit[0],{nextMessage:"Reset"})},onRegisterRequestSent:function(wg){wg.controls.register_submit[0].value="Registering..."},onRegisterRequestFail:function(wg){Message.showMessage("Register failed",wg.controls.register_submit[0],{nextMessage:"Register"})},onRegisterSuccess:function(wg){Message.showMessage("Done",wg.controls.register_submit[0],{nextMessage:"Register"});window.setTimeout(function(){wg.syncEffect()},1000);return"will_sync"},onRegisterFailure:function(wg){Message.showMessage("Register failed",wg.controls.register_submit[0],{nextMessage:"Register"})},onSubscribeRequestSent:function(wg){wg.controls.subscribe_submit[0].value="Subscribing..."},onCommentSettingsRequestSent:function(wg){},onProfileeditRequestSent:function(wg){wg.controls.profileedit_submit[0].value="Saving profile..."
},onProfileeditRequestFail:function(wg){Message.showMessage("Profile save failed.",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onProfileeditSuccess:function(wg){Message.showMessage("Done",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onProfileeditFailure:function(wg){Message.showMessage("Profile save failed.",wg.controls.profileedit_submit[0],{nextMessage:"Save profile"})},onChangepasswordRequestSent:function(wg){wg.controls.changepassword_submit[0].value="Saving password..."},onChangepasswordRequestFail:function(wg){Message.showMessage("Password save failed.",wg.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordSuccess:function(wg){Message.showMessage("Done",wg.controls.changepassword_submit[0],{nextMessage:"Save"})},onChangepasswordFailure:function(wg){Message.showMessage('<p>To protect your account\'s security, we\'ve locked the ability for this account to change passwords without email authentication.</p><p>To reset your password, please ensure that your email address is up to date in your profile, click the "reset password" link at the top of the page and enter your updated email address.</p><p>If you are still having trouble with your account, please contact us at <a href="mailto:help@gawker.com">help@gawker.com</a></p>',wg.controls.changepassword_submit[0],{nextMessage:"Save",duration:10000})},onDeleteUserRequestSent:function(wg){wg.controls.deleteuser_submit[0].value="Deleting Account..."},onDeleteUserRequestFail:function(wg){Message.showMessage("Account deletion failed.",wg.controls.deleteuser_submit[0],{nextMessage:"Delete Account"})},onDeleteUserSuccess:function(wg){Message.showMessage("Done",wg.controls.changepassword_submit[0],{nextMessage:"Delete Account"})},onDeleteUserFailure:function(wg){Message.showMessage('Account deletion failed. Please contact <a href="mailto:help@gawker.com">help@gawker.com</a>.',wg.controls.deleteuser_submit[0],{nextMessage:"Delete Account",duration:10000})},onAvataruploadRequestSent:function(wg){wg.controls.avatarupload_submit[0].value="Sending image..."},onAvataruploadRequestFail:function(wg){Message.showMessage("Image upload failed.",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadSuccess:function(wg){Message.showMessage("Done",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})},onAvataruploadFailure:function(wg){Message.showMessage("Image upload failed.",wg.controls.avatarupload_submit[0],{nextMessage:"upload image"})}}})})(jQuery);(function(a){a.widget("ui.RepublishToolWidget",{initialize:function(){this.xhr=new XHR({klass:"republishcontrols",beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});var c={};var d=false;if(this.controls.quickpost_dialog){c.quickpost={el:this.controls.quickpost_dialog,focus:this.controls.starinvite_email};d=true}if(this.controls.republish_dialog){c.republish={el:this.controls.republish_dialog,focus:this.controls.siteId};c.edit={el:this.controls.edit_dialog,focus:this.controls.siteId};this.registerEventHandler(this.controls.republish_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.republish_form,"submit",this.republish.bind(this));this.registerEventHandler(this.controls.edit_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.edit_form,"submit",this.edit.bind(this));d=true}if(d){var b={overlay:this.controls.overlay,panels:c,group:this.options.dialoggroup?this.options.dialoggroup:false};this.commondialogs.initDialogs(b)}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){this.setupControls()},setupControls:function(){if(this.auth.hasLevel("authors","highest")&&this.controls.republish_link){this.controls.republish_link.show()}else{this.controls.republish_link.hide()}},quickpostOpen:function(){var f=jQuery("h1.headline.title a").html();var b="";jQuery("div.post-body > p:visible").each(function(){if(b.length>0){b+="\n\n"}b+=this.innerHTML.replace(/<span\s+class="pm_byline[^"]*"[^>]*>[\w\W\n\r]*?<\/span>/,"").replace(/<br[^>]*>/ig,"\n").replace(/<[^>]*>/g,"");var g=b.split(/[\s\n\r]+/).length;if(g>100){return false}});while(b.match(/[\r\n]{3,}/g)){b=b.replace(/[\r\n]{2,}/g,"\n\n")}b=b+'\n\n<a href="'+location.href+'">'+f+"</a>";jQuery('.republish_control.cn_quickpost_dialog input[name="title"]').val(f);jQuery('.republish_control.cn_quickpost_dialog input[name="entry"]').val(b);jQuery('.republish_control.cn_quickpost_dialog input[name="url"]').val(location.href);var e=this.controls.quickpostSiteId[0];e.options.length=0;for(var d=0;d<this.options.siteIds.length;d++){if(!this.auth.hasLevel("authors",this.options.siteIds[d])){continue}var c=new Option(this.options.sites[this.options.siteIds[d]],this.options.siteIds[d]);
e.options[e.options.length]=c}this.commondialogs.toggleDialog({which:"quickpost"})},quickpostSubmit:function(){var d=this.controls.quickpostSiteId[0];var b=d.options[d.selectedIndex].text;if(jQuery.inArray(b,["deadspin","gizmodo","io9","jalopnik","jezebel","kotaku","lifehacker","sploid"])==-1){b="gawker"}var c=this.controls.quickpostForm[0];c.action="https://publish."+b+".com/ged/index.php?op=selcont";this.commondialogs.toggleDialog({which:"quickpost"});c.submit()},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},hasLevelOnAnySite:function(e){var c=this.options.siteIds.length;var d=false;for(var b=0;b<c;b++){d=this.auth.hasLevel(e,this.options.siteIds[b]);if(d){break}}return d},handleClick:function(d){var c=this.getParam("cn",d.target);switch(c){case"republish_link":this.setupDialog();this.commondialogs.toggleDialog({which:"republish"});break;case"republish_cancel":this.commondialogs.toggleDialog({which:"republish"});break;case"republish_submit":this.controls.action.val("republish");this.republish();break;case"republish_promote":this.controls.action.val("promote");this.republish();break;case"edit_link":this.controls.postId.val(this.getParam("postId",this.controls.edit_link));var b=this.controls.edit_link.get(0);this.controls.edit_issued.val(this.getDate(this.getParam("issued",b)));this.controls.edit_pubstatus.val(this.getParam("pubstatus",b));this.commondialogs.toggleDialog({which:"edit"});break;case"edit_cancel":this.commondialogs.toggleDialog({which:"edit"});break;case"quickpostCancel":this.commondialogs.toggleDialog({which:"quickpost"});break;case"quickpostSubmit":this.quickpostSubmit();break;case"quickpost":jQuery("#editorControlsWidget").hide();this.quickpostOpen();break;default:return true}d.stopPropagation();d.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleAjaxRequest:function(){this.disableForm(true)},handleAjaxSuccess:function(b){if(b.success){this.controls.progress.hide();this.disableForm(false);var c=b.message;if(b.gedUrl!==undefined){c+=' View in <a href="'+b.gedUrl+'" target="_blank">GED</a>'}jQuery(".cn_republish_dialog button").toggleClass("hidden");this.showMessage(c,false,b.action=="edit"?"edit":"republish",true)}else{this.controls.progress.hide();this.disableForm(false);jQuery(".cn_republish_dialog button").toggleClass("hidden");this.showMessage(b.message,false,b.action=="edit"?"edit":"republish",true)}},handleAjaxFail:function(){this.controls.progress.hide();this.disableForm(false);this.showMessage("<b>Cannot republish the post.</b> Please try again later",false)},setupDialog:function(){var b=this.controls.siteId.get(0);for(var d=b.options.length;d>0;d--){b.options[0]=null}for(d=0;d<this.options.siteIds.length;d++){var f=this.options.siteIds[d];if(!this.auth.hasLevel("authors",f)){continue}opt=new Option(this.options.sites[f],f);b.add(opt,null)}var e=new Date();this.controls.postId.val(this.getParam("postId",this.controls.republish_link.get(0)));var c=this.controls.republish_link.get(0);this.controls.republish_issued.val(this.getDate(this.getParam("issued",c)));if(jQuery(".cn_republish_submit.hidden").length>0){jQuery(".cn_republish_dialog button").toggleClass("hidden")}},getDate:function(d){var c=new Date();var b=function(e){return(e<10?"0":"")+e};c.setTime(d*1000);return c.getFullYear()+"-"+b(c.getMonth()+1)+"-"+b(c.getDate())+" "+b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())},republish:function(d){if(d!==undefined){d.stopPropagation();d.preventDefault()}if(this.controls.siteId.val()>0){var c=this.controls.republish_form.serialize()+"&pipeJsonP=?";var b=this.options.gedUrl+"index.php?"+c;this.xhr.getJsonOwn(b);this.controls.progress.show()}else{this.showMessage("Please select site")}return false},edit:function(b){if(b!==undefined){b.stopPropagation();b.preventDefault()}this.xhr.send("/index.php",this.controls.edit_form.serialize());this.controls.progress.show()},disableForm:function(b){var c=(b==true);this.controls.siteId.get(0).disabled=c;this.controls.republish_issued.get(0).disabled=c;this.controls.republish_submit.get(0).disabled=c;this.controls.republish_cancel.get(0).disabled=c;this.controls.edit_issued.get(0).disabled=c;this.controls.edit_pubstatus.get(0).disabled=c;this.controls.edit_submit.get(0).disabled=c;this.controls.edit_cancel.get(0).disabled=c},showMessage:function(d,b,e,g){var c=this;this.controls.message.html(d).show();if(e===undefined){e="republish"}if(g===undefined){g=false}var f=function(){if(!g){c.controls.message.hide()}if(b){c.commondialogs.toggleDialog({which:e})}};setTimeout(f,3000)}});a.extend(a.ui.RepublishToolWidget,{version:"1.0",defaults:{controlClass:"republish_control",externalElement:".presence_control_external, .republish_external, #presence_external_templates",show_validation_errors:true}})})(jQuery);(function(a){a.widget("ui.RoundupSnippetWidget",{snippet:null,initialize:function(){var c={};
var d=false;if(this.controls.roundup_dialog){c.roundup={el:this.controls.roundup_dialog,focus:this.controls.roundup_snippet};this.registerEventHandler(this.controls.roundup_form,"keyup",this.handleKeyUp.bind(this));this.registerEventHandler(this.controls.roundup_form,"submit",function(){return false});d=true}if(d){var b={overlay:this.controls.overlay,panels:c,group:this.options.dialoggroup?this.options.dialoggroup:false};this.commondialogs.initDialogs(b)}this.bindDOMHandlers();this.subscribeForEvent("user.auth.",this.authEventHandler.bind(this));this.subscribeForEvent("maincontent.postloaded",this.loadedEventHandler.bind(this))},bindDOMHandlers:function(){this.registerEventHandler(this.element,"click",this.handleClick.bind(this))},authEventHandler:function(b){this.setupControls()},setupControls:function(){if(this.auth.hasLevel("authors","highest")&&this.controls.roundup_link){this.controls.roundup_link.show()}else{this.controls.roundup_link.hide()}},loadedEventHandler:function(b){this.resetElements();this.setControls();this.bindDOMHandlers();this.setupControls()},handleClick:function(c){var b=this.getParam("cn",c.target);switch(b){case"roundup_link":this.setupDialog();this.commondialogs.toggleDialog({which:"roundup"});break;case"roundup_cancel":this.commondialogs.toggleDialog({which:"roundup"});break;default:return true}c.stopPropagation();c.preventDefault();return false},handleKeyUp:function(b){switch(b.keyCode){case jQuery.ui.keyCode.ESCAPE:this.commondialogs.toggleDialog();break}},handleAjaxSuccess:function(b){this.snippet=b.content;this.controls.roundup_snippet.val(this.snippet);this.controls.progress.hide();this.disableForm(false);this.controls.roundup_snippet.select()},handleAjaxFail:function(){this.snippet=null;this.controls.progress.hide();this.disableForm(false);this.controls.roundup_snippet.val("Failed to get roundup snippet. Please try again later.")},setupDialog:function(){if(this.snippet===null){var b=this.getParam("postId",this.controls.roundup_link);this.controls.roundup_snippet.val("");this.controls.progress.show();this.disableForm(true);jQuery.ajax({type:"get",url:"/index.php?op=ajax_roundupsnippet",data:"refId="+b,success:this.handleAjaxSuccess.bind(this),error:this.handleAjaxFail.bind(this)})}},disableForm:function(b){var c=(b==true);this.controls.roundup_snippet.get(0).disabled=c}});a.extend(a.ui.RoundupSnippetWidget,{version:"1.0",defaults:{controlClass:"roundup_control",externalElement:".presence_control_external, #presence_external_templates",show_validation_errors:true}})})(jQuery);jQuery.extend(settings.widgets,{simpleform:{klass:"SimpleFormWidget",byselector:{"#helpMessage":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){},onReset:function(b){},onClick:function(b){},onAjaxSuccessPre:function(b){},onAjaxSuccess:function(b){},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"helpcontrol",xhrKlass:"helpmessage"}},"#share_email":{options:{externalElement:"#presence_external_templates",show_validation_errors:true,action_url:"/index.php",controlClass:"mail2control",xhrKlass:"mail2",onInit:function(c){var b={};var d=false;var a=c.widget;if(a.controls.overlay){b.mail2={el:a.controls.mail2_dialog,focus:a.controls.from};d=true}if(d){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup?a.options.dialoggroup:false})}a.subscribeForEvent("user.auth.",a.authEventHandler.bind(a));a.controls.title.val(document.title);a.controls.uri.val(window.location.href)},onHide:function(a){},onShow:function(a){},onReset:function(a){},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"cancel":case"toggle":a.widget.controls.form[0].reset();a.widget.validator.hideErrors();a.widget.commondialogs.toggleDialog({which:"mail2"});a.e.stopPropagation();a.e.preventDefault();break}},onAjaxSuccess:function(a){if(true==a.data.success){setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"mail2"})},3000)}},onAjaxFailure:function(a){},onAuthEvent:function(a){a.widget.controls.token[0].value=a.widget.auth.mail2token},onKeyUp:function(a){switch(a.e.keyCode){case jQuery.ui.keyCode.ESCAPE:a.widget.commondialogs.toggleDialog();break}}}},"#invitecontainer":{options:{externalElement:"#presence_external_templates",show_validation_errors:true,action_url:"/index.php",controlClass:"invitecontrol",xhrKlass:"invite",onInit:function(c){var b={};var d=false;var a=c.widget;if(a.controls.overlay){b.invite={el:a.controls.invite_dialog,focus:a.controls.from};d=true}if(d){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup||false})}a.subscribeForEvent("user.auth.",a.authEventHandler.bind(a));c.widget.tearDownEventHandler(c.widget.controls.form,"submit")},onHide:function(a){},onShow:function(a){},onReset:function(a){},onProfileload:function(b){var d=jQuery(".post .content > h1").text().replace(/"/g,"");
var a=0;b.widget.resetElements();b.widget.setControls();b.widget.tearDownEventHandler(b.widget.element,"click",b.widget.handleClick.bind(b.widget));b.widget.registerEventHandler(b.widget.element,"click",b.widget.handleClick.bind(b.widget));b.widget.controls.title.val(d);b.widget.controls.post_title.text(d);b.widget.controls.uri.val(window.location.href);var c=this;jQuery("body").live("inviteRequest",function(j,k,f,h){var g=f+"?post="+k;b.widget.controls.title.val(h||d);b.widget.controls.post_title.text(h||d);b.widget.controls.uri.val(g);c.toggleForm(b)});jQuery(b.widget.controls.form[0]).submit(function(f){c.onSubmit({e:f,widget:b.widget});f.preventDefault();f.stopPropagation();return false})},onPostload:function(a){a.widget.resetElements();a.widget.setControls();a.widget.tearDownEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.registerEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));var c=jQuery(".post .content > h1").text().replace(/"/g,"");a.widget.controls.title.val(c);a.widget.controls.post_title.text(c);a.widget.controls.uri.val(window.location.href);var b=this;jQuery("body").live("inviteRequest",function(f,g){var d=window.location.protocol+"//"+window.location.host+"/"+a.post.id+"?post="+g;a.widget.controls.uri.val(d);b.toggleForm(a)});jQuery(a.widget.controls.form[0]).submit(function(d){b.onSubmit({e:d,widget:a.widget});d.preventDefault();d.stopPropagation();return false})},onFrontpageload:function(a){setTimeout(jQuery.proxy(function(){a.widget.resetElements();a.widget.setControls();a.widget.tearDownEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.registerEventHandler(a.widget.element,"click",a.widget.handleClick.bind(a.widget));a.widget.controls.title.val(jQuery(".permalink h1.headline").text().replace(/"/g,""));a.widget.controls.post_title.text(jQuery(".permalink h1.headline").text());a.widget.controls.uri.val(jQuery(".permalink h1.headline a").attr("href"))},this),1000)},onSubmit:function(a){a.widget.validator.hideErrors();function b(){var d=a.widget.controls;return{via:"email",post_title:d.post_title.text(),uri:d.uri.val(),invite_from:jQuery("#invite_from").val(),invite_fromemail:jQuery("#invite_fromemail").val(),invite_to:jQuery("#invite_to").val(),invite_message:jQuery("#invite_message").val()}}if(a.widget.validator.validate()){Powwow.appProxy("inviteUser",[b()]);a.widget.commondialogs.toggleDialog({which:"invite"})}else{if(a.widget.options.show_validation_errors){a.widget.validator.showErrors()}}a.e.preventDefault();a.e.stopPropagation();return false},toggleForm:function(a){if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();a.widget.commondialogs.toggleDialog({which:"invite"})},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"cancel":case"toggle":this.toggleForm(a);a.e.stopPropagation();a.e.preventDefault();break}},onAjaxSuccess:function(a){if(true==a.data.success){setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"invite"})},3000)}},onAjaxFailure:function(a){},onAuthEvent:function(a){a.widget.controls.token[0].value=a.widget.auth.invitetoken},onKeyUp:function(a){switch(a.e.keyCode){case jQuery.ui.keyCode.ESCAPE:a.widget.commondialogs.toggleDialog();break}}}},".newsletter_signup":{options:{show_validation_errors:true,action_url:"/index.php",controlClass:"newsletter_control",xhrKlass:"newsletter_signup",message_options:{stable:true,duration:10000},onAjaxSuccessPre:function(a){a.widget.options.message_options.stable=true},onAjaxSuccess:function(a){a.widget.options.message_options.stable=false}}},".authoremail":{options:{show_validation_errors:true,action_url:"/index.php?op=send_author_email",controlClass:"authoremail_control",xhrKlass:"authoremail",onInit:function(c){var b={};var d=false;var a=c.widget;if(a.controls.overlay){b.authoremail={el:a.controls.authoremail_dialog,focus:a.controls.emailfrom};d=true}if(d){a.commondialogs.initDialogs({overlay:a.controls.overlay,panels:b,group:a.options.dialoggroup?a.options.dialoggroup:false})}},onClick:function(a){var b=a.widget.getParam("cn",jQuery(a.e.target));switch(b){case"email":if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.commondialogs.toggleDialog({which:"authoremail"});a.e.stopPropagation();a.e.preventDefault();break;case"authoremail_cancel":if(a.widget.controls.form!==undefined){a.widget.controls.form[0].reset()}a.widget.validator.hideErrors();jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.commondialogs.toggleDialog({which:"authoremail"});a.e.stopPropagation();a.e.preventDefault();break;case"authoremail_submit":a.e.stopPropagation();a.e.preventDefault();if(a.widget.validator.validate()){a.widget.validator.hideErrors();jQuery("#authorcontact_spinner").spin("small");jQuery.getJSON(a.widget.options.action_url,a.widget.controls.form.serialize(),function(d,c){jQuery("#authorcontact_spinner").spin(false);
if(true==d.success){jQuery("#author_message_sent").show();setTimeout(function(){a.widget.commondialogs.toggleDialog({which:"authoremail"});jQuery("#author_message_sent").hide()},3000)}else{jQuery("#author_message_failed").show()}})}else{if(a.widget.options.show_validation_errors){jQuery("#author_message_sent").hide();jQuery("#author_message_failed").hide();a.widget.validator.showErrors()}}break}}}},".surveyform":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){var c=b.widget.getParam("cookie");if(true==jQuery.cookie(c)){b.widget.controls.message[0].innerHTML="You took this survey earlier."}else{b.widget.controls.form.show()}},onReset:function(b){},onClick:function(b){},onAjaxSuccess:function(b){if(true==b.data.success){b.widget.controls.form.hide()}},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"surveycontrol",xhrKlass:"survey"}},".guestcommentform":{eventHandlerBuilder:function(a){return{onInit:function(b){},onHide:function(b){},onShow:function(b){},onReset:function(b){jQuery(".text",b.widget.element).val("");b.widget.controls.message.html("");b.widget.element.slideUp()},onClick:function(b){var c=b.widget.getParam("cn",jQuery(b.e.target));switch(c){case"submit":b.widget.controls.form.submit();b.e.stopPropagation();b.e.preventDefault();break;case"reset":b.widget.resetWidget();b.e.stopPropagation();b.e.preventDefault();break}},onAjaxSuccess:function(b){if(true==b.data.success){setTimeout(function(){b.widget.resetWidget()},5000)}},onAjaxFailure:function(b){},onAuthEvent:function(b){},onKeyUp:function(b){}}},terminating_el:".terminating",options:{show_validation_errors:true,action_url:"/index.php",controlClass:"guestcommentcontrol",xhrKlass:"guestcomment"}}}}});(function(a){a.widget("ui.SimpleFormWidget",{validator:null,xhr:null,initialize:function(){this.registerEventHandler(this.controls.form,"submit",this.handleSubmit.bind(this));this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.registerEventHandler(this.controls.form,"keyup",this.handleKeyUp.bind(this));this.subscribeForEvent("maincontent.postloaded",this.handlePostload.bind(this));this.subscribeForEvent("maincontent.frontpageloaded",this.handleFrontpageload.bind(this));this.subscribeForEvent("maincontent.profileloaded",this.handleProfileload.bind(this));this.validator=new Validator(jQuery.extend({},{scope:this.controls.form}));this.xhr=new XHR({klass:this.options.xhrKlass,beforeSend:this.handleAjaxRequest.bind(this),error:this.handleAjaxFail.bind(this),success:this.handleAjaxSuccess.bind(this)});this.fireEvent("onInit",{widget:this})},handleSubmit:function(b){this.validator.hideErrors();if(this.validator.validate()){this.xhr.send(this.options.action_url,jQuery(b.target).serialize())}else{if(this.options.show_validation_errors){this.validator.showErrors()}}b.preventDefault();b.stopPropagation();return false},handleClick:function(b){this.fireEvent("onClick",{e:b,widget:this})},handleAjaxRequest:function(){this.disableInputs();this.controls.indicator.show()},handleAjaxSuccess:function(c){this.fireEvent("onAjaxSuccessPre",{data:c,widget:this});var b={};if(this.options.message_options!==undefined){b=this.options.message_options}Message.showMessage(c.message,this.controls.message[0],b);this.enableInputs();this.controls.indicator.hide();this.fireEvent("onAjaxSuccess",{data:c,widget:this})},handleAjaxFail:function(){var b="Error occurred, please try again later.";Message.showMessage(b,this.controls.message[0]);this.controls.indicator.hide();this.enableInputs();this.fireEvent("onAjaxFailure",{widget:this})},authEventHandler:function(b){this.fireEvent("onAuthEvent",{ev:b,widget:this})},handleKeyUp:function(b){this.fireEvent("onKeyUp",{e:b,widget:this})},hideWidget:function(){this.fireEvent("onHide",{widget:this})},showWidget:function(){this.fireEvent("onShow",{widget:this})},resetWidget:function(){this.fireEvent("onReset",{widget:this})},clearInputs:function(){jQuery("input:text, textarea",this.element).each(function(c,b){b.value=""})},disableInputs:function(){jQuery("input, textarea, select",this.element).each(function(c,b){b.disabled=true})},enableInputs:function(){jQuery("input, textarea, select",this.element).each(function(c,b){b.disabled=false})},handlePostload:function(b){this.fireEvent("onPostload",{widget:this,post:b.params.data})},handleProfileload:function(b){this.fireEvent("onProfileload",{widget:this,post:b.params.data})},handleFrontpageload:function(b){this.fireEvent("onFrontpageload",{widget:this})}});a.extend(a.ui.SimpleFormWidget,{version:"1.0",defaults:{}})})(jQuery);(function(a){a.widget("ui.SplashPostWidget",{initialize:function(){this.subscribeForEvent("splashpost.sponsoredpost.",this.sponsoredPostEventHandler.bind(this));if(typeof this.options.static_version=="undefined"){this.subscribeForEvent("splashpost.load",this.loadEventHandler.bind(this));
jQuery().ready(function(){jQuery("#debug_server_info").html(window.ganjaHost)});this.xhr=new XHR({klass:"splashpost",success:this.handleAjaxSuccess.bind(this)});if(this.isFrontpage()){this.loadFrontpage()}}},handleAjaxSuccess:function(b){switch(b.action){case"classic_frontpage":jQuery("#post_date_views span").html("BLOG VIEW");setBodyPageType("classic_frontpage");break;case null:b.action="splash_post";b.sucess=true;break}this.raiseEvent("navigation.loaded",{data:b});jQuery("body").removeClass("loading").addClass("loaded")},loadEventHandler:function(b){this.loadFrontpage()},isFrontpage:function(){if(location.pathname!="/"&&location.pathname!=""){return false}if(location.hash==""||location.hash=="#!"){return true}if(location.hash.indexOf("!")!=1||location.hash.indexOf("#!|splash=")!=-1){return true}return false},loadFrontpage:function(){var e=false;if(location.hash.indexOf("#!|splash=")!=-1){var d=location.hash.match(/#\!\|splash=([0-9]+)/);if(d!==null){var h={op:"splash_post",refId:d[1]};this.xhr.send("/index.php",h);e=true}location.hash=""}if(!e){jQuery("body").removeClass("loaded").addClass("loading");var c=this.getUrlParams();var g=(c.sponsor_preview!==undefined?parseInt(c.sponsor_preview):0);var f=(c.adzone!==undefined?c.adzone:"");var b=this.options.contentPath;if(g||f){b="/index.php?op=splash_post";if(g){b+="&sponsor_preview="+g}if(f){b+="&adzone="+f}b+="&pipeJsonP=splashpostloader"}this.xhr.getJsonOwn(b,"splashpostloader")}},sponsoredPostEventHandler:function(b){if(b.name=="splashpost.sponsoredpost.show"){this.displaySkybarSponsoredPost(b.params.sponsor_preview)}},pickRandomSponsoredPost:function(b){found=null;percent_sum=0;percents=[];b.each(function(c,d){sponsored_post_id=this.getParam("spid",jQuery(d));percent=this.getParam("percent",jQuery(d));if(typeof percent!="undefined"){percent=parseInt(percent,10)}else{percent=100}percent_sum+=percent;percents[c]={sponsored_post_id:sponsored_post_id,percent_sum:percent_sum}}.bind(this));percent_max=percent_sum>100?percent_sum:100;rand=Math.floor(Math.random()*percent_max);i=0;while(i<percents.length&&rand>percents[i]["percent_sum"]){i++}if(rand<=percents[i]["percent_sum"]){found=percents[i]["sponsored_post_id"]}return found},displaySkybarSponsoredPost:function(b){var j=jQuery(".sponsored_splash_post"),c=null,f=null,g=null;if(b!==false&&b!==undefined){c=j.filter(".spid_"+b);if(c.length===0){c=j.eq(0)}if(c.length===0){return true}jQuery("#sponsor_replaceable").replaceWith(c.show());try{var d=jQuery(".ad_tracker-rightbar-sp .ad_container",c).eq(0).attr("id").replace("ad_container_","");if(d){adRobot.runAdFromQueue(d)}}catch(h){}return true}g=this.pickRandomSponsoredPost(j);if(g!==null){c=j.filter(".spid_"+g);jQuery("#sponsor_replaceable").replaceWith(c.show());try{var d=jQuery(".ad_tracker-rightbar-sp .ad_container",c).eq(0).attr("id").replace("ad_container_","");if(d){adRobot.runAdFromQueue(d)}}catch(h){}}}});a.extend(a.ui.SplashPostWidget,{version:"1.0",defaults:{controlClass:"sppoc"}})})(jQuery);(function(a){a.widget("ui.ViewSelectorWidget",{initialize:function(){var b=this,c=function(){var d=false;if(b.rightbar.size()&&b.rightbarContent.size()){d=(b.rightbar.offset().top-b.rightbarContent.offset().top)-(b.rightbarContent.height()-b.rightbar.height());d=(d<2&&d>-2)}return d};this.registerEventHandler(this.element,"click",this.handleClick.bind(this));this.rightbar=a(this.options.rightbar);this.rightbarHeader=a(this.options.rightbarHeader);this.rightbarWrapper=a(this.options.rightbarWrapper);this.rightbarContent=a(this.options.rightbarContent);this.cookieState=a.cookie(this.options.cookieName);a(window).bind("resize orientationchange",function(d){b.resizeRightbar(d.target)}).trigger("resize");this.rightbar.bind("scroll",function(d){if(!a("body").hasClass("rightbar-no-scroll")&&!b.rightbar.hasClass("loading")&&c()){a("#load_more").trigger("click")}}).bind("mousewheel",function(d){if(!a("body").hasClass("rightbar-no-scroll")&&c()&&d.wheelDelta<0){d.preventDefault()}})},resizeRightbar:function(){var c=this,b=function(){if(c.rightbarWrapper.offset()!==null){var d=c.rightbarWrapper.offset().top;rightbarHeight=a(window).height()-d;c.rightbar.height(rightbarHeight+"px")}};if(this.cookieState===""||this.cookieState===null){clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(b,500)}},handleClick:function(h){var g=a(h.target),b=this.getParam("cn",g),c=document.location.host.replace(/^blog./,""),f="",d={expires:3650,domain:c,path:"/"};if(b=="eye"||b=="traditional"||b=="onepane"||b=="twopane"){h.preventDefault();h.stopPropagation();if(b=="eye"){this.addEyeDropdownClick()}else{if(b=="traditional"||b=="onepane"){d.domain="."+d.domain;f="staticstyle"}if(this.cookieState!=f){this.cookieState=f;a.cookie("gawkermedia_rightbar",this.cookieState,d)}if(c!=document.location.host){document.location.href=document.location.protocol+"//"+c+"/index.php?op=clear_classic"}else{a("body").toggleClass("rightbar-no-scroll",f=="staticstyle");g.parents("ul").eq(0).hide();a(window).trigger("resize")
}}}},addEyeDropdownClick:function(){var b=jQuery("#rightbar_pin_container");if(jQuery("ul:visible",b).length===0){jQuery("ul",b).show();jQuery("#rightbar_pin",b).bind("clickoutside",function(){jQuery("#rightbar_pin_container ul").hide();jQuery("#rightbar_pin").unbind("clickoutside")})}else{jQuery("ul",b).hide()}}});a.extend(a.ui.ViewSelectorWidget,{version:"1.0",defaults:{controlClass:"viewSelector",rightbar:"#rightcontainer .wrap",rightbarContent:"#rightcontainer .innerWrap",rightbarHeader:"#rightbar-header",rightbarLoadMore:"#rightcontainer #load_more",rightbarWrapper:"#rightwrapper",cookieName:"gawkermedia_rightbar"}})})(jQuery);var Snippets=(function(){return{push:function(c,a){try{jQuery("#"+c).html(a)}catch(b){}}}})();var sponsored={getParam:function(f,d){if(d===undefined){d=this.element}else{d=jQuery(d)}var e=d.attr("class");if(e!==undefined){if(jQuery.data(d,"fp")===e){return jQuery.data(d,"params")[f]}else{jQuery.data(d,"fp",e);var g={};e=e.split(" ");for(var c=0,b=e.length;c<b;c++){var a=e[c].indexOf("_");if(a>0){g[e[c].substr(0,a)]=e[c].substr(a+1)}}jQuery.data(d,"params",g);return g[f]}}return null},getUrlParams:function(){var g={};var d=window.location.search;if(d.length>0){d=d.substr(1)}if(window.location.hash.indexOf("?")!=-1){var f=window.location.hash.split("?",2);d+=(d.length>0?"&":"")+f[1]}if(d.length>0){var a=d.split("&");for(var c=0;c<a.length;c++){var b=a[c].split("=",1);if(!b.length){continue}b=b[0];var e=a[c].substr(b.length+1);if(b.substr(-2)=="[]"){b=b.substr(0,b.length-2)}if(g[b]===undefined){g[b]=e}else{if(typeof(g[b])=="string"){g[b]=[g[b],e]}else{g[b].push(e)}}}}return g},enableThumb:function(a){img=a.find("img").eq(0);if(!img.attr("src")&&(img.data("src")!=undefined)){img.attr("src",img.data("src"))}return a},insertSponsoredPost:function(b,a){this.enableThumb(b);b.insertBefore(a);window.adRobot.showSp(this.getParam("postid",b))},displayOldSponsoredPosts:function(){var k=jQuery("#post_list li");var a=jQuery("#sponsored_posts");var m=a.children("li.sponsored");if(k.length==0||m.length==0){return}var c=0;var h=0;var f=false;var b=false;var l=new Date().getTime();var e=0;var d=this.getParam("issued",k[0]);for(var g=0;(g<m.length)&&(e<k.length);g++){c=this.getParam("promoted",m[g])*1000;h=this.getParam("issued",m[g]);if((c<l)&&(h<=d)){f=false;do{b=this.getParam("issued",k[e]);if((b<h)&&!jQuery(k[e]).hasClass("sponsored")){this.insertSponsoredPost(m.eq(g),k[e]);f=true}e++}while(!f&&e<k.length)}}},displaySponsoredPost:function(){var j=jQuery("#post_list li");var a=jQuery("#sponsored_posts");var n=a.children("li.sponsored");var d=null;if(j.length==0||n.length==0){return}if(this.sponsored_displayed||j.length<3){return false}var c=this.getUrlParams();if(c.sponsor_preview!==undefined){if(n[0]!==undefined){this.insertSponsoredPost(n.eq(0),j[3])}}else{var m=[];var o={ids:[],positions:{}};var p=false;var h=jQuery.cookie("rightbar_sponsored_posts_seen_v3");if(h){h=jQuery.secureEvalJSON(h)}else{h={ids:[],positions:{}}}for(var f=0;f<n.length;f++){m[f]=this.getParam("postid",n[f]);d=this.getParam("promoted",n[f])*1000;var l=new Date().getTime();if(h.ids.indexOf(m[f])==-1&&p===false&&d>l){p=f}}var b=null,e=null;for(e=0,f=0;f<h.ids.length;f++){b=h.ids[f];if(m.indexOf(b)!=-1){o.ids[e++]=b;o.positions["id_"+b]=h.positions["id_"+b];var g=jQuery("#post_list .postid_"+h.positions["id_"+b]);this.insertSponsoredPost(n.filter(".postid_"+b),g)}}if(p!==false){for(f=0;f<7&&!j.eq(f).hasClass("sponsored");f++){}if(f==7){o.ids.push(m[p]);o.positions["id_"+m[p]]=this.getParam("postid",j[3]);this.insertSponsoredPost(n.eq(p),j[3])}}jQuery.cookie("rightbar_sponsored_posts_seen_v3",jQuery.toJSON(o),{path:"/"})}this.sponsored_displayed=true}};
